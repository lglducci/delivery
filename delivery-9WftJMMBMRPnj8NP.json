{"createdAt":"2025-09-07T00:48:12.031Z","updatedAt":"2025-10-01T15:26:16.935Z","id":"9WftJMMBMRPnj8NP","name":"Delivery","active":true,"isArchived":false,"nodes":[{"parameters":{"content":"## Formatos Base64\nBase64 é uma forma de codificar dados binários como texto. Dependendo do tipo de arquivo, os prefixos variam para indicar o formato do dado. Aqui estão alguns dos formatos mais comuns com os respectivos prefixos base64:\n\n### 1. **Imagem**\n   - **PNG**: `data:image/png;base64,`\n   - **JPEG**: `data:image/jpeg;base64,`\n   - **GIF**: `data:image/gif;base64,`\n   - **SVG**: `data:image/svg+xml;base64,`\n   - **BMP**: `data:image/bmp;base64,`\n   \n### 2. **Áudio**\n   - **MP3**: `data:audio/mp3;base64,`\n   - **WAV**: `data:audio/wav;base64,`\n   - **OGG**: `data:audio/ogg;base64,`\n   - **MPEG**: `data:audio/mpeg;base64,`\n\n### 3. **Vídeo**\n   - **MP4**: `data:video/mp4;base64,`\n   - **OGG**: `data:video/ogg;base64,`\n   - **WebM**: `data:video/webm;base64,`\n\n### 4. **Texto**\n   - **Plain Text**: `data:text/plain;base64,`\n   - **HTML**: `data:text/html;base64,`\n   - **CSS**: `data:text/css;base64,`\n   - **JavaScript**: `data:text/javascript;base64,`\n   - **CSV**: `data:text/csv;base64,`\n\n### 5. **Documentos**\n   - **PDF**: `data:application/pdf;base64,`\n   - **JSON**: `data:application/json;base64,`\n   - **ZIP**: `data:application/zip;base64,`\n   - **XML**: `data:application/xml;base64,`\n\nEsses são exemplos de prefixos que podem ser usados ao incluir dados base64 em documentos ou aplicações.","height":1166,"width":593,"color":7},"id":"0d958084-a113-4052-aee2-de6c6fa7cec7","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-11808,-4976]},{"parameters":{"content":"## MimeTypes\nO Mime type é o mecanismo para especificar o tipo de documento.\nA estrutura de um MIME type é muito simples; Consiste de um tipo e um subtipo, separados por um '/', onde nenhum espaço é permitido. \nO tipo representa a categoria. \nO subtipo é específico para cada tipo.\n\n### 1. **image**\nRepresenta qualquer tipo de imagens\n- image/gif\n- image/png\n- image/jpeg\n- image/bmp\n- image/webp\n   \n\n### 2. **audio**\nRepresenta qualquer tipo de arquivo de audio\n- audio/midi\n- audio/mpeg\n- audio/webm\n- audio/ogg\n- audio/wav\n- audio/mp3\n- audio/mp4\n\n### 3. **video**\nRepresenta qualquer tipo de arquivo de video\n- video/webm\n- video/ogg\n- video/mp4\n\n### 4. **text**\nRepresenta qualquer documento que contenha texto\n- text/plain\n- text/csv\n- text/html\n- text/css\n- text/javascript\n\n### 5. **application**\nRepresenta qualquer tipo de dados binários.\n- application/octet-stream\n- application/pkcs12\n- application/vnd.mspowerpoint\n- application/xhtml+xml\n- application/xml\n- application/pdf3","height":1166,"width":593,"color":7},"id":"10ec2d92-d29f-4ccb-8b61-9fe2a4e94152","name":"Sticky Note16","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12496,-4944]},{"parameters":{"operation":"get","tableId":"usuario","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $('Dados Lead').item.json.IdConversa.trim() }}"},{"keyName":"id_empresa","keyValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"fd74557b-efb4-4866-b238-5a289fad9db1","name":"Encontrar Cliente1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8960,-2864],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.user_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"fb3b0daa-e714-4e73-aebb-e85b69d69450","name":"Cliente Existe?1","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-8736,-2864],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"tableId":"usuario","fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $('Dados Lead').item.json.LeadNome }}"},{"fieldId":"telefone","fieldValue":"={{ $('Dados Lead').item.json.IdConversa.trim() }}"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"1b5e7d3e-9428-4d1b-8a4d-5dbb011857f9","name":"Criar Cliente1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8368,-2624],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"id":"84187afa-bb28-469f-9c03-995d71927873","name":"Merge1","type":"n8n-nodes-base.merge","typeVersion":3,"position":[-7952,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"## Gatilho\nChat Trigger, WhatsApp, Instagram, Telegram, Messenger, etc..","height":572,"width":340,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14704,-3072],"id":"eb429214-fc7b-4a4e-a2b1-c5b7c26c1192","name":"Sticky Note2"},{"parameters":{"content":"## Variáveis do Fluxo\nCentral de controle do workflow","height":540,"width":326,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14272,-3056],"id":"b59d016e-fc5f-4ac9-9cc0-7e2ef7531382","name":"Sticky Note3"},{"parameters":{"content":"## Filtros Iniciais\nPara evitar que fluxo seja executado quando não queremos","height":540,"width":340,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-13904,-3072],"id":"04a1a72f-535a-47bc-a657-addedd7b9dda","name":"Sticky Note4"},{"parameters":{"content":"## Dados do Lead\nInformações principais sobre o lead","height":540,"width":708,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12352,-6320],"id":"94809f73-f208-408a-8030-03ee63c3cac9","name":"Sticky Note5"},{"parameters":{"content":"## Registro do Lead no banco de dados (Supabase)\nFluxo para adição do lead no banco de dados postgrees supabase.","height":684,"width":2536,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-9472,-3088],"id":"890bd5a2-c1d4-4fa0-a4f2-a395a911981b","name":"Sticky Note7"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usuário para o agente","height":684,"width":836,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-10336,-3072],"id":"7a05b218-9871-4390-94a6-0498f5347e9f","name":"Sticky Note10"},{"parameters":{"assignments":{"assignments":[{"id":"9f488c5c-0b3b-48e9-87b1-5a22d513d1ec","name":"IdConversa","value":"={{ $('Webhook').item.json.body.data.key.remoteJid.replace(\"@s.whatsapp.net\",\"\") }}","type":"string"},{"id":"69f6217f-9063-423f-abf4-e94f6b70f94e","name":"LeadNome","value":"= {{ $('Webhook').item.json.body.data.pushName }}","type":"string"},{"id":"6ba1d721-f125-47fb-ad7b-194cc478a856","name":"input_usuario","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"ba4188f4-3672-477b-a776-7eadc863140c","name":"mensagem_usuario","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"33d4eb69-2991-4188-8b18-2ac04b7b2f74","name":"telefoneEmpresa","value":"={{ $('Webhook').item.json.body.sender.replace(\"@s.whatsapp.net\",\"\") }}","type":"string"}]},"options":{}},"id":"53c8acbc-ba50-48b3-bf41-d38b775ec224","name":"Dados Lead","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-13392,-2832],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"Ajustes os filtros necessários conforme seu gatilho de entrada","height":280,"width":190,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-13840,-2912],"id":"e843f8bf-2eec-48d5-9226-943feabbca98","name":"Sticky Note1"},{"parameters":{"content":"Ajuste tempos de buffer e inatividade do agente conforme necessidade.\n","height":280,"width":190,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14192,-2928],"id":"ad6061d4-0095-45da-ab5c-c9f2e3fe112a","name":"Sticky Note18"},{"parameters":{"assignments":{"assignments":[{"id":"3bdce7b6-d0f1-442c-aafd-8cd123aa21b6","name":"EsperaBuffer","value":1,"type":"number"},{"id":"c38e8985-4494-40a4-878e-f25467849842","name":"TempoInatividadeAgente","value":150,"type":"number"},{"id":"ac619a5e-1438-4e19-aaf5-21dfcbc32312","name":"ModeloTemperatura","value":0.4,"type":"number"},{"id":"cd3b0a32-e454-406e-84ad-b5efedc9c545","name":"empresa","value":"1","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-14160,-2832],"id":"9697cba7-4df2-455a-aa8b-13767473f3ea","name":"Parametros Fluxo","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/?utm_source=template-n8n","height":126,"width":593,"color":7},"id":"081fe256-d0e1-4fa9-8dac-860bcc2dfa32","name":"Sticky Note23","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-11808,-3792]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"00d2650d-52f9-4bf5-9b50-ec548c105222","leftValue":"={{ $json.lead_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8160,-2880],"id":"d5eb91a0-faf4-4aa2-affa-0f6e3ae14efe","name":"Concatena"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"204f54b0-e3ed-4ff4-8302-8c20d3b8aa78","leftValue":"={{ $('Webhook').item.json.body.isGroup }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"c51986d9-f347-4198-89bb-9e4cd0f021c9","leftValue":"={{ $('Webhook').item.json.body.broadcast }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05ee6414-0164-473b-8f82-225cfba55ad2","leftValue":"={{ $('Webhook').item.json.body.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"id":"59453ca8-8599-4909-9040-2779c09bb64d","name":"Filtro Inicial1","type":"n8n-nodes-base.filter","typeVersion":2.1,"position":[-13792,-2832],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-6736,-2656],"id":"4c8de601-cf68-4f27-b200-f0a2db86d314","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"jsCode":"  return [\n  {\n    json: JSON.parse( $input.first().json.text) // ou o campo correto de saída\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6064,-2784],"id":"3db5c23c-e4c5-441e-8ba9-c02bb9df1a69","name":"MsgUsuario"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"03a78ab2-9057-4ff5-baa5-8c37c432a94d","leftValue":"={{$json.acao }}","rightValue":"cancelar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cancelar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e1b9d060-7def-4f5f-b587-657ed9c9ce85","leftValue":"={{ $json.acao }}","rightValue":"finalizar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Finalizar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e3fc41f2-ee99-4de2-8841-2ae1a7da37db","leftValue":"={{$json.acao }}","rightValue":"adicionar_item","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Adicionar Item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"38045ee6-0b44-4b52-a79c-676c7ce5998a","leftValue":"={{ $json.acao }}","rightValue":"carrinho","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"carrinho"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4bbedcdd-6893-41a2-9e3d-bfc9b97ca10a","leftValue":"={{ $json.acao }}","rightValue":"ajuda","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"ajuda"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"42e2c65b-a99d-4991-ac87-a7ff8d84d4a5","leftValue":"={{$json.acao.trim()}}","rightValue":"montagem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"montagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"23e65839-03f6-4879-8998-48ad2909ef94","leftValue":"={{ $json.acao }}","rightValue":"cardapio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cardapio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"996ac831-1b2b-4f3b-8efa-a53642a5d337","leftValue":"={{ $json.acao }}","rightValue":"desconhecida","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"desconhecido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b6759ac0-49ef-4335-bf0c-ee38935c61f9","leftValue":"={{ $json.acao }}","rightValue":"cardapio_online","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"cardapio_online"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5ba958dd-b3b7-4cfd-a85c-1d0e58a103e2","leftValue":"={{ $json.acao }}","rightValue":"excluir_item","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"excluir_item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7ff222af-656b-42d7-b077-1c24c4afd7ca","leftValue":"={{ $json.acao }}","rightValue":"sair","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"sair"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4242d483-acf8-4822-9ff6-b334bf6e6873","leftValue":"={{ $json.acao }}","rightValue":"opcoes","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"opcoes"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-5264,-3056],"id":"df5dff62-eb9b-4f07-a007-a70368a273c4","name":"Switch"},{"parameters":{"httpMethod":"POST","path":"agente_delivery","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-14544,-2832],"id":"52671cad-26cd-4495-940c-eff54c5e1b56","name":"Webhook","webhookId":"66949457-5339-4325-b499-9a15d57ff6a1"},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n {{ $('MensagemTraduzida').item.json.message }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"= Você é um classificador de intenção para um pedido de pizzaria.\n\nDada a mensagem do cliente, responda APENAS com uma das seguintes ações:\n\n- adicionar_item → o cliente está pedindo uma pizza, bebida, etc., ou digitou \"1\" para adicionar mais itens\n- finalizar → se ele disser \"pronto\", \"fim\", \"pode fechar\", \"fechar\" , \"concluir\" ou digitar \"4\", \"fischer\"\n- cancelar → se ele disser que desistiu, quer cancelar ou digitar \"6\"\n- comentar → se ele faz observações tipo \"sem cebola\", \"sem queijo\", etc.\n- desconhecida → se não entender a mensagem ou disser \"ajuda\" \n- carrinho → se o cliente deseja ver o resumo do pedido ou digitar \"5\" ou  \"carrinho\"\n- cardapio →  o cliente diseer \"Cardapio\", ou digitou \"3\" para ver o cardapio\n\n - cardapio_online → quando o cliente disser \"consultar\" no início da frase, seguido de qualquer palavra (sabor de pizza, esfirra, bebida, borda ou outro produto do cardápio).  \n  Sempre que a frase começar com \"consultar\", classifique como cardapio_online, sem exceções.  \n\n  Também use esta ação se o cliente disser apenas o nome de um sabor ou produto, sem a palavra \"consultar\".  \n\n  Exemplos:  \n  \"consultar pizza calabresa\"  \n  \"consultar esfirra carne\"  \n  \"consultar coca cola\"  \n  \"consultar água\"  \n  \"consultar pizzaiolo\"  \n  \"mussarela\"  \n  \"calabresa\"  \n  \"coca\"  \n  \"catupiry\"\n\n\n\n- excluir_item 8→  o cliente disser \"excluir 1\" disser  ou  \"excluir item 9\" ou disser \"quero excluir item 2\"\n- ajuda→  o cliente disser \"ajuda\" \n- sair→  o cliente disser   \"saia\", \"sai\" ,\"saí\", \"sair\"\n- adicionar_item →  o cliente disser \"adicionar ingrediente cheddar ao item 3 \"    ou  \"adicionar ingrediente ovo ao item 3 \" ou disser \"adicionar mussarela ao item 2\", \"adicionar catupiry ao item 4\"\n- humanizado →  o cliente diseer \"humanizado\", ou digitou \"11\"  envie o numero de telefone humanizado\n-montagem -> quando o status  {{ $json.status }} for montagem \nRetorne **somente** nesse formato:\n\n{\n  \"acao\": \"adicionar_item\" | \"finalizar\" | \"cancelar\" | \"comentar\" | \"desconhecida\" | \"consultar\" | \"detalhar\" | \"menu\" |\"cardapio\"| \"humanizado\"| \"excluir_item\" | \"cardapio_online\"  |\"ajuda\" |\"sair\"\n}"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[-6736,-2880],"id":"18666f34-3844-4b37-b140-4cab5cf339fd","name":"Menu","retryOnFail":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"item_pedido_temp","mode":"list","cachedResultName":"item_pedido_temp"},"deleteCommand":"delete","where":{"values":[{"column":"user_id","value":"= {{ $('Merge1').item.json.user_id }}"},{"column":"status","value":"rejeitado"},{"column":"id_empresa","value":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4352,-3472],"id":"b72f80e2-7e63-409a-99b7-6bb0d3406b0f","name":"ExcluiRejeitados","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"content":"","height":5148,"width":13404,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14864,-5408],"id":"ae30458e-4f49-47e8-af39-4ade1146f1f5","name":"Sticky Note14"},{"parameters":{"tableId":"pedido_temp","fieldsUi":{"fieldValues":[{"fieldId":"user_id","fieldValue":"={{ $('Merge1').item.json.user_id }}"},{"fieldId":"status","fieldValue":"ajuda"},{"fieldId":"valor","fieldValue":"0"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"3c74e864-c948-4abb-bfd2-b178607d6201","name":"CriaPedido","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7456,-2720],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.user_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"c71bf718-5970-4cb3-b25d-fdad99a489ba","name":"Cliente Pedido","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-7600,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","tableId":"pedido_temp","filters":{"conditions":[{"keyName":"user_id","keyValue":"={{ $('Merge1').item.json.user_id }}"},{"keyName":"id_empresa","keyValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"d4c7b023-e838-4573-8556-28f89f4bbcba","name":"EncontrarPedido","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7776,-2880],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3776,-4784],"id":"db972b18-b2ef-45ac-9839-f04763f41a93","name":"No Operation, do nothing2","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"id":"bb02d4e0-d35f-4694-a604-2dd0b7162d9e","name":"MergePedido","type":"n8n-nodes-base.merge","typeVersion":3,"position":[-7280,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-4176,-2080],"id":"6941bd6f-503a-4890-b396-bfab789ba416","name":"No Operation, do nothing9","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"select * from  cancela_pre_pedido( {{ $('Concatena').item.json.user_id }}, {{ $('MergePedido').item.json.pedido_id }}  ,  \n {{ $('DadosEmpresa').item.json.id_empresa }});","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4576,-4672],"id":"4f5d0274-e1b7-47a8-90fc-5e37f85b5157","name":"CancelarPedido","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"041e18dc-788b-45e7-9348-cca03ac28eee","leftValue":"={{ $json.status }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8608,-3200],"id":"81fc366a-8a3d-4d3e-8ce1-ef28917b750b","name":"If2"},{"parameters":{"operation":"update","tableId":"usuario","matchType":"allFilters","filters":{"conditions":[{"keyName":"user_id","condition":"eq","keyValue":"={{ $json.user_id }}"},{"keyName":"status","condition":"is","keyValue":"null"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"iniciado"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8400,-3232],"id":"3b808fe7-6ab9-442b-9998-0664165cb23d","name":"IniciaAtendimento","credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"operation":"update","tableId":"usuario","matchType":"allFilters","filters":{"conditions":[{"keyName":"user_id","condition":"eq","keyValue":"={{ $json.user_id }}"},{"keyName":"status","condition":"eq","keyValue":"iniciado"},{"keyName":"status","condition":"eq","keyValue":"iniciado"},{"keyName":"id_empresa","condition":"eq","keyValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"enviado"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8400,-3072],"id":"78a77b6f-a8c8-41cc-85d4-2ce5bcc99f34","name":"AtendimentoEnviado","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"a8106197-1d10-438c-a9e7-07c17a8adfd0","name":"acao","value":"={{$json.acao}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5584,-2928],"id":"4d310e5e-23eb-469b-8397-bf98ca460fab","name":"Acao"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6df36e53-74bd-45c5-9d92-2bb167c8b837","leftValue":"={{ $json.cancela_pre_pedido.length }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-4320,-4672],"id":"8dca8180-da58-4896-8c15-0704a4703f39","name":"If5"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3760,-4576],"id":"7a825b19-ff9b-4111-aa5a-9e0568398a02","name":"No Operation, do nothing21","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"3f5c86ea-fcc2-4783-8210-a28ce186597d","name":"chatInput","value":"=  {{ $('MensagemTraduzida').item.json.message }}","type":"string"},{"id":"57ddce63-da48-426f-85ae-c63b16da57fa","name":"user_id","value":"={{ $('Merge1').item.json.user_id }}","type":"number"},{"id":"01f0d23c-4a6a-4f2f-b986-7acfe7c4b65b","name":"pedido_id","value":"={{ $('MergePedido').item.json.pedido_id }}","type":"number"},{"id":"0718edfa-d295-496a-bfa1-f8e591daf83b","name":"telefone","value":"={{ $('Dados Lead').item.json.IdConversa }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3904,-3472],"id":"178b7d11-672f-4189-8666-9be32b1dfd39","name":"MontPedido"},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"item_pedido_temp","mode":"list","cachedResultName":"item_pedido_temp"},"deleteCommand":"delete","where":{"values":[{"column":"user_id","value":"= {{ $('Merge1').item.json.user_id }}"},{"column":"status","condition":"!=","value":"concluido"},{"column":"id_empresa","value":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4368,-3168],"id":"c48e2408-1860-4b9a-8641-942eaf994434","name":"ExcluiRejeitados1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" // Code node (JavaScript) — Run Once for All Items\n// Captura fracionadas e remove do texto para a LLM\n\nconst inputItems = $input.all();   // <- aqui está a correção\nconst out = [];\n\nfor (const { json } of inputItems) {\n  const raw = String(json.chatInput ?? '');\n\n  // normalização leve\n  let norm = raw\n    .toLowerCase()\n    .replace(/[–—−]/g, '-')               // hífens\n    .replace(/\\b(meia|metade)\\b/g, '1/2') // \"meia/metade\" -> 1/2\n    .replace(/\\s+/g, ' ')\n    .trim();\n\n  const fracionadas = [];\n\n  // [qtd?][x?] 1/2 A (e|,|+|/) 1/2 B  (evita confundir 2L, etc.)\n  const re = /\\b(?:(\\d+)\\s*x?\\s*)?1\\/2\\s*(\\d{1,3})(?!\\s*[a-z])\\s*(?:e|,|\\+|\\/)\\s*1\\/2\\s*(\\d{1,3})(?!\\s*[a-z])\\b/gi;\n\n  // uma passada: coleta e remove\n  let rest = norm.replace(re, (_full, q, a, b) => {\n    fracionadas.push({\n      quantidade: q ? parseInt(q, 10) : 1,\n      metade1: parseInt(a, 10),\n      metade2: parseInt(b, 10),\n    });\n    return ' ';\n  });\n\n  rest = rest.replace(/\\s+/g, ' ').trim();\n\n  out.push({\n    json: {\n      ...json,                 // preserva campos existentes (user_id, pedido_id, etc.)\n      texto_original: raw,\n      texto_limpo: rest,       // passe ESTE texto para a LLM\n      fracionadas, \n    telefone:  $input.first().json.telefone\n      //depois some com pizzastelefone_fracionadas da LLM\n    },\n  });\n}\n\nreturn out;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3664,-3472],"id":"e28406bd-a2e9-41e8-a211-2cbe7ef938d3","name":"Code2"},{"parameters":{"content":"##  Cancelar Pedido\nCancelar um pedido","height":568,"width":1108,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4592,-4928],"id":"addbb638-b3fd-4929-bf26-ea6b7371fba4","name":"Sticky Note12"},{"parameters":{"content":"Ajuste sua instância e autenficiação da Z-API","height":300,"width":230,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3248,-9696],"id":"ab7bb127-90f0-4608-8976-c9dd13fa15c0","name":"Sticky Note22"},{"parameters":{"content":"## Envio das Respostas ao Usuário\nEnvio das mensagens quebradas para o usuário","height":760,"width":900,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3440,-9984],"id":"071b4c58-e2b5-4458-8bca-3ffc79e578ca","name":"Sticky Note13"},{"parameters":{"content":"Ajuste o Node Set com os campos relevantes fornecidos.\n","height":280,"width":706,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-13488,-2912],"id":"9ab79777-a465-45db-9c48-5e480b1acdf2","name":"Sticky Note"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= 🍕 *Bem-vindo(a) à Pizzaria La Cantina!*\nConfira nossos cardápios:\n📄  *Pizzas*:\n https://xqweduudelsukanrzekj.supabase.co/storage/v1/object/public/imagens_pizza/pixa%20(1).jfif\n\n📄 *Esfirras*:  \n https://xqweduudelsukanrzekj.supabase.co/storage/v1/object/public/imagens_pizza/cardapio%20esfirra%20(3)%20(2).jfif\n\n\nVamos começar seu pedido!\n\n","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4400,-2080],"id":"cc30450b-1111-401b-99da-fb2e1ba664b6","name":"MenuCardapio","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=``` ⏳ Processando...  ```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4128,-3472],"id":"ea83b2b5-79e2-4f51-9770-2d4b2cc935c9","name":"MenuCardapio15","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= 🗑️ {{ $('Dados Lead').item.json.LeadNome }}, o seu pedido foi cancelado com sucesso. Vamos começar um novo pedido!","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4048,-4784],"id":"d6d7b503-0e9c-4f9d-9c55-71e541a2f134","name":"MenuCardapio23","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= 🗑️ {{ $('Dados Lead').item.json.LeadNome }}, não encontratmos dados a ser excluido. Vamos começar um novo pedido!","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4032,-4576],"id":"df4e7ad3-94ef-4bc4-86e7-73271ad59466","name":"MenuCardapio24","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"bc64f125-d93c-4d1d-97ae-65c0adb08b79","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"f7053057-3e82-49ad-a2bf-07bafc958f06","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"extendedTextMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"137aec3f-e95e-4d59-b9ba-1140f9fc4fb4","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals"},"id":"40b284c8-fdf7-49e5-9ac3-8c5051f51521"}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"7babc8fd-200c-4cb8-bc63-f999f57d5217","leftValue":"={{ $('Webhook').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.mimetype }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"Outro"}},"id":"0ca16946-edee-44b3-8fc8-456764c34cff","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[-12256,-2848],"notesInFlow":true,"notes":"Ajustar condições para cada tipo de mensagem a depender da sua entrada de dados\n\nTEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{"language":"pt"}},"id":"71091022-6080-456b-b2c0-401f94abbfc6","name":"Transcrever Áudio1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[-11552,-2864],"credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=#Instruções\nO usuário te enviou uma imagem a qual você deve descrever.\n\nA imagem pode vir acompanhada de uma mensagem de texto (<MensagemUsuario>)\n\nCaso venha, utilize a mensagem anexa como contexto extra, tente capturar o sentimento da mensagem e objetivo pelo qual o usuário esteja enviando esta imagem na conversa.\n\nCrie uma resposta descrevendo as informações enviadas para que estas sejam utilizadas por um agente no futuro.\n\nLembre-se:\nEste agente apenas terá as informações que você fornecer, portanto repasse toda informação que julgar importante.\n\n#Dados\n<MensagemUsuario>\n{{ $json.MensagemImagem }}\n</MensagemUsuario>\n","inputType":"base64","options":{}},"id":"b3845131-8527-4bcb-b6f1-5aad006b085e","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[-11552,-2704],"credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"amount":"={{ $('Parametros Fluxo').item.json.EsperaBuffer }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-10816,-2784],"id":"65441867-d7aa-4aee-b6b7-f8feefb3ff80","name":"Wait1","webhookId":"169ea291-c3dc-4bca-854f-05520c979d7d","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1bd6c365-d077-4284-9dfe-94db1cbe39bd","leftValue":"={{ $('Buffer 3').item.json.messages.last() }}","rightValue":"={{ $('Buffer ').item.json.messages.last() }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10496,-2784],"id":"4ffac93b-8dd4-4edf-97a0-55e82adc4661","name":"ComparandoMensagens1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-10976,-2784],"id":"467ae411-f1a1-4b6c-a081-da9a48cc8d4f","name":"Buffer ","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-10656,-2784],"id":"694d79db-6198-4108-8532-dac657d0df75","name":"Buffer 3","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.Texto }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-3184],"id":"ba05176c-afcd-4315-b0ea-1a93d79f5877","name":"Add Texto Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"delete","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-10304,-2864],"id":"7d3a21bf-8899-44bc-beab-8fd91212840e","name":"Apagar Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-3184],"id":"fdc64d42-c8b0-443e-89e6-5f3302af3ad0","name":"Mensagem Texto1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Audio","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2864],"id":"adb45536-8466-4e90-ab9b-62d3a182cbdb","name":"Mensagem Audio1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Imagem","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"f5c70ab5-7671-4bc8-9d23-65b8954ddb08","name":"MensagemImagem","value":"={{ $('Webhook').item.json.body.data.message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2704],"id":"8ed5d075-7555-4d7a-b0ac-0c2dfede763f","name":"Mensagem Imagem1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2864],"id":"fc455233-39ab-4955-a251-c8c0a56b6824","name":"Add Audio Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.Erro }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2368],"id":"6ce2a774-2168-4fbd-8f3c-8d90dcb0c661","name":"Add Error Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-11552,-2544],"id":"99221708-45d9-4842-87a6-a140d8007217","name":"Extract from File","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"11dc126a-e72e-431b-8db5-c78168c69439","name":"Erro","value":"<ErroFormatoMensagem>","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2368],"id":"bb8496ed-96ad-4791-8352-d1ddc8814b9a","name":"Mensagem Erro1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"=<ContextoPDF>\n  <TranscricaoPDF>\n{{ $json.text }}\n  </TranscricaoPDF>\nContexto Extra: O usuário encaminhou a mensagem a seguir junto ao PDF.\n  <MensagemUsuario>\n{{ $('Mensagem Documento PDF').item.json.MensagemDocumento }}\n  </MensagemUsuario>\n</ContextoPDF>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2544],"id":"54d607bf-91c1-4f34-91ea-6068ebe37bd3","name":"Add PDF Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"=<ContextoImagem>\n\n  <DetalheImagem>\n{{ $json.content }}\n  </DetalheImagem>\n\nContexto Extra: O usuário encaminhou a mensagem a seguir junto á imagem.\n  <MensagemUsuario>\n{{ $('Mensagem Imagem1').item.json.MensagemImagem }}\n  </MensagemUsuario>\n\n</ContextoImagem>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2704],"id":"0db30c4d-f1ab-401a-9d8c-81566344387a","name":"Add Imagem Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"AgenteStatus","key":"={{ $('Parametros Fluxo').item.json.IdAgente }}_status_{{ $('Dados Lead').item.json.IdConversa }}\n\n ","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-12752,-2832],"id":"1d9d6e11-6441-4cf9-9672-aa94927d0178","name":"Redis","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-10096,-2688],"id":"391e9bdc-76c5-470d-9574-d4df11c5f4d2","name":"No Operation, do nothing6","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"756ab323-31a2-4a59-92e8-c2c695027962","leftValue":"={{ $json.AgenteStatus }}","rightValue":"Desativado","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12544,-2832],"id":"e68977f3-c385-4190-a7a1-a085dc2e4555","name":"Bot Desativado?1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-12384,-3056],"id":"3c02e2fb-7b3e-49b3-a305-fa07e1831c96","name":"No Operation, do nothing"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Documento","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"003323ec-ffbe-4c91-b8b5-623466b5014d","name":"MensagemDocumento","value":"={{ $('Webhook').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2544],"id":"eaa320f1-f7a5-4674-831e-9ac37a4cae6b","name":"Mensagem Documento PDF","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"toBinary","sourceProperty":"Imagem","options":{"mimeType":"image/png"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-11776,-2704],"id":"02722221-c001-4e08-b361-3f4444f0ed9e","name":"Convert to File"},{"parameters":{"operation":"toBinary","sourceProperty":"Audio","options":{"mimeType":"audio/mp4"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-11776,-2864],"id":"13a57dbe-f63f-4c55-be71-76ce402ff747","name":"Convert to File1"},{"parameters":{"operation":"toBinary","sourceProperty":"Documento","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-11776,-2544],"id":"9ca7f566-f29f-4928-bec0-f98c10b20c69","name":"Convert to File2"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-3024],"id":"c4ea2375-b696-4bc7-9efa-ca60db3fa570","name":"Mensagem Texto2","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"66a91f66-e755-4120-b22f-44c814f56162","name":"message","value":"={{ $json.comando }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9728,-2864],"id":"3c9e8fbe-c213-4d8a-ad57-c5c165b4682a","name":"MensagemTraduzida","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"={{ $json.original }}  ","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-9168,-2864],"id":"a1825cfa-a7cf-480c-b3d9-4843ab28bbd8","name":"MenuCardapio33","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"01c2c18a-5148-4c7d-b5cd-72c66d6595a5","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"montagem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bbee0d48-e616-41a6-a91c-e9d13fef7158","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"finalizar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"33e40896-05b4-449e-a251-dfb584e1cf08","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"ajuda","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6320,-2880],"id":"e26e9f1b-5974-40ff-b1d1-a6dae18d904d","name":"If7"},{"parameters":{"jsCode":"   return [\n  {\n    acao: $('MergePedido').first().json.status  // ou o campo correto de saída\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6080,-2960],"id":"c72dcca2-5b3d-4f55-bc83-e4bfda5e4bcc","name":"MsgUsuario1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-5840,-2944],"id":"f1cc3901-1383-49f0-b817-db3067c74e21","name":"Merge2"},{"parameters":{"jsCode":"  // Entrada\n // Pega direto do node MensagemTraduzida\nconst texto = \"⏳ Aguarde..\\nVocê disse: \" + \n$('MensagemTraduzida').first().json.message;\n \n\n// Mapas\nconst normal = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n// 1) Fullwidth\nconst full = \"ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ\" +\n             \"ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ\" +\n             \"０１２３４５６７８９\";\n\n// 2) Small caps (maiúsculas pequenas)\nconst smallcaps = \"ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ\" +\n                  \"ᴀʙᴄᴅᴇꜰɢʜɪᴊᴋʟᴍɴᴏᴘǫʀsᴛᴜᴠᴡxʏᴢ\" +\n                  \"0123456789\";\n\n// 3) Circulado\nconst circ = \"ⒶⒷⒸⒹⒺⒻⒼⒽⒾⒿⓀⓁⓂⓃⓄⓅⓆⓇⓈⓉⓊⓋⓌⓍⓎⓏ\" +\n             \"ⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩ\" +\n             \"⓪①②③④⑤⑥⑦⑧⑨\";\n\n// 4) Quadrado (emoji-like)\nconst square = \"🄰🄱🄲🄳🄴🄵🄶🄷🄸🄹🄺🄻🄼🄽🄾🄿🅀🅁🅂🅃🅄🅅🅆🅇🅈🅉\" +\n               \"🄰🄱🄲🄳🄴🄵🄶🄷🄸🄹🄺🄻🄼🄽🄾🄿🅀🅁🅂🅃🅄🅅🅆🅇🅈🅉\" +\n               \"0123456789\";\n\nfunction converter(texto, mapa) {\n  const map = {};\n  for (let i = 0; i < normal.length; i++) {\n    map[normal[i]] = mapa[i];\n  }\n  return texto.split(\"\").map(ch => map[ch] || ch).join(\"\");\n}\n\nreturn {\n  original: \"```\\n\" + texto + \"\\n```\",\n  fullwidth: converter(texto, full),\n  smallcaps: converter(\"```\\n\" + texto + \"\\n```\", smallcaps),\n  circulado: converter(texto, circ),\n  quadrado: converter(texto, square)\n};\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-9392,-2864],"id":"a7d979a6-dd42-44d3-a606-5775cb3d0391","name":"Code10"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```O item  {{ $('Numero').item.json.numero }} º foi excluido do seu pedido com sucesso. \nNão se preocupe ele ja foi reorganizado.\nSe deseja concluir digite 4 ou fale concluir. ```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3936,-1664],"id":"1d4a1409-6078-42a5-8220-21190f843ead","name":"MenuCardapio36","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"operation":"executeQuery","query":"WITH ordenado AS (\n  SELECT \n    item_id,\n    user_id,\n    pedido_id,\n    ROW_NUMBER() OVER (PARTITION BY user_id, pedido_id ORDER BY item_id) AS nova_ordem\n  FROM item_pedido_temp\n)\nUPDATE item_pedido_temp i\nSET ordem_item = o.nova_ordem\nFROM ordenado o\nWHERE i.item_id = o.item_id\n  AND i.user_id = o.user_id\n  AND i.pedido_id = o.pedido_id \n   and i.user_id =  {{$('Merge1').item.json.user_id }} \n  and i.pedido_id =  {{ $('MergePedido').item.json.pedido_id }}   and i.id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3744,-1664],"id":"6e460694-3302-426c-a7f0-2ae9def2fff9","name":"OrdenaPedido1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" const frase = $('MensagemTraduzida').first().json.message || \"\";\n\n// categorias aceitas\nconst categorias = [\"pizza\", \"esfirra\", \"refrigerante\", \"cerveja\"];\n\n// Regex: \"consultar ...\" seguido de tudo\nconst match = frase.match(/^consultar\\s+(.+)$/i);\n\nlet categoria = null;\nlet nome = null;\n\nif (match) {\n  const partes = match[1].trim().toLowerCase().split(/\\s+/);\n  const primeira = partes[0];\n\n  if (categorias.includes(primeira)) {\n    categoria = primeira;\n    nome = partes.slice(1).join(\" \") || null;\n  } else {\n    // se a primeira palavra não é categoria conhecida, trata tudo como nome\n    categoria = null;\n    nome = match[1].trim().toLowerCase();\n  }\n} else {\n  // não começou com \"consultar\" → trata tudo como nome\n  categoria = null;\n  nome = frase.trim().toLowerCase();\n}\n\nreturn { categoria, nome };\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4400,-768],"id":"6a69579b-bf9a-4542-8d1d-0929bf630727","name":"ConsultarCardapio"},{"parameters":{"jsCode":" const frase = $('MensagemTraduzida').first().json.message || \"\";\n\nconst match = frase.match(/(?:item\\s*)?(\\d+)/i);\n\nreturn {\n  numero: match ? parseInt(match[1]) : null\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4464,-1664],"id":"d973d690-e779-46b4-acc6-37f0255d2439","name":"Numero"},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"item_pedido_temp","mode":"list","cachedResultName":"item_pedido_temp"},"deleteCommand":"delete","where":{"values":[{"column":"user_id","value":"= {{ $('Merge1').item.json.user_id }}"},{"column":"ordem_item","value":"={{ $('Numero').item.json.numero }}"},{"column":"pedido_id","value":"={{ $('MergePedido').item.json.pedido_id }}"},{"column":"id_empresa","value":"= {{ $('DadosEmpresa').item.json.id_empresa }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4096,-1664],"id":"39d401de-9b68-4eba-9f7b-bfa8777ec579","name":"Excluir Item","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"\n delete from item_pedido_temp as i using item_pedido_temp as  it\n where i.categoria = 'borda'           and\n       i.user_id= it.user_id           and\n       i.pedido_id= it.pedido_id       and\n       i.tamanho = it.tamanho          and\n       i.numero_fracao =it.numero      and \n       it.ordem_item =  {{ $json.numero }} and\n       i.user_id=  {{ $('Merge1').item.json.user_id }}  and\n       i.pedido_id= {{ $('MergePedido').item.json.pedido_id }}  and i.id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }}","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4272,-1664],"id":"ca45c967-6667-4424-84fd-2512d63c9c49","name":"ExcluiBorda","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" const input =  $input.first().json.messages[0]   || \"\";\n\n// 1) minúsculas\nlet clean = input.toLowerCase();\n\n// 2) remove moeda: \"r$\", \"r $\", \"$\"\nclean = clean.replace(/r\\s*\\$/gi, \"\").replace(/\\$/g, \"\");\n\n// 3) remove o \"r\" (ou qualquer letra) deixado ANTES de número/1/2: \"r 6\", \"r 1/2\"\nclean = clean.replace(/\\b[a-zà-ÿ]\\s+(?=(\\d|1\\/2)\\b)/gi, \"\");\n\n// 4) mantém só letras/números/espaço e \"/\" (tira resto de símbolos)\nclean = clean.replace(/[^0-9a-zà-ÿ\\s/,.]/g, \" \");\n\n// 5) normaliza plurais comuns\nclean = clean.replace(/\\bpizzas\\b/g, \"pizza\")\n             .replace(/\\besfirras\\b/g, \"esfirra\");\n\n// 6) palavras de quantidade -> número (antes de \"pizza\")\nclean = clean.replace(/\\b(uma|um)\\b(?=\\s+pizza\\b)/g, \"1\")\n             .replace(/\\b(duas|dois)\\b(?=\\s+pizza\\b)/g, \"2\")\n             .replace(/\\b(três|tres)\\b(?=\\s+pizza\\b)/g, \"3\");\n\n// 7) \"meia\" -> \"1/2\"\nclean = clean.replace(/\\bmeia\\b/g, \"1/2\");\n\n// 8) corrige \"6,19\" ou \"6.19\" -> \"1/2 19\"\nclean = clean.replace(/6[,.](\\d{1,2})\\b/g, \"1/2 $1\");\n\n// 9) padrão da transcrição \"6 14 e 6 19\" -> \"1 pizza 1/2 14 e 1/2 19\"\nclean = clean.replace(/\\b6\\s+(\\d{1,2})(?:\\s*[,;]?\\s*e\\s*)6\\s+(\\d{1,2})\\b/g, \"1 pizza 1/2 $1 e 1/2 $2\");\n\n// 10) remove vírgulas/pontos remanescentes que grudem nos números (ex.: \"17,\" -> \"17\")\nclean = clean.replace(/[,.]/g, \" \");\n\n \n\n// 12) compacta espaços\nclean = clean.replace(/\\s+/g, \" \").trim();\n\nreturn { original: input, comando_normalizado: clean };\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-10144,-2864],"id":"4ce2f977-52ac-4d94-8def-766acc0b9a8f","name":"Normalizador"},{"parameters":{"jsCode":" const input = $input.first().json.comando_normalizado || $input.first().json.message || \"\";\nlet clean = input.toLowerCase().trim();\nlet tokens = clean.split(/\\s+/);\n\n// Mapa de palavras para números (quando a 1ª palavra é quantidade)\nconst mapaQtd = { \"uma\":\"1\", \"um\":\"1\", \"duas\":\"2\", \"dois\":\"2\", \"três\":\"3\", \"tres\":\"3\", \"quatro\":\"4\", \"cinco\":\"5\" };\nif (mapaQtd[tokens[0]]) {\n  tokens[0] = mapaQtd[tokens[0]];\n  clean = tokens.join(\" \");\n}\n\n// Normaliza plural básico (caso o pré-LLM não tenha feito)\nif (tokens[1] === \"pizzas\") {\n  tokens[1] = \"pizza\";\n  clean = tokens.join(\" \");\n}\n\n// Resposta padrão (com sugestão educada)\nlet resultado = {\n  original: input,\n  comando: clean,\n  valido: false,\n  tipo: null,\n  erro: \"não entendi seu comando\",\n  sugestao: `O seu pedido ou comando não foi identificado. Você quis dizer: ${clean} ?`\n};\n\n// --- Caso 1: Pizza inteira ---\n// \"1 pizza 14\", \"1 pizza mussarela grande\"\nif (\n  tokens.length >= 3 &&\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"pizza\" &&\n  !tokens.includes(\"1/2\")\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"pizza_inteira\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 2: Pizza fracionada ---\n// \"1 pizza 1/2 14 e 1/2 19\"  (aceita nomes no lugar de números)\nelse if (\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"pizza\" &&\n  tokens.filter(t => t === \"1/2\").length === 2\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"pizza_fracionada\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 3: Esfirra ---\n// \"1 esfirra carne\"\nelse if (\n  tokens.length >= 3 &&\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"esfirra\"\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"esfirra\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 4: Bebida ---\n// \"1 coca cola 2l\", \"2 guarana 350ml\", \"1 água 500ml\", \"1 heineken long neck\"\nelse if (\n  /^\\d+$/.test(tokens[0]) &&\n  /\\b(coca(?:\\s+cola)?|cola|guaran[áa]|heineken|bud(?:weiser)?|cerveja|agua|água|fanta|sprite)\\b/.test(clean)\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"bebida\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 5: Adicionar ingrediente ---\n// \"adicionar mussarela item 1\", \"adicionar ingrediente cheddar ao item 3\"\nelse if (\n  tokens[0] === \"adicionar\" &&\n  tokens.includes(\"item\")\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"adicionar_item\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 6: Excluir item ---\n// \"excluir item 1\", \"excluir 2\"\nelse if (\n  tokens[0] === \"excluir\" &&\n  (\n    (tokens[1] === \"item\" && /^\\d+$/.test(tokens[2])) ||\n    (/^\\d+$/.test(tokens[1]))\n  )\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"excluir_item\",\n    acao: \"excluir_item\"\n  };\n}\n\nreturn resultado;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-9984,-2864],"id":"632e31a0-3d32-4cfe-85e4-1c8d888df371","name":"Validador"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MontPedido').item.json.chatInput }}","user_id":"={{ $('MontPedido').item.json.user_id }}","pedido_id":"={{ $('MontPedido').item.json.pedido_id }}","rotina":1,"telefone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('telefone', `telefone`, 'string') }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3280,-3328],"id":"e551d0cf-42ec-40ad-b56e-a325608a83f9","name":"Call n8n Workflow Tool"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3056,-3472],"id":"ecc73e8a-67fa-44e6-a12f-38b93f782237","name":"No Operation, do nothing22","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","pedido_id":"={{ $('MergePedido').item.json.pedido_id }} ","rotina":2,"telefone":"={{ $('Dados Lead').item.json.IdConversa }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-2784,-3808],"id":"947732ed-0e9b-40a9-86a7-0b9504b1667e","name":"Call n8n Workflow Tool2"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2608,-4000],"id":"6d22bbcd-92ff-4c34-95b9-453cceec19bd","name":"No Operation, do nothing25","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3872,-2416],"id":"43b02b8e-1bd1-4e06-bc97-fecc112a59fc","name":"No Operation, do nothing23","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":3,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4144,-2320],"id":"e0bb82a0-8651-4d59-a214-b2d04ea5ce24","name":"ExecutaMontagem"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3648,-3168],"id":"efe458be-f7e1-4061-81c3-a24592a02666","name":"No Operation, do nothing29","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":4,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3888,-3008],"id":"c7a5c228-3f27-479b-a0e4-41485560fc58","name":"ExecutaMontagem1"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3760,-2832],"id":"b20f7959-aa3a-4f0d-9089-49a9aadb3184","name":"No Operation, do nothing30","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":5,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4000,-2656],"id":"b8efc517-a580-4312-80e4-ba9807ef8283","name":"ExecutaMontagem2"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é montar sua pizza com suas pizzas que possuem varias opções.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4144,-2832],"id":"fc2897b5-6613-4d9e-b314-2b487b4a744f","name":"Atendimento Ajuda","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é chamar o fluxo gerador de itens do carrinho. \n\nUse no telefone   {{ $json.telefone }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-3424,-3472],"id":"74202dcd-9d93-4b77-adc1-999eef2b7879","name":"Criar Pedido","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é montar sua pizza com suas pizzas que possuem varias opções.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4048,-3168],"id":"b93a2a63-711e-4b57-92fa-d43ed5a06cee","name":"Carrinho1","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Executa a montagem de de pedido com mais de uma opção "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4304,-2432],"id":"d1741377-a950-4de1-b042-cb61dadbb8df","name":"Montagem","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usuário para o agente","height":732,"width":1492,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-6912,-3120],"id":"0c90d6ac-3835-4b31-bba2-feeb8b1fae3e","name":"Sticky Note17"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3216,-1664],"id":"971e4ba9-1ad3-4972-951b-307f7ea7eb66","name":"No Operation, do nothing31","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":4,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3424,-1488],"id":"e3a092a0-9586-477f-97f4-5e1170b6ced6","name":"ExecutaMontagem3"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é montar sua pizza com suas pizzas que possuem varias opções.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-3568,-1664],"id":"b08b4e89-d2ef-4074-8b00-3e9ce3bc908c","name":"Carrinho2","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-4000,-1136],"id":"cd9b172e-2ec8-4644-b489-6bc46938655c","name":"No Operation, do nothing10","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```🚀 Saindo do modo ajuda. \n    Agora você pode continuar normalmente com seu pedido.```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-4224,-1136],"id":"4ab3b7da-5623-4c44-9ae5-d2a8e5db3994","name":"MenuCardapio1","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é chamar o fluxo gerador de itens do carrinho. \n\nUse no telefone  {{ $('Dados Lead').item.json.IdConversa }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2928,-4000],"id":"c398f198-d02d-4d71-a334-3f96f5d3b6e0","name":"Fechamento","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='finalizar'  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and \nid_empresa = {{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3600,-4256],"id":"9ad9530e-1936-40a4-95ef-c82fe9aeee06","name":"Finalizar","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='ajuda'  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and status <> 'ajuda' and id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4352,-2832],"id":"599d6404-5f82-4569-bf95-6139fa784838","name":"Ajuda","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3104,240],"id":"3ac0dfe6-cd3a-4181-bc65-90d76adc3a13","name":"No Operation, do nothing32","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"jsCode":" return [\n  {\n    json: {\n      memoryKey: $input.first().json.telefone || $input.first().json.fone  ||  $input.first().json.contato?.telefone\n    }\n  }\n];\n\n\n\n  "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4464,160],"id":"cc4bea2b-67c4-463d-a013-9c5d1f50db73","name":"MemoryKey"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"50fdf9df-620d-483e-b114-bb3d9dc1caea","leftValue":"={{ $json.status }}","rightValue":"finalizar","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3728,-4000],"id":"02593f39-6e82-4fca-8950-38fae18eda26","name":"If1"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","pedido_id":"={{ $('MergePedido').item.json.pedido_id }} ","rotina":4,"telefone":"={{ $('Dados Lead').item.json.IdConversa }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3168,-4080],"id":"eefd14fc-9ab5-46d9-8276-310548c575eb","name":"Call n8n Workflow Tool3"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é chamar o fluxo gerador de itens do carrinho. \n\nUse no telefone  {{ $('Dados Lead').item.json.IdConversa }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-3344,-4256],"id":"576f0b5d-8117-49e9-8754-9b84f50f1665","name":"ChamaPrecarrinho","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"operation":"get","tableId":"pedido_temp","filters":{"conditions":[{"keyName":"user_id","keyValue":"={{ $('Merge1').item.json.user_id }}"},{"keyName":"pedido_id","keyValue":"={{ $('MergePedido').item.json.pedido_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-3968,-4000],"id":"473e979b-7688-4841-82b6-47c0fef1ba4d","name":"StatusPedido","credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"92b4a80f-9642-42ba-9d5b-534e35757324","leftValue":"={{ $json.count }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-4272,-3824],"id":"91e250ba-4502-41a2-aeac-6b6d02de9c9e","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3712,-3808],"id":"8f0e6375-3ac7-45e7-b86d-9040b16f3c26","name":"No Operation, do nothing33","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= ```🛒Seu carrinho esta vazio.```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3984,-3808],"id":"e99f9066-b093-432c-b7b7-7ebcf559c716","name":"MenuCardapio34","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"content":"##  Fechamento\nFechamento de um pedido de cliente","height":632,"width":2276},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4576,-4256],"id":"eed5f410-f8b0-4da9-8f9c-357b6792beb1","name":"Sticky Note20"},{"parameters":{"content":"##  Criar um novo pedido \nCriar um novo pedido ou vários pedidos de um cliente","height":264,"width":2276,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4560,-3504],"id":"4b30bcc2-f629-4b12-af89-6b6d4ceaa505","name":"Sticky Note21"},{"parameters":{"content":"## Carrinho\nCliente solicita vizualizar carrinho.","height":264,"width":1220,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4576,-3200],"id":"d3ee1260-5ed5-45f0-8c25-3b4bbaeb7ffa","name":"Sticky Note24"},{"parameters":{"content":"##  Atendimento frente de loja\nAjuda cliente com suas dúvidas","height":328,"width":1236,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4592,-2880],"id":"aa25654e-292c-494d-8525-d9454b0c77c8","name":"Sticky Note25"},{"parameters":{"content":"##  Montagem\nCliente solicitou itens com varias opções","height":264,"width":1220,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4576,-2480],"id":"b8ab0ca2-6eb8-4481-bc0c-8a66b0443f0b","name":"Sticky Note26"},{"parameters":{"content":"##  Cancelar Pedido\nCancelar um pedido","height":264,"width":1220,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4560,-2128],"id":"5b7c2c4d-0f16-4550-851e-f649746e39e8","name":"Sticky Note27"},{"parameters":{"content":"##  Consular e escolher Opções\nCancelar um pedido","height":456,"width":1284,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4576,-864],"id":"cb543947-c683-4e96-aacd-fbfaea0e22e7","name":"Sticky Note28"},{"parameters":{"content":"##  Cancelar Item   Pedido\nCancelar um item pedido","height":456,"width":1620,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4592,-1792],"id":"16496942-24b4-471e-ab24-c19dffdae560","name":"Sticky Note29"},{"parameters":{"content":"##  Sair\nSair do Modo Ajuda ou voltar para compras","height":264,"width":1220,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4560,-1200],"id":"bf83d31c-301f-4c2f-a65d-c12ec566e21a","name":"Sticky Note30"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usuário para o agente","height":1084,"width":1988,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12528,-3248],"id":"dd9a9f30-3d8f-4179-acda-f6a814da4bc7","name":"Sticky Note11"},{"parameters":{"content":"Ajuste tempos de buffer e inatividade do agente conforme necessidade.\n","height":968,"width":1822,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12448,-3184],"id":"0f6f768f-d600-4954-b21f-2b979d6a1fff","name":"Sticky Note19"},{"parameters":{"operation":"executeQuery","query":"select count(*)::INT  from item_pedido_temp  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and \nid_empresa = {{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4480,-3824],"id":"d494fd20-b48a-4bb7-ada8-5329c73d731e","name":"VerificaCarrinhoVazio","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=``` Dica! Faça sua escolha via números, é mais assertivo.  \n Qual opção você escolhe? Monte já o seu pedido.```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3296,240],"id":"67319f38-b933-4bfd-b8d9-4d418d84e256","name":"MenuCardapio42","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"operation":"executeQuery","query":"select  id_empresa::int  from empresa_telefones where telefone = '{{ $json.telefoneEmpresa }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-13136,-2832],"id":"def9e1c8-bb52-4340-a4b7-be40f48109f5","name":"Execute a SQL query1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"assignments":{"assignments":[{"id":"ae27ddc3-121b-470f-a83c-a7b53f38c0da","name":"id_empresa","value":"={{ $json.id_empresa }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12928,-2832],"id":"2b58e198-7fc5-48b9-addc-3535149404fc","name":"DadosEmpresa"},{"parameters":{"operation":"executeQuery","query":"select * from grava_intencao_opcao ({{ $('Merge1').item.json.user_id }} ,{{ $('MergePedido').item.json.pedido_id }}  , {{ $('DadosEmpresa').item.json.id_empresa }}   , '{{ $json.nome }}'    );\n   \n  ","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4224,-768],"id":"80c7c2e4-1741-45aa-ae1d-eada3262d482","name":"Intenções","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```{{ $json.linha }}```","options_message":{"delay":5}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3504,240],"id":"39b61581-476d-4546-868d-665229783774","name":"CardapioConsulta","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"=Conversational","remoteJid":"= {{ $('Dados Lead').item.json.IdConversa }}","messageText":"= {{ $json['output.mensagens'] }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-3808,240],"id":"104b37e5-52e3-480e-be14-81ab37be6bee","name":"MenuCardapio13","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"= ```{{ $json.linha }}``` ```\n Dica! Faça sua escolha via números, é mais assertivo.  \n Qual opção você escolhe? Monte já o seu pedido.```","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":6,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3888,-592],"id":"529bdd63-99e8-483f-b792-02ffe58fdc9e","name":"ExecutaMontagem4"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo é montar sua pizza com suas pizzas que possuem varias opções.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-4032,-768],"id":"40313d54-5627-421f-88ef-e46e0bc4fd16","name":"Carrinho","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3680,-768],"id":"e61fdaec-e5df-408e-8490-5f80b5a26585","name":"No Operation, do nothing7","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"update  pedido_temp \n  set status ='enviado'\n  where  \n        user_id=  {{ $('Merge1').item.json.user_id }}  and\n        pedido_id= {{ $('MergePedido').item.json.pedido_id }}  and     id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }}   \n ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-4432,-1136],"id":"968e0599-f9cf-4317-acb1-4e00f9ab5a1e","name":"SairAjuda","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}}],"connections":{"Encontrar Cliente1":{"main":[[{"node":"Cliente Existe?1","type":"main","index":0}]]},"Cliente Existe?1":{"main":[[{"node":"Concatena","type":"main","index":0}],[{"node":"Criar Cliente1","type":"main","index":0}]]},"Criar Cliente1":{"main":[[{"node":"Concatena","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"EncontrarPedido","type":"main","index":0}]]},"Dados Lead":{"main":[[{"node":"Execute a SQL query1","type":"main","index":0}]]},"Parametros Fluxo":{"main":[[{"node":"Filtro Inicial1","type":"main","index":0}]]},"Concatena":{"main":[[{"node":"Merge1","type":"main","index":0}],[{"node":"Merge1","type":"main","index":1}]]},"Filtro Inicial1":{"main":[[{"node":"Dados Lead","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Menu","type":"ai_languageModel","index":0}]]},"MsgUsuario":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"Switch":{"main":[[{"node":"CancelarPedido","type":"main","index":0}],[{"node":"VerificaCarrinhoVazio","type":"main","index":0}],[{"node":"ExcluiRejeitados","type":"main","index":0}],[{"node":"ExcluiRejeitados1","type":"main","index":0}],[{"node":"Ajuda","type":"main","index":0}],[{"node":"Montagem","type":"main","index":0}],[{"node":"MenuCardapio","type":"main","index":0}],[{"node":"Ajuda","type":"main","index":0}],[{"node":"ConsultarCardapio","type":"main","index":0}],[{"node":"Numero","type":"main","index":0}],[{"node":"SairAjuda","type":"main","index":0}],[{"node":"ConsultarCardapio","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Parametros Fluxo","type":"main","index":0}]]},"Menu":{"main":[[{"node":"If7","type":"main","index":0}]]},"ExcluiRejeitados":{"main":[[{"node":"MenuCardapio15","type":"main","index":0}]]},"Cliente Pedido":{"main":[[{"node":"MergePedido","type":"main","index":0}],[{"node":"CriaPedido","type":"main","index":0}]]},"EncontrarPedido":{"main":[[{"node":"Cliente Pedido","type":"main","index":0}]]},"CriaPedido":{"main":[[{"node":"MergePedido","type":"main","index":1}]]},"MergePedido":{"main":[[{"node":"Menu","type":"main","index":0}]]},"CancelarPedido":{"main":[[{"node":"If5","type":"main","index":0}]]},"If2":{"main":[[{"node":"IniciaAtendimento","type":"main","index":0}],[{"node":"AtendimentoEnviado","type":"main","index":0}]]},"IniciaAtendimento":{"main":[[]]},"AtendimentoEnviado":{"main":[[]]},"Acao":{"main":[[{"node":"Switch","type":"main","index":0}]]},"If5":{"main":[[{"node":"MenuCardapio23","type":"main","index":0}],[{"node":"MenuCardapio24","type":"main","index":0}]]},"MontPedido":{"main":[[{"node":"Code2","type":"main","index":0}]]},"ExcluiRejeitados1":{"main":[[{"node":"Carrinho1","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Criar Pedido","type":"main","index":0}]]},"MenuCardapio":{"main":[[{"node":"No Operation, do nothing9","type":"main","index":0}]]},"MenuCardapio15":{"main":[[{"node":"MontPedido","type":"main","index":0}]]},"MenuCardapio23":{"main":[[{"node":"No Operation, do nothing2","type":"main","index":0}]]},"MenuCardapio24":{"main":[[{"node":"No Operation, do nothing21","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Mensagem Texto1","type":"main","index":0}],[{"node":"Mensagem Texto2","type":"main","index":0}],[{"node":"Mensagem Audio1","type":"main","index":0}],[{"node":"Mensagem Imagem1","type":"main","index":0}],[{"node":"Mensagem Documento PDF","type":"main","index":0}],[{"node":"Mensagem Erro1","type":"main","index":0}]]},"Transcrever Áudio1":{"main":[[{"node":"Add Audio Buffer1","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"Add Imagem Buffer1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Buffer 3","type":"main","index":0}]]},"ComparandoMensagens1":{"main":[[{"node":"Apagar Buffer1","type":"main","index":0}],[{"node":"No Operation, do nothing6","type":"main","index":0}]]},"Buffer ":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Buffer 3":{"main":[[{"node":"ComparandoMensagens1","type":"main","index":0}]]},"Add Texto Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Apagar Buffer1":{"main":[[{"node":"Normalizador","type":"main","index":0}]]},"Mensagem Texto1":{"main":[[{"node":"Add Texto Buffer1","type":"main","index":0}]]},"Mensagem Audio1":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Mensagem Imagem1":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Add Audio Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Add Error Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Add PDF Buffer1","type":"main","index":0}]]},"Mensagem Erro1":{"main":[[{"node":"Add Error Buffer1","type":"main","index":0}]]},"Add PDF Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Add Imagem Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Redis":{"main":[[{"node":"Bot Desativado?1","type":"main","index":0}]]},"Bot Desativado?1":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"Switch1","type":"main","index":0}]]},"Mensagem Documento PDF":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"Transcrever Áudio1","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Mensagem Texto2":{"main":[[{"node":"Add Texto Buffer1","type":"main","index":0}]]},"MensagemTraduzida":{"main":[[{"node":"Code10","type":"main","index":0}]]},"No Operation, do nothing6":{"main":[[]]},"MenuCardapio33":{"main":[[{"node":"Encontrar Cliente1","type":"main","index":0}]]},"If7":{"main":[[{"node":"MsgUsuario1","type":"main","index":0}],[{"node":"MsgUsuario","type":"main","index":0}]]},"MsgUsuario1":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Acao","type":"main","index":0}]]},"Code10":{"main":[[{"node":"MenuCardapio33","type":"main","index":0}]]},"MenuCardapio36":{"main":[[{"node":"OrdenaPedido1","type":"main","index":0}]]},"OrdenaPedido1":{"main":[[{"node":"Carrinho2","type":"main","index":0}]]},"ConsultarCardapio":{"main":[[{"node":"Intenções","type":"main","index":0}]]},"Numero":{"main":[[{"node":"ExcluiBorda","type":"main","index":0}]]},"Excluir Item":{"main":[[{"node":"MenuCardapio36","type":"main","index":0}]]},"ExcluiBorda":{"main":[[{"node":"Excluir Item","type":"main","index":0}]]},"Normalizador":{"main":[[{"node":"Validador","type":"main","index":0}]]},"Validador":{"main":[[{"node":"MensagemTraduzida","type":"main","index":0}]]},"Call n8n Workflow Tool":{"ai_tool":[[{"node":"Criar Pedido","type":"ai_tool","index":0}]]},"Call n8n Workflow Tool2":{"ai_tool":[[{"node":"Fechamento","type":"ai_tool","index":0}]]},"ExecutaMontagem":{"ai_tool":[[{"node":"Montagem","type":"ai_tool","index":0}]]},"ExecutaMontagem1":{"ai_tool":[[{"node":"Carrinho1","type":"ai_tool","index":0}]]},"ExecutaMontagem2":{"ai_tool":[[{"node":"Atendimento Ajuda","type":"ai_tool","index":0}]]},"Atendimento Ajuda":{"main":[[{"node":"No Operation, do nothing30","type":"main","index":0}]]},"Criar Pedido":{"main":[[{"node":"No Operation, do nothing22","type":"main","index":0}]]},"Carrinho1":{"main":[[{"node":"No Operation, do nothing29","type":"main","index":0}]]},"Montagem":{"main":[[{"node":"No Operation, do nothing23","type":"main","index":0}]]},"ExecutaMontagem3":{"ai_tool":[[{"node":"Carrinho2","type":"ai_tool","index":0}]]},"Carrinho2":{"main":[[{"node":"No Operation, do nothing31","type":"main","index":0}]]},"MenuCardapio1":{"main":[[{"node":"No Operation, do nothing10","type":"main","index":0}]]},"Fechamento":{"main":[[{"node":"No Operation, do nothing25","type":"main","index":0}]]},"Finalizar":{"main":[[{"node":"ChamaPrecarrinho","type":"main","index":0}]]},"Ajuda":{"main":[[{"node":"Atendimento Ajuda","type":"main","index":0}]]},"MemoryKey":{"main":[[]]},"Call n8n Workflow Tool3":{"ai_tool":[[{"node":"ChamaPrecarrinho","type":"ai_tool","index":0}]]},"If1":{"main":[[{"node":"Finalizar","type":"main","index":0}],[{"node":"Fechamento","type":"main","index":0}]]},"ChamaPrecarrinho":{"main":[[{"node":"Fechamento","type":"main","index":0}]]},"StatusPedido":{"main":[[{"node":"If1","type":"main","index":0}]]},"If6":{"main":[[{"node":"StatusPedido","type":"main","index":0}],[{"node":"MenuCardapio34","type":"main","index":0}]]},"MenuCardapio34":{"main":[[{"node":"No Operation, do nothing33","type":"main","index":0}]]},"VerificaCarrinhoVazio":{"main":[[{"node":"If6","type":"main","index":0}]]},"MenuCardapio42":{"main":[[{"node":"No Operation, do nothing32","type":"main","index":0}]]},"Execute a SQL query1":{"main":[[{"node":"DadosEmpresa","type":"main","index":0}]]},"DadosEmpresa":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Intenções":{"main":[[{"node":"Carrinho","type":"main","index":0}]]},"CardapioConsulta":{"main":[[{"node":"MenuCardapio42","type":"main","index":0}]]},"MenuCardapio13":{"main":[[]]},"ExecutaMontagem4":{"ai_tool":[[{"node":"Carrinho","type":"ai_tool","index":0}]]},"Carrinho":{"main":[[{"node":"No Operation, do nothing7","type":"main","index":0}]]},"SairAjuda":{"main":[[{"node":"MenuCardapio1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.lglducci.com.br","user-agent":"axios/1.7.7","content-length":"945","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"159.69.117.195","cf-ipcountry":"DE","cf-ray":"985dad7eb8f9194b-FRA","cf-visitor":"{\"scheme\":\"https\"}","content-type":"application/json","x-forwarded-for":"162.158.95.219","x-forwarded-host":"n8n.lglducci.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"traefik_traefik.1","x-real-ip":"162.158.95.219"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"delivery","data":{"key":{"remoteJid":"5516992975836@s.whatsapp.net","fromMe":false,"id":"3EB08C8142322D2745E73A"},"pushName":"Luis Gustavo Landucci","message":{"conversation":"consultar mussarela","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"qsa2uhWhGgSvcA==","senderTimestamp":"1758670683","senderAccountType":"E2EE","receiverAccountType":"E2EE","recipientKeyHash":"tPXKkPhX8YIDCg==","recipientTimestamp":"1757207594"},"deviceListMetadataVersion":2,"messageSecret":"ahc0eGkmr8A8WcJcShaLjgCyWKl1hZVa/+tPKWkxghI="}},"messageType":"conversation","messageTimestamp":1759004174,"instanceId":"4dd4c0e0-99c0-4837-ad50-a467024f723a","source":"web"},"destination":"https://n8n.lglducci.com.br/webhook-test/agente_delivery","date_time":"2025-09-27T17:16:15.101Z","sender":"5516991216319@s.whatsapp.net","server_url":"https://evolution.lglducci.com.br","apikey":"61E902EA720B-492E-9768-BE78CE95B224"},"webhookUrl":"https://webhook.lglducci.com.br/webhook-test/agente_delivery","executionMode":"test"}}]},"versionId":"530a2ab3-9d1c-4234-9efb-e07612d859c2","triggerCount":1,"shared":[{"createdAt":"2025-09-07T00:48:12.031Z","updatedAt":"2025-09-07T00:48:12.031Z","role":"workflow:owner","workflowId":"9WftJMMBMRPnj8NP","projectId":"wFRMrac2003Pl1x6"}],"tags":[{"createdAt":"2025-09-07T00:48:06.709Z","updatedAt":"2025-09-07T00:48:06.709Z","id":"oyXqUAJNw26h8Z5c","name":"github"}]}