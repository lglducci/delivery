{"createdAt":"2025-09-07T00:48:12.031Z","updatedAt":"2025-11-11T12:15:28.531Z","id":"9WftJMMBMRPnj8NP","name":"Delivery","active":true,"isArchived":false,"nodes":[{"parameters":{"content":"## Formatos Base64\nBase64 √© uma forma de codificar dados bin√°rios como texto. Dependendo do tipo de arquivo, os prefixos variam para indicar o formato do dado. Aqui est√£o alguns dos formatos mais comuns com os respectivos prefixos base64:\n\n### 1. **Imagem**\n   - **PNG**: `data:image/png;base64,`\n   - **JPEG**: `data:image/jpeg;base64,`\n   - **GIF**: `data:image/gif;base64,`\n   - **SVG**: `data:image/svg+xml;base64,`\n   - **BMP**: `data:image/bmp;base64,`\n   \n### 2. **√Åudio**\n   - **MP3**: `data:audio/mp3;base64,`\n   - **WAV**: `data:audio/wav;base64,`\n   - **OGG**: `data:audio/ogg;base64,`\n   - **MPEG**: `data:audio/mpeg;base64,`\n\n### 3. **V√≠deo**\n   - **MP4**: `data:video/mp4;base64,`\n   - **OGG**: `data:video/ogg;base64,`\n   - **WebM**: `data:video/webm;base64,`\n\n### 4. **Texto**\n   - **Plain Text**: `data:text/plain;base64,`\n   - **HTML**: `data:text/html;base64,`\n   - **CSS**: `data:text/css;base64,`\n   - **JavaScript**: `data:text/javascript;base64,`\n   - **CSV**: `data:text/csv;base64,`\n\n### 5. **Documentos**\n   - **PDF**: `data:application/pdf;base64,`\n   - **JSON**: `data:application/json;base64,`\n   - **ZIP**: `data:application/zip;base64,`\n   - **XML**: `data:application/xml;base64,`\n\nEsses s√£o exemplos de prefixos que podem ser usados ao incluir dados base64 em documentos ou aplica√ß√µes.","height":1166,"width":593,"color":7},"id":"0d958084-a113-4052-aee2-de6c6fa7cec7","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-11808,-4976]},{"parameters":{"content":"## MimeTypes\nO Mime type √© o mecanismo para especificar o tipo de documento.\nA estrutura de um MIME type √© muito simples; Consiste de um tipo e um subtipo, separados por um '/', onde nenhum espa√ßo √© permitido. \nO tipo representa a categoria. \nO subtipo √© espec√≠fico para cada tipo.\n\n### 1. **image**\nRepresenta qualquer tipo de imagens\n- image/gif\n- image/png\n- image/jpeg\n- image/bmp\n- image/webp\n   \n\n### 2. **audio**\nRepresenta qualquer tipo de arquivo de audio\n- audio/midi\n- audio/mpeg\n- audio/webm\n- audio/ogg\n- audio/wav\n- audio/mp3\n- audio/mp4\n\n### 3. **video**\nRepresenta qualquer tipo de arquivo de video\n- video/webm\n- video/ogg\n- video/mp4\n\n### 4. **text**\nRepresenta qualquer documento que contenha texto\n- text/plain\n- text/csv\n- text/html\n- text/css\n- text/javascript\n\n### 5. **application**\nRepresenta qualquer tipo de dados bin√°rios.\n- application/octet-stream\n- application/pkcs12\n- application/vnd.mspowerpoint\n- application/xhtml+xml\n- application/xml\n- application/pdf3","height":1166,"width":593,"color":7},"id":"10ec2d92-d29f-4ccb-8b61-9fe2a4e94152","name":"Sticky Note16","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12496,-4944]},{"parameters":{"operation":"get","tableId":"usuario","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $('Dados Lead').item.json.IdConversa.trim() }}"},{"keyName":"id_empresa","keyValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"fd74557b-efb4-4866-b238-5a289fad9db1","name":"Encontrar Cliente1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-9168,-2880],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.user_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"fb3b0daa-e714-4e73-aebb-e85b69d69450","name":"Cliente Existe?1","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-8944,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"tableId":"usuario","fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $('Dados Lead').item.json.LeadNome }}"},{"fieldId":"telefone","fieldValue":"={{ $('Dados Lead').item.json.IdConversa.trim() }}"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"1b5e7d3e-9428-4d1b-8a4d-5dbb011857f9","name":"Criar Cliente1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8800,-2624],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"id":"84187afa-bb28-469f-9c03-995d71927873","name":"Merge1","type":"n8n-nodes-base.merge","typeVersion":3,"position":[-8384,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"## Gatilho\nChat Trigger, WhatsApp, Instagram, Telegram, Messenger, etc..","height":572,"width":340,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14704,-3072],"id":"eb429214-fc7b-4a4e-a2b1-c5b7c26c1192","name":"Sticky Note2"},{"parameters":{"content":"## Vari√°veis do Fluxo\nCentral de controle do workflow","height":540,"width":326,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14272,-3056],"id":"b59d016e-fc5f-4ac9-9cc0-7e2ef7531382","name":"Sticky Note3"},{"parameters":{"content":"## Filtros Iniciais\nPara evitar que fluxo seja executado quando n√£o queremos","height":572,"width":340,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-13904,-3072],"id":"04a1a72f-535a-47bc-a657-addedd7b9dda","name":"Sticky Note4"},{"parameters":{"content":"## Dados do Lead\nInforma√ß√µes principais sobre o lead","height":540,"width":708,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1424,-9504],"id":"94809f73-f208-408a-8030-03ee63c3cac9","name":"Sticky Note5"},{"parameters":{"content":"## Registro do Lead no banco de dados (Supabase)\nFluxo para adi√ß√£o do lead no banco de dados postgrees supabase.","height":684,"width":2536,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-9472,-3088],"id":"890bd5a2-c1d4-4fa0-a4f2-a395a911981b","name":"Sticky Note7"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usu√°rio para o agente","height":684,"width":836,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-10400,-3056],"id":"7a05b218-9871-4390-94a6-0498f5347e9f","name":"Sticky Note10"},{"parameters":{"assignments":{"assignments":[{"id":"9f488c5c-0b3b-48e9-87b1-5a22d513d1ec","name":"IdConversa","value":"={{ $('Webhook').item.json.body.data.key.remoteJid.replace(\"@s.whatsapp.net\",\"\") }}","type":"string"},{"id":"69f6217f-9063-423f-abf4-e94f6b70f94e","name":"LeadNome","value":"= {{ $('Webhook').item.json.body.data.pushName }}","type":"string"},{"id":"6ba1d721-f125-47fb-ad7b-194cc478a856","name":"input_usuario","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"ba4188f4-3672-477b-a776-7eadc863140c","name":"mensagem_usuario","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"33d4eb69-2991-4188-8b18-2ac04b7b2f74","name":"telefoneEmpresa","value":"={{ $('Webhook').item.json.body.sender.replace(\"@s.whatsapp.net\",\"\") }}","type":"string"},{"id":"8231bcd2-8b3a-460a-b0ea-2b933a6b9804","name":"instance","value":"={{ $('Webhook').item.json.body.instance }}","type":"string"},{"id":"198cfcfe-5eea-41f8-80a8-09aaeef5e6e5","name":"apikey","value":"={{ $('Webhook').item.json.body.apikey }}","type":"string"}]},"options":{}},"id":"53c8acbc-ba50-48b3-bf41-d38b775ec224","name":"Dados Lead","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-13376,-2832],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"Ajustes os filtros necess√°rios conforme seu gatilho de entrada","height":280,"width":190,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-13840,-2912],"id":"e843f8bf-2eec-48d5-9226-943feabbca98","name":"Sticky Note1"},{"parameters":{"content":"Ajuste tempos de buffer e inatividade do agente conforme necessidade.\n","height":280,"width":190,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-14192,-2928],"id":"ad6061d4-0095-45da-ab5c-c9f2e3fe112a","name":"Sticky Note18"},{"parameters":{"assignments":{"assignments":[{"id":"3bdce7b6-d0f1-442c-aafd-8cd123aa21b6","name":"EsperaBuffer","value":1,"type":"number"},{"id":"c38e8985-4494-40a4-878e-f25467849842","name":"TempoInatividadeAgente","value":150,"type":"number"},{"id":"ac619a5e-1438-4e19-aaf5-21dfcbc32312","name":"ModeloTemperatura","value":0.4,"type":"number"},{"id":"cd3b0a32-e454-406e-84ad-b5efedc9c545","name":"empresa","value":"1","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-14160,-2832],"id":"9697cba7-4df2-455a-aa8b-13767473f3ea","name":"Parametros Fluxo","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/?utm_source=template-n8n","height":126,"width":593,"color":7},"id":"081fe256-d0e1-4fa9-8dac-860bcc2dfa32","name":"Sticky Note23","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-11808,-3792]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"00d2650d-52f9-4bf5-9b50-ec548c105222","leftValue":"={{ $json.lead_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-8592,-2880],"id":"d5eb91a0-faf4-4aa2-affa-0f6e3ae14efe","name":"Concatena"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"204f54b0-e3ed-4ff4-8302-8c20d3b8aa78","leftValue":"={{ $('Webhook').item.json.body.isGroup }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"c51986d9-f347-4198-89bb-9e4cd0f021c9","leftValue":"={{ $('Webhook').item.json.body.broadcast }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05ee6414-0164-473b-8f82-225cfba55ad2","leftValue":"={{ $('Webhook').item.json.body.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"id":"59453ca8-8599-4909-9040-2779c09bb64d","name":"Filtro Inicial1","type":"n8n-nodes-base.filter","typeVersion":2.1,"position":[-13792,-2832],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-7456,-2608],"id":"4c8de601-cf68-4f27-b200-f0a2db86d314","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"jsCode":"  return [\n  {\n        acao: $('Code4').first().json.acao// ou o campo correto de sa√≠da\n  }\n];\n\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6240,-2784],"id":"3db5c23c-e4c5-441e-8ba9-c02bb9df1a69","name":"MsgUsuario"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"03a78ab2-9057-4ff5-baa5-8c37c432a94d","leftValue":"={{$json.acao }}","rightValue":"cancelar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cancelar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e1b9d060-7def-4f5f-b587-657ed9c9ce85","leftValue":"={{ $json.acao }}","rightValue":"finalizar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Finalizar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e3fc41f2-ee99-4de2-8841-2ae1a7da37db","leftValue":"={{$json.acao }}","rightValue":"adicionar_item","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Adicionar Item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"38045ee6-0b44-4b52-a79c-676c7ce5998a","leftValue":"={{ $json.acao }}","rightValue":"carrinho","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"carrinho"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"23e65839-03f6-4879-8998-48ad2909ef94","leftValue":"={{ $json.acao }}","rightValue":"cardapio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cardapio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"996ac831-1b2b-4f3b-8efa-a53642a5d337","leftValue":"={{ $json.acao }}","rightValue":"desconhecida","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"desconhecido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5ba958dd-b3b7-4cfd-a85c-1d0e58a103e2","leftValue":"={{ $json.acao }}","rightValue":"excluir_item","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"excluir_item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d6f6b9ca-5c58-498a-9fc9-b4ceefd4d5da","leftValue":"={{ $json.acao }}","rightValue":"adicionar_ingrediente","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"adicionar_ingrediente"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"311affc0-60d1-4aa8-be8e-b90915b480ac","leftValue":"={{ $json.acao }}","rightValue":"additem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"additem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f1ca97e7-a539-4697-8a42-64e55790c8c1","leftValue":"={{ $json.acao }}","rightValue":"escolha","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"escolha"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-5264,-3056],"id":"df5dff62-eb9b-4f07-a007-a70368a273c4","name":"Switch"},{"parameters":{"httpMethod":"POST","path":"agente_delivery","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-14544,-2832],"id":"52671cad-26cd-4495-940c-eff54c5e1b56","name":"Webhook","webhookId":"66949457-5339-4325-b499-9a15d57ff6a1"},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n {{ $('MensagemTraduzida').item.json.message }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"= Voc√™ √© um classificador de inten√ß√£o para um pedido de pizzaria.\n\nDada a mensagem do cliente, responda APENAS com uma das seguintes a√ß√µes (sem explicar nada):\n\n- adicionar_item ‚Üí o cliente est√° pedindo uma pizza, bebida, etc.  qualquer frase que contenha  \"pizza\", \"esfirra\", \"borda\", \"item\", \"bebida\", \"refrigerante\" \"cerveja\". \nFrases como \"quero pizza\" , \"tem pizza de atum\", \"tem coca cola\", \"tem ou quero esfirra\", \"quero  uma bebida alcolica\"\n \n\n- cancelar ‚Üí se disser que desistiu, quer cancelar ou digitar \"cancelar\".\n\n\n- finalizar ‚Üí se disser que \"fechar\", ou digitar \"fechar\", \"quero fechar\", \"quero fechar\", \"finalizar\".\n \n- carrinho ‚Üí se pedir para ver o resumo do pedido, disser \"carrinho\" ou digitar \"meu carrinho\" , \"compras\", \"pedido\".\n  \n- cardapio ‚Üí se disser \"card√°pio\",    \"ver card√°pio\" \n\n \n- desconhecida ‚Üí tudo que n√£o se enquadrar nas regras acima\n\n- escolha ‚Üí se digitar um numero, qualquer de 1 a 10 ou disser sim ou n√£o ou alguma palavra que possa parecer ser uma responta a IA\n\n\nExemplos (todos = cardapio_online):\n\"consultar pizza calabresa\"  \n\"consultar esfirra carne\"  \n\"consultar coca cola\"  \n\"consultar √°gua\"  \n\"mussarela\"  \n\"calabresa\"  \n\"coca\"  \n\"catupiry\"  \n\"dom giovani\"  \n\"dom edu\"  \n\"paulista\"  \n\"parmezzoni\"  \n\"fiorentina\"  \n\"porperoni\"  \n\"polydoro\"  \n\"dom ariani\"\n\nRetorne SOMENTE neste formato JSON (uma linha), sem texto extra:\n\n{\n  \"acao\": \"adicionar_item\" | \"cancelar\" | \"desconhecida\" | \"carrinho\" | \"cardapio\" | \"excluir_item\"  |  \"escolha\" | finalizar\n}\n"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[-7424,-2880],"id":"18666f34-3844-4b37-b140-4cab5cf339fd","name":"Menu","retryOnFail":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"item_pedido_temp","mode":"list","cachedResultName":"item_pedido_temp"},"deleteCommand":"delete","where":{"values":[{"column":"user_id","value":"= {{ $('Merge1').item.json.user_id }}"},{"column":"status","value":"rejeitado"},{"column":"id_empresa","value":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3040,-2864],"id":"b72f80e2-7e63-409a-99b7-6bb0d3406b0f","name":"ExcluiRejeitados","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"content":"","height":4940,"width":15852,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-16048,-5520],"id":"ae30458e-4f49-47e8-af39-4ade1146f1f5","name":"Sticky Note14"},{"parameters":{"tableId":"pedido_temp","fieldsUi":{"fieldValues":[{"fieldId":"user_id","fieldValue":"={{ $('Merge1').item.json.user_id }}"},{"fieldId":"status","fieldValue":"enviado"},{"fieldId":"valor","fieldValue":"0"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"3c74e864-c948-4abb-bfd2-b178607d6201","name":"CriaPedido","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-7888,-2720],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.user_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"c71bf718-5970-4cb3-b25d-fdad99a489ba","name":"Cliente Pedido","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-8032,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","tableId":"pedido_temp","filters":{"conditions":[{"keyName":"user_id","keyValue":"={{ $('Merge1').item.json.user_id }}"},{"keyName":"id_empresa","keyValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"d4c7b023-e838-4573-8556-28f89f4bbcba","name":"EncontrarPedido","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-8208,-2880],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2464,-4176],"id":"db972b18-b2ef-45ac-9839-f04763f41a93","name":"No Operation, do nothing2","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"id":"bb02d4e0-d35f-4694-a604-2dd0b7162d9e","name":"MergePedido","type":"n8n-nodes-base.merge","typeVersion":3,"position":[-7712,-2880],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1024,-3120],"id":"6941bd6f-503a-4890-b396-bfab789ba416","name":"No Operation, do nothing9","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"select * from  cancela_pre_pedido( {{ $('Concatena').item.json.user_id }}, {{ $('MergePedido').item.json.pedido_id }}  ,  \n {{ $('DadosEmpresa').item.json.id_empresa }});","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3264,-4064],"id":"4f5d0274-e1b7-47a8-90fc-5e37f85b5157","name":"CancelarPedido","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"assignments":{"assignments":[{"id":"a8106197-1d10-438c-a9e7-07c17a8adfd0","name":"acao","value":"={{$json.acao}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5696,-2944],"id":"4d310e5e-23eb-469b-8397-bf98ca460fab","name":"Acao"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6df36e53-74bd-45c5-9d92-2bb167c8b837","leftValue":"={{ $json.cancela_pre_pedido.length }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3008,-4064],"id":"8dca8180-da58-4896-8c15-0704a4703f39","name":"If5"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2448,-3968],"id":"7a825b19-ff9b-4111-aa5a-9e0568398a02","name":"No Operation, do nothing21","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"3f5c86ea-fcc2-4783-8210-a28ce186597d","name":"chatInput","value":"=  {{ $('MensagemTraduzida').item.json.message }}","type":"string"},{"id":"57ddce63-da48-426f-85ae-c63b16da57fa","name":"user_id","value":"={{ $('Merge1').item.json.user_id }}","type":"number"},{"id":"01f0d23c-4a6a-4f2f-b986-7acfe7c4b65b","name":"pedido_id","value":"={{ $('MergePedido').item.json.pedido_id }}","type":"number"},{"id":"0718edfa-d295-496a-bfa1-f8e591daf83b","name":"telefone","value":"={{ $('Dados Lead').item.json.IdConversa }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2592,-2864],"id":"178b7d11-672f-4189-8666-9be32b1dfd39","name":"MontPedido"},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"item_pedido_temp","mode":"list","cachedResultName":"item_pedido_temp"},"deleteCommand":"delete","where":{"values":[{"column":"user_id","value":"= {{ $('Merge1').item.json.user_id }}"},{"column":"status","condition":"!=","value":"concluido"},{"column":"id_empresa","value":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3056,-2560],"id":"c48e2408-1860-4b9a-8641-942eaf994434","name":"ExcluiRejeitados1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" // Code node (JavaScript) ‚Äî Run Once for All Items\n// Captura fracionadas e remove do texto para a LLM\n\nconst inputItems = $input.all();   // <- aqui est√° a corre√ß√£o\nconst out = [];\n\nfor (const { json } of inputItems) {\n  const raw = String(json.chatInput ?? '');\n\n  // normaliza√ß√£o leve\n  let norm = raw\n    .toLowerCase()\n    .replace(/[‚Äì‚Äî‚àí]/g, '-')               // h√≠fens\n    .replace(/\\b(meia|metade)\\b/g, '1/2') // \"meia/metade\" -> 1/2\n    .replace(/\\s+/g, ' ')\n    .trim();\n\n  const fracionadas = [];\n\n  // [qtd?][x?] 1/2 A (e|,|+|/) 1/2 B  (evita confundir 2L, etc.)\n  const re = /\\b(?:(\\d+)\\s*x?\\s*)?1\\/2\\s*(\\d{1,3})(?!\\s*[a-z])\\s*(?:e|,|\\+|\\/)\\s*1\\/2\\s*(\\d{1,3})(?!\\s*[a-z])\\b/gi;\n\n  // uma passada: coleta e remove\n  let rest = norm.replace(re, (_full, q, a, b) => {\n    fracionadas.push({\n      quantidade: q ? parseInt(q, 10) : 1,\n      metade1: parseInt(a, 10),\n      metade2: parseInt(b, 10),\n    });\n    return ' ';\n  });\n\n  rest = rest.replace(/\\s+/g, ' ').trim();\n\n  out.push({\n    json: {\n      ...json,                 // preserva campos existentes (user_id, pedido_id, etc.)\n      texto_original: raw,\n      texto_limpo: rest,       // passe ESTE texto para a LLM\n      fracionadas, \n    telefone:  $input.first().json.telefone\n      //depois some com pizzastelefone_fracionadas da LLM\n    },\n  });\n}\n\nreturn out;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2352,-2864],"id":"e28406bd-a2e9-41e8-a211-2cbe7ef938d3","name":"Code2"},{"parameters":{"content":"##  Cancelar Pedido\nCancelar um pedido","height":568,"width":1108,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3280,-4320],"id":"addbb638-b3fd-4929-bf26-ea6b7371fba4","name":"Sticky Note12"},{"parameters":{"content":"Ajuste sua inst√¢ncia e autenficia√ß√£o da Z-API","height":300,"width":230,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3248,-9696],"id":"ab7bb127-90f0-4608-8976-c9dd13fa15c0","name":"Sticky Note22"},{"parameters":{"content":"## Envio das Respostas ao Usu√°rio\nEnvio das mensagens quebradas para o usu√°rio","height":760,"width":900,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3440,-9984],"id":"071b4c58-e2b5-4458-8bca-3ffc79e578ca","name":"Sticky Note13"},{"parameters":{"content":"Ajuste o Node Set com os campos relevantes fornecidos.\n","height":280,"width":706,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-13488,-2912],"id":"9ab79777-a465-45db-9c48-5e480b1acdf2","name":"Sticky Note"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=``` ‚è≥ Processando...  ```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-2816,-2864],"id":"ea83b2b5-79e2-4f51-9770-2d4b2cc935c9","name":"MenuCardapio15","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"={{ $('Dados Lead').item.json.instance }}","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= ```üóëÔ∏è {{$('Dados Lead').item.json.LeadNome }}, o seu pedido foi cancelado com sucesso. Vamos come√ßar um novo pedido!```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-2736,-4176],"id":"d6d7b503-0e9c-4f9d-9c55-71e541a2f134","name":"MenuCardapio23","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"resource":"messages-api","instanceName":"={{ $('Dados Lead').item.json.instance }}","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= üóëÔ∏è {{ $('Dados Lead').item.json.LeadNome }}, n√£o encontratmos dados a ser excluido. Vamos come√ßar um novo pedido!","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-2720,-3968],"id":"df4e7ad3-94ef-4bc4-86e7-73271ad59466","name":"MenuCardapio24","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"bc64f125-d93c-4d1d-97ae-65c0adb08b79","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"f7053057-3e82-49ad-a2bf-07bafc958f06","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"extendedTextMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"137aec3f-e95e-4d59-b9ba-1140f9fc4fb4","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals"},"id":"40b284c8-fdf7-49e5-9ac3-8c5051f51521"}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"7babc8fd-200c-4cb8-bc63-f999f57d5217","leftValue":"={{ $('Webhook').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.mimetype }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"Outro"}},"id":"0ca16946-edee-44b3-8fc8-456764c34cff","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[-12256,-2848],"notesInFlow":true,"notes":"Ajustar condi√ß√µes para cada tipo de mensagem a depender da sua entrada de dados\n\nTEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{"language":"pt"}},"id":"71091022-6080-456b-b2c0-401f94abbfc6","name":"Transcrever √Åudio1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[-11552,-2864],"credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=#Instru√ß√µes\nO usu√°rio te enviou uma imagem a qual voc√™ deve descrever.\n\nA imagem pode vir acompanhada de uma mensagem de texto (<MensagemUsuario>)\n\nCaso venha, utilize a mensagem anexa como contexto extra, tente capturar o sentimento da mensagem e objetivo pelo qual o usu√°rio esteja enviando esta imagem na conversa.\n\nCrie uma resposta descrevendo as informa√ß√µes enviadas para que estas sejam utilizadas por um agente no futuro.\n\nLembre-se:\nEste agente apenas ter√° as informa√ß√µes que voc√™ fornecer, portanto repasse toda informa√ß√£o que julgar importante.\n\n#Dados\n<MensagemUsuario>\n{{ $json.MensagemImagem }}\n</MensagemUsuario>\n","inputType":"base64","options":{}},"id":"b3845131-8527-4bcb-b6f1-5aad006b085e","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[-11552,-2704],"credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"amount":"={{ $('Parametros Fluxo').item.json.EsperaBuffer }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-10752,-2800],"id":"65441867-d7aa-4aee-b6b7-f8feefb3ff80","name":"Wait1","webhookId":"169ea291-c3dc-4bca-854f-05520c979d7d","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-10960,-2784],"id":"467ae411-f1a1-4b6c-a081-da9a48cc8d4f","name":"Buffer ","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-10592,-2800],"id":"694d79db-6198-4108-8532-dac657d0df75","name":"Buffer 3","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.Texto }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-3184],"id":"ba05176c-afcd-4315-b0ea-1a93d79f5877","name":"Add Texto Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"delete","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-10288,-2880],"id":"7d3a21bf-8899-44bc-beab-8fd91212840e","name":"Apagar Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-3184],"id":"fdc64d42-c8b0-443e-89e6-5f3302af3ad0","name":"Mensagem Texto1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Audio","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2864],"id":"adb45536-8466-4e90-ab9b-62d3a182cbdb","name":"Mensagem Audio1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Imagem","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"f5c70ab5-7671-4bc8-9d23-65b8954ddb08","name":"MensagemImagem","value":"={{ $('Webhook').item.json.body.data.message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2704],"id":"8ed5d075-7555-4d7a-b0ac-0c2dfede763f","name":"Mensagem Imagem1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2864],"id":"fc455233-39ab-4955-a251-c8c0a56b6824","name":"Add Audio Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.Erro }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2368],"id":"6ce2a774-2168-4fbd-8f3c-8d90dcb0c661","name":"Add Error Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-11552,-2544],"id":"99221708-45d9-4842-87a6-a140d8007217","name":"Extract from File","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"11dc126a-e72e-431b-8db5-c78168c69439","name":"Erro","value":"<ErroFormatoMensagem>","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2368],"id":"bb8496ed-96ad-4791-8352-d1ddc8814b9a","name":"Mensagem Erro1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"=<ContextoPDF>\n  <TranscricaoPDF>\n{{ $json.text }}\n  </TranscricaoPDF>\nContexto Extra: O usu√°rio encaminhou a mensagem a seguir junto ao PDF.\n  <MensagemUsuario>\n{{ $('Mensagem Documento PDF').item.json.MensagemDocumento }}\n  </MensagemUsuario>\n</ContextoPDF>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2544],"id":"54d607bf-91c1-4f34-91ea-6068ebe37bd3","name":"Add PDF Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"=<ContextoImagem>\n\n  <DetalheImagem>\n{{ $json.content }}\n  </DetalheImagem>\n\nContexto Extra: O usu√°rio encaminhou a mensagem a seguir junto √° imagem.\n  <MensagemUsuario>\n{{ $('Mensagem Imagem1').item.json.MensagemImagem }}\n  </MensagemUsuario>\n\n</ContextoImagem>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-11248,-2704],"id":"0db30c4d-f1ab-401a-9d8c-81566344387a","name":"Add Imagem Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"AgenteStatus","key":"={{ $('Parametros Fluxo').item.json.IdAgente }}_status_{{ $('Dados Lead').item.json.IdConversa }}\n\n ","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-12752,-2832],"id":"1d9d6e11-6441-4cf9-9672-aa94927d0178","name":"Redis","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-10048,-2704],"id":"391e9bdc-76c5-470d-9574-d4df11c5f4d2","name":"No Operation, do nothing6","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"756ab323-31a2-4a59-92e8-c2c695027962","leftValue":"={{ $json.AgenteStatus }}","rightValue":"Desativado","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-12544,-2832],"id":"e68977f3-c385-4190-a7a1-a085dc2e4555","name":"Bot Desativado?1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-12384,-3056],"id":"3c02e2fb-7b3e-49b3-a305-fa07e1831c96","name":"No Operation, do nothing"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Documento","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"003323ec-ffbe-4c91-b8b5-623466b5014d","name":"MensagemDocumento","value":"={{ $('Webhook').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-2544],"id":"eaa320f1-f7a5-4674-831e-9ac37a4cae6b","name":"Mensagem Documento PDF","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"toBinary","sourceProperty":"Imagem","options":{"mimeType":"image/png"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-11776,-2704],"id":"02722221-c001-4e08-b361-3f4444f0ed9e","name":"Convert to File"},{"parameters":{"operation":"toBinary","sourceProperty":"Audio","options":{"mimeType":"audio/mp4"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-11776,-2864],"id":"13a57dbe-f63f-4c55-be71-76ce402ff747","name":"Convert to File1"},{"parameters":{"operation":"toBinary","sourceProperty":"Documento","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-11776,-2544],"id":"9ca7f566-f29f-4928-bec0-f98c10b20c69","name":"Convert to File2"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12032,-3024],"id":"c4ea2375-b696-4bc7-9efa-ca60db3fa570","name":"Mensagem Texto2","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"66a91f66-e755-4120-b22f-44c814f56162","name":"message","value":"={{ $json.comando }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-9360,-2880],"id":"3c9e8fbe-c213-4d8a-ad57-c5c165b4682a","name":"MensagemTraduzida","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"01c2c18a-5148-4c7d-b5cd-72c66d6595a5","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"montagem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bbee0d48-e616-41a6-a91c-e9d13fef7158","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"finalizar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"d2181f84-5c44-42e2-8d3f-3384a047160a","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"ingrediente","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"cc84bcf5-f495-4774-a1b4-b8a9a7510bf6","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"additem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"029438df-3420-4884-a06c-b3904bcad8e5","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"sair","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6496,-2880],"id":"e26e9f1b-5974-40ff-b1d1-a6dae18d904d","name":"If7"},{"parameters":{"jsCode":"   return [\n  {\n    acao: $('MergePedido').first().json.status  // ou o campo correto de sa√≠da\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6256,-2960],"id":"c72dcca2-5b3d-4f55-bc83-e4bfda5e4bcc","name":"MsgUsuario1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-6016,-2944],"id":"f1cc3901-1383-49f0-b817-db3067c74e21","name":"Merge2"},{"parameters":{"resource":"messages-api","instanceName":"={{ $('Dados Lead').item.json.instance}}","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```O item  {{ $('Numero').item.json.numero }} ¬∫ foi excluido do seu pedido com sucesso.  ```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-2624,-1680],"id":"1d4a1409-6078-42a5-8220-21190f843ead","name":"MenuCardapio36","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"operation":"executeQuery","query":"WITH ordenado AS (\n  SELECT \n    item_id,\n    user_id,\n    pedido_id,\n    ROW_NUMBER() OVER (PARTITION BY user_id, pedido_id ORDER BY item_id) AS nova_ordem\n  FROM item_pedido_temp\n)\nUPDATE item_pedido_temp i\nSET ordem_item = o.nova_ordem\nFROM ordenado o\nWHERE i.item_id = o.item_id\n  AND i.user_id = o.user_id\n  AND i.pedido_id = o.pedido_id \n   and i.user_id =  {{$('Merge1').item.json.user_id }} \n  and i.pedido_id =  {{ $('MergePedido').item.json.pedido_id }}   and i.id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2432,-1680],"id":"6e460694-3302-426c-a7f0-2ae9def2fff9","name":"OrdenaPedido1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" const frase = $('MensagemTraduzida').first().json.message || \"\";\n\n// categorias aceitas\nconst categorias = [\"pizza\", \"esfirra\", \"refrigerante\", \"cerveja\"];\n\n// Regex: \"consultar ...\" seguido de tudo\nconst match = frase.match(/^consultar\\s+(.+)$/i);\n\nlet categoria = null;\nlet nome = null;\n\nif (match) {\n  const partes = match[1].trim().toLowerCase().split(/\\s+/);\n  const primeira = partes[0];\n\n  if (categorias.includes(primeira)) {\n    categoria = primeira;\n    nome = partes.slice(1).join(\" \") || null;\n  } else {\n    // se a primeira palavra n√£o √© categoria conhecida, trata tudo como nome\n    categoria = null;\n    nome = match[1].trim().toLowerCase();\n  }\n} else {\n  // n√£o come√ßou com \"consultar\" ‚Üí trata tudo como nome\n  categoria = null;\n  nome = frase.trim().toLowerCase();\n}\n\nreturn { categoria, nome };\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2848,-3440],"id":"6a69579b-bf9a-4542-8d1d-0929bf630727","name":"ConsultarCardapio"},{"parameters":{"jsCode":" const frase = $('MensagemTraduzida').first().json.message || \"\";\n\nconst match = frase.match(/(?:item\\s*)?(\\d+)/i);\n\nreturn {\n  numero: match ? parseInt(match[1]) : null\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3152,-1680],"id":"d973d690-e779-46b4-acc6-37f0255d2439","name":"Numero"},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"item_pedido_temp","mode":"list","cachedResultName":"item_pedido_temp"},"deleteCommand":"delete","where":{"values":[{"column":"user_id","value":"= {{ $('Merge1').item.json.user_id }}"},{"column":"ordem_item","value":"={{ $('Numero').item.json.numero }}"},{"column":"pedido_id","value":"={{ $('MergePedido').item.json.pedido_id }}"},{"column":"id_empresa","value":"= {{ $('DadosEmpresa').item.json.id_empresa }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2784,-1680],"id":"39d401de-9b68-4eba-9f7b-bfa8777ec579","name":"Excluir Item","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"\n delete from item_pedido_temp as i using item_pedido_temp as  it\n where i.categoria = 'borda'           and\n       i.user_id= it.user_id           and\n       i.pedido_id= it.pedido_id       and\n       i.tamanho = it.tamanho          and\n       i.numero_fracao =it.numero      and \n       it.ordem_item =  {{ $json.numero }} and\n       i.user_id=  {{ $('Merge1').item.json.user_id }}  and\n       i.pedido_id= {{ $('MergePedido').item.json.pedido_id }}  and i.id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }}","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2960,-1680],"id":"ca45c967-6667-4424-84fd-2512d63c9c49","name":"ExcluiBorda","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" const input =  $input.first().json.comando_normalizado || $input.first().json.message || \"\";\nlet clean = input.toLowerCase().trim();\nlet tokens = clean.split(/\\s+/);\n\n// Mapa de palavras para n√∫meros (quando a 1¬™ palavra √© quantidade)\nconst mapaQtd = { \"uma\":\"1\", \"um\":\"1\", \"duas\":\"2\", \"dois\":\"2\", \"tr√™s\":\"3\", \"tres\":\"3\", \"quatro\":\"4\", \"cinco\":\"5\" };\nif (mapaQtd[tokens[0]]) {\n  tokens[0] = mapaQtd[tokens[0]];\n  clean = tokens.join(\" \");\n}\n\n// Normaliza plural b√°sico (caso o pr√©-LLM n√£o tenha feito)\nif (tokens[1] === \"pizzas\") {\n  tokens[1] = \"pizza\";\n  clean = tokens.join(\" \");\n}\n\n// Resposta padr√£o (com sugest√£o educada)\nlet resultado = {\n  original: input,\n  comando: clean,\n  valido: false,\n  tipo: null,\n  erro: \"n√£o entendi seu comando\",\n  sugestao: `O seu pedido ou comando n√£o foi identificado. Voc√™ quis dizer: ${clean} ?`\n};\n\n// --- Caso 1: Pizza inteira ---\n// \"1 pizza 14\", \"1 pizza mussarela grande\"\nif (\n  tokens.length >= 3 &&\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"pizza\" &&\n  !tokens.includes(\"1/2\")\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"pizza_inteira\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 2: Pizza fracionada ---\n// \"1 pizza 1/2 14 e 1/2 19\"  (aceita nomes no lugar de n√∫meros)\nelse if (\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"pizza\" &&\n  tokens.filter(t => t === \"1/2\").length === 2\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"pizza_fracionada\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 3: Esfirra ---\n// \"1 esfirra carne\"\nelse if (\n  tokens.length >= 3 &&\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"esfirra\"\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"esfirra\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 4: Bebida ---\n// \"1 coca cola 2l\", \"2 guarana 350ml\", \"1 √°gua 500ml\", \"1 heineken long neck\"\nelse if (\n  /^\\d+$/.test(tokens[0]) &&\n  /\\b(coca(?:\\s+cola)?|cola|guaran[√°a]|heineken|bud(?:weiser)?|cerveja|agua|√°gua|fanta|sprite)\\b/.test(clean)\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"bebida\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 5: Adicionar ingrediente ---\n// \"adicionar mussarela item 1\", \"adicionar ingrediente cheddar ao item 3\"\nelse if (\n  tokens[0] === \"adicionar\" &&\n  tokens.includes(\"item\")\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"adicionar_item\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 6: Excluir item ---\n// \"excluir item 1\", \"excluir 2\"\nelse if (\n  tokens[0] === \"excluir\" &&\n  (\n    (tokens[1] === \"item\" && /^\\d+$/.test(tokens[2])) ||\n    (/^\\d+$/.test(tokens[1]))\n  )\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"excluir_item\",\n    acao: \"excluir_item\"\n  };\n}\n\nreturn resultado;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-9712,-2880],"id":"632e31a0-3d32-4cfe-85e4-1c8d888df371","name":"Validador"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MontPedido').item.json.chatInput }}","user_id":"={{ $('MontPedido').item.json.user_id }}","pedido_id":"={{ $('MontPedido').item.json.pedido_id }}","rotina":1,"telefone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('telefone', `telefone`, 'string') }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1968,-2720],"id":"e551d0cf-42ec-40ad-b56e-a325608a83f9","name":"Call n8n Workflow Tool"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1744,-2864],"id":"ecc73e8a-67fa-44e6-a12f-38b93f782237","name":"No Operation, do nothing22","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","pedido_id":"={{ $('MergePedido').item.json.pedido_id }} ","rotina":2,"telefone":"={{ $('Dados Lead').item.json.IdConversa }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}","instance":"={{ $('Dados Lead').item.json.instance }}","apikey":"={{ $('Dados Lead').item.json.apikey }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"instance","displayName":"instance","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"apikey","displayName":"apikey","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-2752,-3280],"id":"947732ed-0e9b-40a9-86a7-0b9504b1667e","name":"Call n8n Workflow Tool2"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2368,-3456],"id":"6d22bbcd-92ff-4c34-95b9-453cceec19bd","name":"No Operation, do nothing25","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[928,-3808],"id":"43b02b8e-1bd1-4e06-bc97-fecc112a59fc","name":"No Operation, do nothing23","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":3,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[624,-3664],"id":"e0bb82a0-8651-4d59-a214-b2d04ea5ce24","name":"ExecutaMontagem"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2336,-2560],"id":"efe458be-f7e1-4061-81c3-a24592a02666","name":"No Operation, do nothing29","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2448,-2224],"id":"b20f7959-aa3a-4f0d-9089-49a9aadb3184","name":"No Operation, do nothing30","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=o seu objetivo √© executar a ferramenta AgenteVendas() "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2832,-2224],"id":"fc2897b5-6613-4d9e-b314-2b487b4a744f","name":"Atendimento Ajuda","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo √© chamar o fluxo gerador de itens do carrinho. \n\nUse no telefone   {{ $json.telefone }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2112,-2864],"id":"74202dcd-9d93-4b77-adc1-999eef2b7879","name":"Criar Pedido","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo  Executar a tool carrinho   execute   ToolsCarrinho()"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2736,-2560],"id":"b93a2a63-711e-4b57-92fa-d43ed5a06cee","name":"Carrinho1","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=Executa a montagem de de pedido com mais de uma op√ß√£o "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[496,-3824],"id":"d1741377-a950-4de1-b042-cb61dadbb8df","name":"Montagem","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usu√°rio para o agente","height":732,"width":1492,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-6848,-3120],"id":"0c90d6ac-3835-4b31-bba2-feeb8b1fae3e","name":"Sticky Note17"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2208,-1680],"id":"971e4ba9-1ad3-4972-951b-307f7ea7eb66","name":"No Operation, do nothing31","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2688,-3920],"id":"cd9b172e-2ec8-4644-b489-6bc46938655c","name":"No Operation, do nothing10","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```üöÄ Saindo do modo ajuda. \n    Agora voc√™ pode continuar normalmente com seu pedido.```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[2464,-3920],"id":"4ab3b7da-5623-4c44-9ae5-d2a8e5db3994","name":"MenuCardapio1","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo √© chamar o fluxo gerador de itens do carrinho. \n\nUse no telefone  {{ $('Dados Lead').item.json.IdConversa }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2896,-3472],"id":"c398f198-d02d-4d71-a334-3f96f5d3b6e0","name":"Fechamento","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='finalizar'  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and \nid_empresa = {{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1472,-4656],"id":"9ad9530e-1936-40a4-95ef-c82fe9aeee06","name":"Finalizar","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"50fdf9df-620d-483e-b114-bb3d9dc1caea","leftValue":"={{ $json.status }}","rightValue":"finalizar","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[992,-4448],"id":"02593f39-6e82-4fca-8950-38fae18eda26","name":"If1"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","pedido_id":"={{ $('MergePedido').item.json.pedido_id }} ","rotina":4,"telefone":"={{ $('Dados Lead').item.json.IdConversa }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}","instance":"={{ $('Dados Lead').item.json.instance }}","apikey":"={{ $('Dados Lead').item.json.apikey }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"instance","displayName":"instance","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"apikey","displayName":"apikey","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1296,-4496],"id":"eefd14fc-9ab5-46d9-8276-310548c575eb","name":"Call n8n Workflow Tool3"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo √© chamar o fluxo gerador de itens do carrinho. \n\nUse no telefone  {{ $('Dados Lead').item.json.IdConversa }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1168,-4656],"id":"576f0b5d-8117-49e9-8754-9b84f50f1665","name":"ChamaPrecarrinho","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"operation":"get","tableId":"pedido_temp","filters":{"conditions":[{"keyName":"user_id","keyValue":"={{ $('Merge1').item.json.user_id }}"},{"keyName":"pedido_id","keyValue":"={{ $('MergePedido').item.json.pedido_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[752,-4448],"id":"473e979b-7688-4841-82b6-47c0fef1ba4d","name":"StatusPedido","credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"92b4a80f-9642-42ba-9d5b-534e35757324","leftValue":"={{ $json.count }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[448,-4272],"id":"91e250ba-4502-41a2-aeac-6b6d02de9c9e","name":"If6"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1008,-4256],"id":"8f0e6375-3ac7-45e7-b86d-9040b16f3c26","name":"No Operation, do nothing33","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"messages-api","instanceName":"={{ $('Dados Lead').item.json.instance}}","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"= ```üõíSeu carrinho esta vazio.```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[736,-4256],"id":"e99f9066-b093-432c-b7b7-7ebcf559c716","name":"MenuCardapio34","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"content":"##  Fechamento\nFechamento de um pedido de cliente","height":632,"width":2276},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3264,-3648],"id":"eed5f410-f8b0-4da9-8f9c-357b6792beb1","name":"Sticky Note20"},{"parameters":{"content":"##  Criar um novo pedido \nCriar um novo pedido ou v√°rios pedidos de um cliente","height":264,"width":2276,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3184,-2928],"id":"4b30bcc2-f629-4b12-af89-6b6d4ceaa505","name":"Sticky Note21"},{"parameters":{"content":"## Carrinho\nCliente solicita vizualizar carrinho.","height":264,"width":1220,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3264,-2592],"id":"d3ee1260-5ed5-45f0-8c25-3b4bbaeb7ffa","name":"Sticky Note24"},{"parameters":{"content":"##  Atendimento frente de loja\nAjuda cliente com suas d√∫vidas","height":328,"width":1236,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3280,-2272],"id":"aa25654e-292c-494d-8525-d9454b0c77c8","name":"Sticky Note25"},{"parameters":{"content":"##  Montagem\nCliente solicitou itens com varias op√ß√µes","height":264,"width":1220,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[224,-3872],"id":"b8ab0ca2-6eb8-4481-bc0c-8a66b0443f0b","name":"Sticky Note26"},{"parameters":{"content":"##  Cancelar Pedido\nCancelar um pedido","height":264,"width":1220,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[624,-3168],"id":"5b7c2c4d-0f16-4550-851e-f649746e39e8","name":"Sticky Note27"},{"parameters":{"content":"##  Consular e escolher Op√ß√µes\nCancelar um pedido","height":456,"width":1284,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2672,-3536],"id":"cb543947-c683-4e96-aacd-fbfaea0e22e7","name":"Sticky Note28"},{"parameters":{"content":"##  Cancelar Item   Pedido\nCancelar um item pedido","height":424,"width":1588,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3280,-1808],"id":"16496942-24b4-471e-ab24-c19dffdae560","name":"Sticky Note29"},{"parameters":{"content":"##  Sair\nSair do Modo Ajuda ou voltar para compras","height":264,"width":1220,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2128,-3984],"id":"bf83d31c-301f-4c2f-a65d-c12ec566e21a","name":"Sticky Note30"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usu√°rio para o agente","height":1084,"width":1988,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12528,-3248],"id":"dd9a9f30-3d8f-4179-acda-f6a814da4bc7","name":"Sticky Note11"},{"parameters":{"content":"Ajuste tempos de buffer e inatividade do agente conforme necessidade.\n","height":968,"width":1822},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-12448,-3184],"id":"0f6f768f-d600-4954-b21f-2b979d6a1fff","name":"Sticky Note19"},{"parameters":{"operation":"executeQuery","query":"select count(*)::INT  from item_pedido_temp  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and \nid_empresa = {{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[240,-4272],"id":"d494fd20-b48a-4bb7-ada8-5329c73d731e","name":"VerificaCarrinhoVazio","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"select  id_empresa::int  from empresa_telefones where telefone = '{{ $json.telefoneEmpresa }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-13136,-2832],"id":"def9e1c8-bb52-4340-a4b7-be40f48109f5","name":"Execute a SQL query1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"assignments":{"assignments":[{"id":"ae27ddc3-121b-470f-a83c-a7b53f38c0da","name":"id_empresa","value":"={{ $json.id_empresa }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-12928,-2832],"id":"2b58e198-7fc5-48b9-addc-3535149404fc","name":"DadosEmpresa"},{"parameters":{"operation":"executeQuery","query":"select * from grava_intencao_opcao ({{ $('Merge1').item.json.user_id }} ,{{ $('MergePedido').item.json.pedido_id }}  , {{ $('DadosEmpresa').item.json.id_empresa }}   , '{{ $json.nome }}'    );\n   \n  ","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[3024,-3440],"id":"80c7c2e4-1741-45aa-ae1d-eada3262d482","name":"Inten√ß√µes","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"= ```{{ $json.linha }}``` ```\n Dica! Fa√ßa sua escolha via n√∫meros, √© mais assertivo.  \n Qual op√ß√£o voc√™ escolhe? Monte j√° o seu pedido.```","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":6,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[3360,-3264],"id":"529bdd63-99e8-483f-b792-02ffe58fdc9e","name":"ExecutaMontagem4"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo √© montar sua pizza com suas pizzas que possuem varias op√ß√µes.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[3216,-3440],"id":"40313d54-5627-421f-88ef-e46e0bc4fd16","name":"Carrinho","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3568,-3440],"id":"e61fdaec-e5df-408e-8490-5f80b5a26585","name":"No Operation, do nothing7","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"update  pedido_temp \n  set status ='enviado'\n  where  \n        user_id=  {{ $('Merge1').item.json.user_id }}  and\n        pedido_id= {{ $('MergePedido').item.json.pedido_id }}  and     id_empresa ={{ $('DadosEmpresa').item.json.id_empresa }}   \n ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2256,-3920],"id":"968e0599-f9cf-4317-acb1-4e00f9ab5a1e","name":"SairAjuda","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='ingrediente'  WHERE \n  user_id =  {{ $('StatusPedidoAdd1').item.json.user_id }}\n  AND pedido_id = {{ $('StatusPedidoAdd1').item.json.pedido_id }} and status <> 'ajuda' and id_empresa = {{ $('StatusPedidoAdd1').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1184,-2576],"id":"95935e80-f86f-42c7-bf07-9892d42a39a9","name":"Ingrediente","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"= ```Adicionar itens```  ","rotina":4,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{$('StatusPedidoAdd1').item.json.pedido_id }}","id_empresa":"={{ $('StatusPedidoAdd1').item.json.id_empresa }}","user_id":"={{ $('StatusPedidoAdd1').item.json.user_id }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1520,-2432],"id":"490d42c8-5261-4c75-8132-f3dccfa93c98","name":"ExecutaMontagem5"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo √© montar sua pizza com suas pizzas que possuem varias op√ß√µes.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1376,-2576],"id":"87969b14-2f15-4695-bdd8-ddeb3175232b","name":"Carrinho3","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='finalizar'  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and \nid_empresa = {{ $('DadosEmpresa').item.json.id_empresa }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[4432,-3232],"id":"2dda6784-598b-4560-b643-dcf518e5a4c2","name":"StatusPedidoAdd","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" select status,\n   user_id, pedido_id, id_empresa \n   from  pedido_temp  WHERE \n  user_id = {{ $('Merge1').item.json.user_id }} \n  AND pedido_id = {{ $('MergePedido').item.json.pedido_id }} and \nid_empresa = {{ $('DadosEmpresa').item.json.id_empresa }}; ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[736,-2304],"id":"8aeb8433-d636-4af8-8e27-194436145983","name":"StatusPedidoAdd1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f41c0607-f277-4feb-b04a-0ac3214e58fa","leftValue":"={{ $json.retorno }}","rightValue":"enviado","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1200,-1904],"id":"5a190601-5369-4ae6-ba2f-6ef175246c00","name":"IfStatusPedido"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1712,-2576],"id":"78a8ccfa-3e28-4d2b-b33d-ebbdbf833bd2","name":"No Operation, do nothing8","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":" select status,\n   user_id, pedido_id, id_empresa \n   from  pedido_temp  WHERE \n  user_id =72\n  AND \nid_empresa =  1 ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[4304,-3424],"id":"439383be-13d3-41cf-bcaf-1bc1f70052e9","name":"StatusPedidoAdd2","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"content":"##  Consular e escolher Op√ß√µes\nCancelar um pedido","height":1064,"width":2628,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[672,-2576],"id":"35ab6783-45ea-44ec-b471-c1934ee36fc2","name":"Sticky Note31"},{"parameters":{"jsCode":" // L√™ da MensagemTraduzida, com fallback para $json.message\nconst raw =\n  \n  ($('MensagemTraduzida')?.item?.json?.message ?? $json.message ?? \"\")\n    .toString()\n    .trim();\n\nconst txt = raw\n  .normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")   // remove acentos\n  .replace(/[‚Äú‚Äù\"']/g, \"\")                            // aspas\n  .replace(/\\s+/g, \" \")                              // espa√ßos extras\n  .toLowerCase();\n\n// ===== 1) A√á√ÉO =====\nconst acaoMatch = txt.match(/\\b(adicionar|acrescentar|incluir|colocar)\\b/);\nconst acao = acaoMatch ? acaoMatch[1] : null;\n\n// ===== 2) ITEM DO CARRINHO =====\n// padr√µes aceitos: \"ao item 3\", \"no item 3\", \"item 3\", \"#3\", \"n¬∫ 3\", ou n√∫mero no final\nlet itemNumero = null;\nconst itemPatterns = [\n  /\\b(?:ao|no|na)\\s+item\\s+(\\d+)\\b/,\n  /\\bitem\\s*(\\d+)\\b/,\n  /\\b(?:#|n[¬∫o.]?)\\s*(\\d+)\\b/,\n];\nfor (const re of itemPatterns) {\n  const m = txt.match(re);\n  if (m) { itemNumero = parseInt(m[1], 10); break; }\n}\n// Se ainda n√£o achou: tenta n√∫mero no final (evita fra√ß√µes tipo 1/2)\nif (itemNumero === null && !/\\b\\d+\\/\\d+\\b/.test(txt)) {\n  const endNum = txt.match(/(\\d+)\\s*$/);\n  if (endNum) itemNumero = parseInt(endNum[1], 10);\n}\n\n// ===== 3) CATEGORIA =====\nlet categoria = null;\nif (/\\bborda\\b/.test(txt)) categoria = \"borda\";\nelse if (/\\bingrediente\\b|\\bextra\\b/.test(txt)) categoria = \"ingrediente\";\nelse if (/\\bitem\\b/.test(txt)) categoria = \"item\";\n\n// ===== 4) NOME =====\n// Remove a√ß√£o, conectivos e marcador de item; o restante vira nome\nlet nome = txt;\n\n// remove a√ß√£o\nif (acao) nome = nome.replace(new RegExp(\"\\\\b\" + acao + \"\\\\b\"), \"\");\n\n// remove conectivos comuns\nnome = nome.replace(/\\b(de|da|do|das|dos|com|para|pra|ao|no|na)\\b/g, \" \");\n\n// remove categoria expl√≠cita (se houver)\nif (categoria) nome = nome.replace(new RegExp(\"\\\\b\" + categoria + \"\\\\b\"), \" \");\n\n// remove padr√µes de \"item 3\", \"ao item 3\", \"#3\", \"n¬∫ 3\" e n√∫mero final isolado\nnome = nome\n  .replace(/\\b(?:ao|no|na)\\s+item\\s+\\d+\\b/g, \" \")\n  .replace(/\\bitem\\s*\\d+\\b/g, \" \")\n  .replace(/\\b(?:#|n[¬∫o.]?)\\s*\\d+\\b/g, \" \")\n  .replace(/(\\d+)\\s*$/g, \" \");\n\n// normaliza espa√ßos\nnome = nome.replace(/\\s+/g, \" \").trim();\n\n// ===== 5) Defaults e pequenos ajustes =====\nif (!categoria) {\n  // se n√£o informou categoria, heur√≠stica:\n  // se frase n√£o cont√©m \"borda\" nem \"item\", assume \"ingrediente\"\n  categoria = \"ingrediente\";\n}\n\n// Corre√ß√µes simples de termos comuns\nconst correcoes = {\n  \"cheedar\": \"cheddar\",\n  \"cheedar \": \"cheddar \",\n  \"mucarela\": \"mussarela\",\n  \"mu√ßarela\": \"mussarela\",\n};\nObject.keys(correcoes).forEach(k => {\n  nome = nome.replace(new RegExp(\"\\\\b\" + k + \"\\\\b\", \"g\"), correcoes[k]);\n});\n\n// Sa√≠da\nreturn [{\n  json: {\n    acao,                 // ex.: \"adicionar\"\n    categoria,            // ex.: \"borda\" | \"ingrediente\" | \"item\"\n    nome,                 // ex.: \"mussarela\"\n    item_numero: itemNumero ?? null,\n    telefone:$('Dados Lead').first().json.IdConversa,\n   user_id:  $input.first().json.user_id,\n pedido_id:  $input.first().json.pedido_id ,\nid_empresa: $input.first().json.id_empresa\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,-2304],"id":"4be8cd53-5146-454f-a6b5-82d8a923144d","name":"Code"},{"parameters":{"jsCode":" // items -> vem do node Postgres (cada linha uma op√ß√£o)\nconst rows =  items.map(i => i.json).sort((a,b) => (a.ordem_item ?? 0) - (b.ordem_item ?? 0));\n\n// formata R$ (pt-BR). Se preferir \"61.00\", troque por: Number(v).toFixed(2)\nconst fmtBRL = (v) => {\n  if (v === null || v === undefined || isNaN(Number(v))) return \"R$ --\";\n  return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2 }).format(Number(v));\n};\n\n// monta as linhas numeradas 1..N no padr√£o do print\nconst linhas = rows.map((r, i) => {\n  const num = r.numero ?? '';\n  const nome = (r.nome ?? '').trim();\n  const preco = fmtBRL(r.valor);\n  return `${i+1}.) *(${num}) ${nome}* ‚Äì ${preco}`;\n});\n\nconst texto =\n  `As op√ß√µes dispon√≠veis para voc√™ escolher s√£o:\\n\\n` +\n  linhas.join('\\n\\n') +\n  `\\n\\nQual op√ß√£o voc√™ escolhe? Responda com 1..${rows.length}.`;\n\n// (opcional) mapa √≠ndice->ordem_item, √∫til para validar a escolha depois\nconst mapa = rows.reduce((acc, r, i) => { acc[i+1] = r.ordem_item; return acc; }, {});\n\n// sa√≠da\nreturn [{ json: { texto, mapa, telefone: $('Code').first().json.telefone,user_id: $('Switch2').first().json.user_id , pedido_id: $('Switch2').first().json.pedido_id, id_empresa:$('Switch2').first().json.id_empresa }}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2160,-2432],"id":"e727b513-85e3-404c-9bb0-0c3a028cc303","name":"Code1"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"= {{ $('Code1').item.json.telefone }}","messageText":"=```{{ $('Code1').item.json.texto }}```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[2592,-2432],"id":"1454913a-fa8d-4a8f-a0b4-0939f5a9458b","name":"MenuCardapio2","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2848,-2432],"id":"f27b186a-01aa-45aa-aaf9-4b939da6e2c4","name":"No Operation, do nothing11","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.status }}","rightValue":"enviado","operator":{"type":"string","operation":"equals"},"id":"246ba127-2190-4f71-a40f-391fbb486e7e"}],"combinator":"and"},"renameOutput":true,"outputKey":"enviado"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"05d1e6c1-d1c9-47b0-8f78-a713103cbd81","leftValue":"={{ $json.status }}","rightValue":"=ingrediente","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"ingrediente"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"42bfacce-7528-4956-94c2-c8c1272e76c4","leftValue":"={{ $json.status }}","rightValue":"additem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"additem"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[912,-2320],"id":"79795890-6390-4dc1-90b9-ea2b92b614eb","name":"Switch2"},{"parameters":{"operation":"executeQuery","query":" select ordem_item, numero, tipo, categoria, nome , valor\n  from item_pedido_temp \n   where status = 'additem'  \n   and user_id =  {{ $('StatusPedidoAdd1').item.json.user_id }}\n   and pedido_id =  {{ $('StatusPedidoAdd1').item.json.pedido_id }}\n   and  id_empresa = {{ $('StatusPedidoAdd1').item.json.id_empresa }} ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1952,-2432],"id":"3e604ba2-ad58-433d-b0ba-7af864969809","name":"GetOp√ß√µeItens","alwaysOutputData":true,"credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"     select * from  addItemBorda ( 72, 36 , 1, 2, 'calabresa' , 'borda' );\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1200,-2112],"id":"678b0aef-cc73-4d76-a246-2148dee49c40","name":"InsereOpcItens","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" \n\n\nCALL ReordenarItensConcluidos( {{ $('StatusPedidoAdd1').item.json.user_id }}, {{ $('StatusPedidoAdd1').item.json.pedido_id }} , {{ $('StatusPedidoAdd1').item.json.id_empresa }} );\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2256,-2096],"id":"b84b298c-ba77-443f-a422-c15b5c48a6f4","name":"OrdenaPedido","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"=O seu objetivo √© montar sua pizza com suas pizzas que possuem varias op√ß√µes.\nUse no telefone      "}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2816,-2096],"id":"6d48f03f-bf45-4675-b36a-5ac9e556685e","name":"Carrinho4","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3120,-2096],"id":"fbf77afb-9e2b-48d3-a1cb-14dda13d030d","name":"No Operation, do nothing12","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"=  O seu item foi adicionado com sucesso! ","rotina":4,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{$('StatusPedidoAdd1').item.json.pedido_id }}","id_empresa":"={{ $('StatusPedidoAdd1').item.json.id_empresa }}","user_id":"={{ $('StatusPedidoAdd1').item.json.user_id }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2960,-1936],"id":"96378868-4008-433f-aad8-1086103d198d","name":"ExecutaMontagem6"},{"parameters":{"operation":"executeQuery","query":"update   item_pedido_temp  set  status = 'concluido'  \n   where status = 'additem'  \n   and user_id =  {{ $('StatusPedidoAdd1').item.json.user_id }}\n   and pedido_id =  {{ $('StatusPedidoAdd1').item.json.pedido_id }}\n   and  id_empresa = {{ $('StatusPedidoAdd1').item.json.id_empresa }}\n  and ordem_item =   {{ $('Code3').item.json.numero}};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1888,-2096],"id":"3fe3b245-ca14-4665-b1c0-57f0dfa98589","name":"AutalizaOpcaoCliente","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"delete from   item_pedido_temp   \n   where status = 'additem'  \n   and user_id   =  {{ $('StatusPedidoAdd1').item.json.user_id }}\n   and pedido_id  =  {{ $('StatusPedidoAdd1').item.json.pedido_id }}\n   and  id_empresa = {{ $('StatusPedidoAdd1').item.json.id_empresa }} ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2080,-2096],"id":"d6f4c615-7380-453a-9543-f7dd7390375f","name":"ExcluirOpcN√£oEscolhida","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='additem'  WHERE \n  user_id =  {{ $json.user_id }}\n  AND pedido_id = {{ $json.pedido_id }}    and id_empresa = {{ $json.id_empresa }} ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2368,-2432],"id":"797097ce-b82a-41f2-844c-002892f11877","name":"Ingrediente1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"jsCode":" // L√™ de MensagemTraduzida com fallbacks\nconst raw = (\n  $('MensagemTraduzida')?.item?.json?.message ??\n  $('MensagemTraduzida')?.item?.json?.mensagem ??\n  $json.message ?? $json.mensagem ?? ''\n).toString().trim();\n\n// 1) Se for s√≥ n√∫mero puro, ok\nif (/^\\d+$/.test(raw)) {\n  return [{ json: { numero: Number(raw), retorno: true } }];\n}\n\n// 2) Remove fra√ß√µes (ex.: \"1/2\") e extrai o primeiro inteiro\nconst semFracoes = raw.replace(/\\b\\d+\\/\\d+\\b/g, ' ');\nconst m = semFracoes.match(/\\b\\d+\\b/);\n\nif (m) {\n  return [{ json: { numero: Number(m[0]), retorno: true } }];\n}\n\nreturn [{ json: { numero: 0, retorno: false } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1024,-1904],"id":"49056b36-82f1-4142-94ec-2a1e72c37088","name":"Code3"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"=  {{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```Op√ß√£o de item ou borda invalido!!!```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1440,-1712],"id":"60cd350a-6532-4e7b-9941-aaa80beb854d","name":"MenuCardapio3","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1632,-1712],"id":"ef9291de-bfc9-41bb-a0ce-8b64e2f4172f","name":"No Operation, do nothing13","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c7c7469a-3a60-40c5-8b30-8ac37dce9e28","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1616,-1920],"id":"fbf69139-faff-4f16-a98f-7381e0a5744e","name":"If"},{"parameters":{"operation":"executeQuery","query":" SELECT (EXISTS (\n  SELECT 1\n  FROM item_pedido_temp\n  WHERE status = 'additem'\n    AND user_id   = {{ $('StatusPedidoAdd1').item.json.user_id }}\n    AND pedido_id = {{ $('StatusPedidoAdd1').item.json.pedido_id }}\n    AND id_empresa = {{ $('StatusPedidoAdd1').item.json.id_empresa }}\n    AND ordem_item = {{ $json.numero }}\n))::int AS retorno;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1440,-1920],"id":"ad2e82f0-d1cd-47c2-a721-b99f1d48c81b","name":"PossuiItem","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"=  {{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```Op√ß√£o de item ou borda invalido!!!```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1872,-1904],"id":"2d59002c-5d44-4575-974b-aa259d307553","name":"MenuCardapio4","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2096,-1904],"id":"6d5cf2ac-576c-46c7-91aa-06cc694cef00","name":"No Operation, do nothing14","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":" update pedido_temp set status ='enviado'  WHERE \n  user_id =   {{ $('StatusPedidoAdd1').item.json.user_id }}\n  AND pedido_id =  {{ $('StatusPedidoAdd1').item.json.pedido_id }}  \n  and id_empresa =   {{ $('StatusPedidoAdd1').item.json.id_empresa }} ;\n\n    \n    ","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2416,-2096],"id":"ed4157ef-ad10-4fec-9b03-09f08080cf20","name":"Ingrediente2","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Dados Lead').item.json.IdConversa }}","messageText":"=```O seu item ou borda foi adicionado com sucesso!!!üéØ```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[2608,-2096],"id":"fc71f57a-57ea-4829-a020-7ea333d8ad45","name":"MenuCardapio5","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"operation":"executeQuery","query":" select * from  addItemBorda ( {{ $('StatusPedidoAdd1').item.json.user_id }}, {{ $('StatusPedidoAdd1').item.json.pedido_id }} , {{ $('StatusPedidoAdd1').item.json.id_empresa }}, {{ $json.item_numero }}, '{{ $json.nome }}' , '{{ $json.categoria }}' );\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1424,-2304],"id":"53ed8b27-9ac3-450c-9a8a-f7255976049f","name":"InsereOpcItens1","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6b1df564-f8b3-481b-b3ce-fb6bd4538c23","leftValue":"={{ $json.additemborda }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1600,-2304],"id":"a9724cd3-2fbd-45f2-a7ce-bc9fbe91781b","name":"If3"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"={{ $('Code').item.json.telefone }}","messageText":"=```N√£o foi encontrados op√ß√µes da {{ $('Code').item.json.categoria }} {{ $('Code').item.json.nome }}   ```","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1952,-2256],"id":"ad3ad137-fefc-43fe-94b2-a6940a1dd18a","name":"MenuCardapio6","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2160,-2256],"id":"e1530729-d5e5-46cc-a7f3-d29383caf28c","name":"No Operation, do nothing15","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"jsCode":"\n// aceita {acao:\"...\"} ou text:'{\"acao\":\"...\"}'\nlet acao = $json.acao;\n\nif (!acao && typeof $json.text === 'string') {\n  try { acao = JSON.parse($json.text).acao; } catch {}\n}\nacao = String(acao || '').toLowerCase();\n\nconst precisa = new Set(['cardapio_online', 'adicionar_item']); // acrescente aqui se quiser\nreturn [{ json: { resolve: precisa.has(acao), acao } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-7088,-2880],"id":"b53411cf-fbb6-424c-8682-715aab42e920","name":"Code4"},{"parameters":{"assignments":{"assignments":[{"id":"7413dfd7-1dbd-4551-be34-2e1c6e8181ec","name":"texto","value":"={{ $json.messages[0] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-10080,-2880],"id":"11e74d39-bc79-49da-b5a2-58d55b8e394d","name":"FielsMsgBuffer"},{"parameters":{"jsCode":" const input =   $input.first().json.texto  || \"\";\n\n// 1) min√∫sculas\nlet clean = input.toLowerCase();\n\n// 2) remove moeda: \"r$\", \"r $\", \"$\"\nclean = clean.replace(/r\\s*\\$/gi, \"\").replace(/\\$/g, \"\");\n\n// 3) remove o \"r\" (ou qualquer letra) deixado ANTES de n√∫mero/1/2: \"r 6\", \"r 1/2\"\nclean = clean.replace(/\\b[a-z√†-√ø]\\s+(?=(\\d|1\\/2)\\b)/gi, \"\");\n\n// 4) mant√©m s√≥ letras/n√∫meros/espa√ßo e \"/\" (tira resto de s√≠mbolos)\nclean = clean.replace(/[^0-9a-z√†-√ø\\s/,.]/g, \" \");\n\n// 5) normaliza plurais comuns\nclean = clean.replace(/\\bpizzas\\b/g, \"pizza\")\n             .replace(/\\besfirras\\b/g, \"esfirra\");\n\n// 6) palavras de quantidade -> n√∫mero (antes de \"pizza\")\nclean = clean.replace(/\\b(uma|um)\\b(?=\\s+pizza\\b)/g, \"1\")\n             .replace(/\\b(duas|dois)\\b(?=\\s+pizza\\b)/g, \"2\")\n             .replace(/\\b(tr√™s|tres)\\b(?=\\s+pizza\\b)/g, \"3\");\n\n// 7) \"meia\" -> \"1/2\"\nclean = clean.replace(/\\bmeia\\b/g, \"1/2\");\n\n// 8) corrige \"6,19\" ou \"6.19\" -> \"1/2 19\"\nclean = clean.replace(/6[,.](\\d{1,2})\\b/g, \"1/2 $1\");\n\n// 9) padr√£o da transcri√ß√£o \"6 14 e 6 19\" -> \"1 pizza 1/2 14 e 1/2 19\"\nclean = clean.replace(/\\b6\\s+(\\d{1,2})(?:\\s*[,;]?\\s*e\\s*)6\\s+(\\d{1,2})\\b/g, \"1 pizza 1/2 $1 e 1/2 $2\");\n\n// 10) remove v√≠rgulas/pontos remanescentes que grudem nos n√∫meros (ex.: \"17,\" -> \"17\")\nclean = clean.replace(/[,.]/g, \" \");\n\n \n\n// 12) compacta espa√ßos\nclean = clean.replace(/\\s+/g, \" \").trim();\n\nreturn { original: input, comando_normalizado: clean };\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-9904,-2880],"id":"4b1fef49-8669-4a41-a55d-9ac7b97fea0f","name":"Normalizador"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":5,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}","instance":"= {{ $('Dados Lead').item.json.instance }}","apikey":"= {{ $('Dados Lead').item.json.apikey }}","acao":"={{ $('Acao').item.json.acao }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"instance","displayName":"instance","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"apikey","displayName":"apikey","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"acao","displayName":"acao","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-2688,-2048],"id":"b8efc517-a580-4312-80e4-ba9807ef8283","name":"AgenteVendas"},{"parameters":{"method":"POST","url":"=https://evolution.lglducci.com.br/message/sendText/LaCantina","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"=E9C6EA4E47E7-4905-BC38-475CBACA3F1E"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Webhook').item.json.body.data.key.remoteJid.replace(\"@s.whatsapp.net\",\"\") }}"},{"name":"text","value":"teste Conversational"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-14336,-2576],"id":"52b4635c-71e5-4cb4-ae6b-f8781db7c978","name":"HTTP Request"},{"parameters":{"content":"","height":4332,"width":15068,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-15376,-5040],"id":"42907832-95e7-416b-b27f-f420d2c1545b","name":"Sticky Note32"},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"mensagem":"={{ $('MensagemTraduzida').item.json.message }}","user_id":"={{ $('MergePedido').item.json.user_id }}   ","rotina":4,"telefone":"= {{ $('Dados Lead').item.json.IdConversa }}","pedido_id":"={{ $('MergePedido').item.json.pedido_id }}","id_empresa":"={{ $('DadosEmpresa').item.json.id_empresa }}","instance":"={{ $('Dados Lead').item.json.instance }}","apikey":"={{ $('Dados Lead').item.json.apikey }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"instance","displayName":"instance","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"apikey","displayName":"apikey","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-2624,-2368],"id":"c7a5c228-3f27-479b-a0e4-41485560fc58","name":"ToolsCarrinho"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1bd6c365-d077-4284-9dfe-94db1cbe39bd","leftValue":"={{ $('Buffer 3').item.json.messages.last() }}","rightValue":"={{ $('Buffer ').item.json.messages.last() }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-10448,-2800],"id":"4ffac93b-8dd4-4edf-97a0-55e82adc4661","name":"ComparandoMensagens1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"}],"connections":{"Encontrar Cliente1":{"main":[[{"node":"Cliente Existe?1","type":"main","index":0}]]},"Cliente Existe?1":{"main":[[{"node":"Concatena","type":"main","index":0}],[{"node":"Criar Cliente1","type":"main","index":0}]]},"Criar Cliente1":{"main":[[{"node":"Concatena","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"EncontrarPedido","type":"main","index":0}]]},"Dados Lead":{"main":[[{"node":"Execute a SQL query1","type":"main","index":0}]]},"Parametros Fluxo":{"main":[[{"node":"Filtro Inicial1","type":"main","index":0}]]},"Concatena":{"main":[[{"node":"Merge1","type":"main","index":0}],[{"node":"Merge1","type":"main","index":1}]]},"Filtro Inicial1":{"main":[[{"node":"Dados Lead","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Menu","type":"ai_languageModel","index":0}]]},"MsgUsuario":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"Switch":{"main":[[{"node":"CancelarPedido","type":"main","index":0}],[{"node":"Fechamento","type":"main","index":0}],[{"node":"Atendimento Ajuda","type":"main","index":0}],[{"node":"ExcluiRejeitados1","type":"main","index":0}],[{"node":"Atendimento Ajuda","type":"main","index":0}],[{"node":"Atendimento Ajuda","type":"main","index":0}],[{"node":"Numero","type":"main","index":0}],[],[],[{"node":"Atendimento Ajuda","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Parametros Fluxo","type":"main","index":0}]]},"Menu":{"main":[[{"node":"Code4","type":"main","index":0}]]},"ExcluiRejeitados":{"main":[[{"node":"MenuCardapio15","type":"main","index":0}]]},"Cliente Pedido":{"main":[[{"node":"MergePedido","type":"main","index":0}],[{"node":"CriaPedido","type":"main","index":0}]]},"EncontrarPedido":{"main":[[{"node":"Cliente Pedido","type":"main","index":0}]]},"CriaPedido":{"main":[[{"node":"MergePedido","type":"main","index":1}]]},"MergePedido":{"main":[[{"node":"Menu","type":"main","index":0}]]},"CancelarPedido":{"main":[[{"node":"If5","type":"main","index":0}]]},"Acao":{"main":[[{"node":"Switch","type":"main","index":0}]]},"If5":{"main":[[{"node":"MenuCardapio23","type":"main","index":0}],[{"node":"MenuCardapio24","type":"main","index":0}]]},"MontPedido":{"main":[[{"node":"Code2","type":"main","index":0}]]},"ExcluiRejeitados1":{"main":[[{"node":"Carrinho1","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Criar Pedido","type":"main","index":0}]]},"MenuCardapio15":{"main":[[{"node":"MontPedido","type":"main","index":0}]]},"MenuCardapio23":{"main":[[{"node":"No Operation, do nothing2","type":"main","index":0}]]},"MenuCardapio24":{"main":[[{"node":"No Operation, do nothing21","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Mensagem Texto1","type":"main","index":0}],[{"node":"Mensagem Texto2","type":"main","index":0}],[{"node":"Mensagem Audio1","type":"main","index":0}],[{"node":"Mensagem Imagem1","type":"main","index":0}],[{"node":"Mensagem Documento PDF","type":"main","index":0}],[{"node":"Mensagem Erro1","type":"main","index":0}]]},"Transcrever √Åudio1":{"main":[[{"node":"Add Audio Buffer1","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"Add Imagem Buffer1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Buffer 3","type":"main","index":0}]]},"Buffer ":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Buffer 3":{"main":[[{"node":"ComparandoMensagens1","type":"main","index":0}]]},"Add Texto Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Apagar Buffer1":{"main":[[{"node":"FielsMsgBuffer","type":"main","index":0}]]},"Mensagem Texto1":{"main":[[{"node":"Add Texto Buffer1","type":"main","index":0}]]},"Mensagem Audio1":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Mensagem Imagem1":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Add Audio Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Add Error Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Add PDF Buffer1","type":"main","index":0}]]},"Mensagem Erro1":{"main":[[{"node":"Add Error Buffer1","type":"main","index":0}]]},"Add PDF Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Add Imagem Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Redis":{"main":[[{"node":"Bot Desativado?1","type":"main","index":0}]]},"Bot Desativado?1":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"Switch1","type":"main","index":0}]]},"Mensagem Documento PDF":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"Transcrever √Åudio1","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Mensagem Texto2":{"main":[[{"node":"Add Texto Buffer1","type":"main","index":0}]]},"MensagemTraduzida":{"main":[[{"node":"Encontrar Cliente1","type":"main","index":0}]]},"No Operation, do nothing6":{"main":[[]]},"If7":{"main":[[{"node":"MsgUsuario1","type":"main","index":0}],[{"node":"MsgUsuario","type":"main","index":0}]]},"MsgUsuario1":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Acao","type":"main","index":0}]]},"MenuCardapio36":{"main":[[{"node":"OrdenaPedido1","type":"main","index":0}]]},"OrdenaPedido1":{"main":[[{"node":"No Operation, do nothing31","type":"main","index":0}]]},"ConsultarCardapio":{"main":[[{"node":"Inten√ß√µes","type":"main","index":0}]]},"Numero":{"main":[[{"node":"ExcluiBorda","type":"main","index":0}]]},"Excluir Item":{"main":[[{"node":"MenuCardapio36","type":"main","index":0}]]},"ExcluiBorda":{"main":[[{"node":"Excluir Item","type":"main","index":0}]]},"Validador":{"main":[[{"node":"MensagemTraduzida","type":"main","index":0}]]},"Call n8n Workflow Tool":{"ai_tool":[[{"node":"Criar Pedido","type":"ai_tool","index":0}]]},"Call n8n Workflow Tool2":{"ai_tool":[[{"node":"Fechamento","type":"ai_tool","index":0}]]},"ExecutaMontagem":{"ai_tool":[[{"node":"Montagem","type":"ai_tool","index":0}]]},"Atendimento Ajuda":{"main":[[{"node":"No Operation, do nothing30","type":"main","index":0}]]},"Criar Pedido":{"main":[[{"node":"No Operation, do nothing22","type":"main","index":0}]]},"Carrinho1":{"main":[[{"node":"No Operation, do nothing29","type":"main","index":0}]]},"Montagem":{"main":[[{"node":"No Operation, do nothing23","type":"main","index":0}]]},"MenuCardapio1":{"main":[[{"node":"No Operation, do nothing10","type":"main","index":0}]]},"Fechamento":{"main":[[{"node":"No Operation, do nothing25","type":"main","index":0}]]},"Finalizar":{"main":[[]]},"Call n8n Workflow Tool3":{"ai_tool":[[{"node":"ChamaPrecarrinho","type":"ai_tool","index":0}]]},"If1":{"main":[[{"node":"ChamaPrecarrinho","type":"main","index":0}],[]]},"ChamaPrecarrinho":{"main":[[{"node":"Finalizar","type":"main","index":0}]]},"StatusPedido":{"main":[[{"node":"If1","type":"main","index":0}]]},"If6":{"main":[[{"node":"StatusPedido","type":"main","index":0}],[{"node":"MenuCardapio34","type":"main","index":0}]]},"MenuCardapio34":{"main":[[{"node":"No Operation, do nothing33","type":"main","index":0}]]},"VerificaCarrinhoVazio":{"main":[[{"node":"If6","type":"main","index":0}]]},"Execute a SQL query1":{"main":[[{"node":"DadosEmpresa","type":"main","index":0}]]},"DadosEmpresa":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Inten√ß√µes":{"main":[[{"node":"Carrinho","type":"main","index":0}]]},"ExecutaMontagem4":{"ai_tool":[[{"node":"Carrinho","type":"ai_tool","index":0}]]},"Carrinho":{"main":[[{"node":"No Operation, do nothing7","type":"main","index":0}]]},"SairAjuda":{"main":[[{"node":"MenuCardapio1","type":"main","index":0}]]},"ExecutaMontagem5":{"ai_tool":[[{"node":"Carrinho3","type":"ai_tool","index":0}]]},"Ingrediente":{"main":[[{"node":"Carrinho3","type":"main","index":0}]]},"StatusPedidoAdd1":{"main":[[{"node":"Switch2","type":"main","index":0}]]},"IfStatusPedido":{"main":[[{"node":"PossuiItem","type":"main","index":0}],[{"node":"MenuCardapio3","type":"main","index":0}]]},"Carrinho3":{"main":[[{"node":"No Operation, do nothing8","type":"main","index":0}]]},"Code":{"main":[[{"node":"InsereOpcItens1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Ingrediente1","type":"main","index":0}]]},"MenuCardapio2":{"main":[[{"node":"No Operation, do nothing11","type":"main","index":0}]]},"Switch2":{"main":[[{"node":"Ingrediente","type":"main","index":0}],[{"node":"Code","type":"main","index":0}],[{"node":"Code3","type":"main","index":0}]]},"GetOp√ß√µeItens":{"main":[[{"node":"Code1","type":"main","index":0}]]},"InsereOpcItens":{"main":[[]]},"OrdenaPedido":{"main":[[{"node":"Ingrediente2","type":"main","index":0}]]},"Carrinho4":{"main":[[{"node":"No Operation, do nothing12","type":"main","index":0}]]},"ExecutaMontagem6":{"ai_tool":[[{"node":"Carrinho4","type":"ai_tool","index":0}]]},"AutalizaOpcaoCliente":{"main":[[{"node":"ExcluirOpcN√£oEscolhida","type":"main","index":0}]]},"ExcluirOpcN√£oEscolhida":{"main":[[{"node":"OrdenaPedido","type":"main","index":0}]]},"Ingrediente1":{"main":[[{"node":"MenuCardapio2","type":"main","index":0}]]},"Code3":{"main":[[{"node":"IfStatusPedido","type":"main","index":0}]]},"MenuCardapio3":{"main":[[{"node":"No Operation, do nothing13","type":"main","index":0}]]},"PossuiItem":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"AutalizaOpcaoCliente","type":"main","index":0}],[{"node":"MenuCardapio4","type":"main","index":0}]]},"MenuCardapio4":{"main":[[{"node":"No Operation, do nothing14","type":"main","index":0}]]},"Ingrediente2":{"main":[[{"node":"MenuCardapio5","type":"main","index":0}]]},"MenuCardapio5":{"main":[[{"node":"Carrinho4","type":"main","index":0}]]},"If3":{"main":[[{"node":"GetOp√ß√µeItens","type":"main","index":0}],[{"node":"MenuCardapio6","type":"main","index":0}]]},"MenuCardapio6":{"main":[[{"node":"No Operation, do nothing15","type":"main","index":0}]]},"InsereOpcItens1":{"main":[[{"node":"If3","type":"main","index":0}]]},"FielsMsgBuffer":{"main":[[{"node":"Normalizador","type":"main","index":0}]]},"Code4":{"main":[[{"node":"If7","type":"main","index":0}]]},"Normalizador":{"main":[[{"node":"Validador","type":"main","index":0}]]},"AgenteVendas":{"ai_tool":[[{"node":"Atendimento Ajuda","type":"ai_tool","index":0}]]},"ToolsCarrinho":{"ai_tool":[[{"node":"Carrinho1","type":"ai_tool","index":0}]]},"ComparandoMensagens1":{"main":[[{"node":"Apagar Buffer1","type":"main","index":0}],[{"node":"No Operation, do nothing6","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.lglducci.com.br","user-agent":"axios/1.7.7","content-length":"937","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"159.69.117.195","cf-ipcountry":"DE","cf-ray":"98e88c158cd03813-FRA","cf-visitor":"{\"scheme\":\"https\"}","content-type":"application/json","x-forwarded-for":"162.158.95.135","x-forwarded-host":"n8n.lglducci.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"traefik_traefik.1","x-real-ip":"162.158.95.135"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"LaCantina","data":{"key":{"remoteJid":"5516992975836@s.whatsapp.net","fromMe":false,"id":"3EB013725F9A85FA25FB92"},"pushName":"Luis Gustavo Landucci","message":{"conversation":"fechar","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"2uKRt0FvHGKKWg==","senderTimestamp":"1760382036","senderAccountType":"E2EE","receiverAccountType":"E2EE","recipientKeyHash":"wPv/XIryFk6EMg==","recipientTimestamp":"1760388519"},"deviceListMetadataVersion":2,"messageSecret":"m77M95HmgMNU/TKV3TobaJFbZvk6JFulSWFx1e0iTyc="}},"messageType":"conversation","messageTimestamp":1760460327,"instanceId":"cd2747c1-47c6-49d2-9649-45970ef316b7","source":"web"},"destination":"https://n8n.lglducci.com.br/webhook-test/agente_delivery","date_time":"2025-10-14T13:45:27.222Z","sender":"5516994066336@s.whatsapp.net","server_url":"https://evolution.lglducci.com.br","apikey":"E9C6EA4E47E7-4905-BC38-475CBACA3F1E"},"webhookUrl":"https://webhook.lglducci.com.br/webhook-test/agente_delivery","executionMode":"test"}}]},"versionId":"6a77d96c-ca1b-4a0d-b0d5-3d1a9ceea668","triggerCount":1,"shared":[{"createdAt":"2025-09-07T00:48:12.031Z","updatedAt":"2025-09-07T00:48:12.031Z","role":"workflow:owner","workflowId":"9WftJMMBMRPnj8NP","projectId":"wFRMrac2003Pl1x6"}],"tags":[{"createdAt":"2025-09-07T00:48:06.709Z","updatedAt":"2025-09-07T00:48:06.709Z","id":"oyXqUAJNw26h8Z5c","name":"github"}]}