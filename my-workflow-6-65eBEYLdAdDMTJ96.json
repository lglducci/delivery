{"createdAt":"2025-09-18T19:42:42.998Z","updatedAt":"2025-09-22T00:20:04.532Z","id":"65eBEYLdAdDMTJ96","name":"My workflow 6","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"352bc8cf-b483-42b6-948d-1d4acef5d98a","name":"No Operation, do nothing","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[4288,2800]},{"parameters":{"assignments":{"assignments":[{"id":"69f6217f-9063-423f-abf4-e94f6b70f94e","name":"ClienteNome","value":"={{ $('Webhook').item.json.body.senderName }}","type":"string"},{"id":"9f488c5c-0b3b-48e9-87b1-5a22d513d1ec","name":"ClienteTelefone","value":"={{ $('Webhook').item.json.body.phone }}","type":"string"},{"id":"1ae1a51c-00cb-47f9-8dc8-5a05c66fc0c8","name":"Mensagem","value":"={{ $json.body.text.message }}","type":"string"}]},"includeOtherFields":"=","options":{}},"id":"8e453dfa-3b23-421d-828e-a1ea2359b531","name":"Simplificação de Dados","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1328,2800]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"24aa4532-80db-4c1e-977a-0036b82a8e5f","leftValue":"={{ $json.body.isEdit }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"204f54b0-e3ed-4ff4-8302-8c20d3b8aa78","leftValue":"={{ $json.body.isGroup }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"130cc493-a17a-4cc1-955b-816799583076","leftValue":"={{ $json.body.isNewsletter }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"c51986d9-f347-4198-89bb-9e4cd0f021c9","leftValue":"={{ $json.body.broadcast }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"cc7281fe-f597-43d4-820e-241f0f4c0410","leftValue":"={{ $json.body.fromApi }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"id":"4393509e-c8e1-4d54-9c1c-1f11e5662cb9","name":"Filtro Inicial","type":"n8n-nodes-base.filter","typeVersion":2.1,"position":[-1520,2800]},{"parameters":{"operation":"get","tableId":"usuarios","filters":{"conditions":[{"keyName":"whatsapp","keyValue":"={{ $json.ClienteTelefone }}"}]}},"id":"81c95e0d-50e2-4db9-b368-3d9ff544b076","name":"Buscar Cliente","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1104,2800],"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"c3fd7613-624e-4e82-b840-a77a8f6de82e","name":"Cliente Existe?","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-880,2800],"alwaysOutputData":false},{"parameters":{"tableId":"usuarios","fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $('Simplificação de Dados').item.json.ClienteNome }}"},{"fieldId":"whatsapp","fieldValue":"={{ $('Simplificação de Dados').item.json.ClienteTelefone }}"},{"fieldId":"thread_id","fieldValue":"={{ $json.id }}"}]}},"id":"82cb8fff-29b3-478d-8635-5178a98d62d3","name":"Criar Cliente","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-464,2864]},{"parameters":{"method":"POST","url":"https://api.z-api.io/instances/3CCB76D5C423A0191FA39E692ED0BBB5/token/2FEBF455B542CA12B231414C/send-text","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"phone","value":"={{ $('Simplificação de Dados').item.json.ClienteTelefone }}"},{"name":"message","value":"={{ $json.data[0].content[0].text.value }}"}]},"options":{}},"id":"3ca2ed8e-c683-4338-9af6-21cad09f2172","name":"(Z-API) Enviar Mensagem","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4112,2800]},{"parameters":{},"id":"8ef8605c-511d-4021-9ddd-9c5f6b9e1759","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":3,"position":[-240,2800]},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/threads","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"475776ce-d171-4dca-a5f1-14c0cf3b5d21","name":"[OpenAI] Criar Thread","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-624,2864]},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $json.thread_id }}/runs","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"assistant_id","value":"asst_WwQOWO13uP5MlZDFoLroEuev"}]},"options":{}},"id":"7c04dfb8-83e0-4df8-b7de-cf0524f377fd","name":"[OpenAI] Criar Run","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[384,2800]},{"parameters":{"errorMessage":"Algum erro na execução na Run"},"id":"2f9e69dc-1dfe-4a7e-a109-7778e750b3e1","name":"Stop and Error","type":"n8n-nodes-base.stopAndError","typeVersion":1,"position":[1296,3040]},{"parameters":{"amount":3},"id":"85c418ec-d99b-4326-9759-f986e1060f57","name":"Espera 3 seg","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[592,2800],"webhookId":"34bdfd2e-07e9-4436-95cb-87d8a1893014"},{"parameters":{"url":"=https://api.openai.com/v1/threads/{{ $('Merge').item.json.thread_id }}/runs","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"67b5bc80-791a-47d4-9963-4aebc80fd920","name":"[OpenAI] Listar Runs","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[176,3008]},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $('Merge').item.json.thread_id }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"role","value":"user"},{"name":"content","value":"={{ $('Simplificação de Dados').item.json.Mensagem }}"}]},"options":{}},"id":"b743b3b8-7700-4dd9-b1a8-9aad260e614c","name":"[OpenAI] Adicionar Mensagem na Thread","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[144,2800],"onError":"continueErrorOutput"},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $json.data[0].thread_id }}/runs/{{ $json.data[0].id }}/cancel","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"4e1769eb-1972-48f6-b04b-bc1cd6586708","name":"[OpenAI] Cancelar Run","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[176,3216]},{"parameters":{"fieldToSplitOut":"tool_calls","options":{}},"id":"ddc588d9-5c7d-4735-b51c-12d50e65b9e2","name":"Split Out","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1504,2368]},{"parameters":{"assignments":{"assignments":[{"id":"28ce9dad-36a0-4015-9072-a74e35bcd33a","name":"name","value":"={{ $json.function.name }}","type":"string"},{"id":"0156c707-54c3-4bc8-a404-5810683ddc2f","name":"arguments","value":"={{ $json.function.arguments }}","type":"string"},{"id":"15947de1-0f0f-4968-a40c-7e36a540ea6d","name":"type","value":"={{ $json.type }}","type":"string"},{"id":"00f6f57f-7f82-4193-afd8-ded4c5824cad","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"id":"71adba2c-f769-4449-9d53-43d0eb06f14a","name":"Dados individuais das tools","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1680,2368]},{"parameters":{"assignments":{"assignments":[{"id":"44673af0-d1a2-46a4-aa4a-42df4a6270a4","name":"arguments","value":"={{ $json.arguments }}","type":"object"}]},"includeOtherFields":true,"options":{}},"id":"07dbf85f-c0a1-4a3b-95ba-1ce79eb33d09","name":"Argumentos da Tools","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2080,2400]},{"parameters":{"assignments":{"assignments":[{"id":"83ad07d2-6655-4675-8ea6-8d4bd6296f5c","name":"thread_id","value":"={{ $json.thread_id }}","type":"string"},{"id":"b00c6dba-371d-4aa2-900f-a108f112cace","name":"run_id","value":"={{ $json.id }}","type":"string"},{"id":"1aa088be-5f08-48aa-a30d-27ce153fae36","name":"tool_calls","value":"={{ $json.required_action.submit_tool_outputs.tool_calls }}","type":"array"}]},"options":{}},"id":"19823d72-0e46-4be0-89a7-c2a1dfa9a6af","name":"Parâmentros das Tools","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1328,2368]},{"parameters":{"url":"=https://api.openai.com/v1/threads/{{ $json.thread_id }}/runs/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"c39b42e8-7bd7-4bc1-9509-b5f4d38eda21","name":"[OpenAI] Buscar Status da Run","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[816,2800]},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"tool_outputs","options":{}},"id":"4f1130fa-fa24-4934-8678-d5a7c34dc23f","name":"Aggregate","type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1984,2016]},{"parameters":{"assignments":{"assignments":[{"id":"411123bf-7975-4d79-a766-351a605f414c","name":"tool_outputs","value":"={{ $json.tool_outputs }}","type":"string"}]},"options":{}},"id":"a5b739fe-9890-4d20-82c6-a42c0ba22e35","name":"Edit Fields5","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2144,2016]},{"parameters":{"method":"POST","url":"https://sandbox.asaas.com/api/v3/customers","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/json"},{"name":"accept","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"name","value":"={{ $('Argumentos da Tools').item.json.arguments.cliente_nome }}"},{"name":"cpfCnpj","value":"={{ $('Argumentos da Tools').item.json.arguments.cliente_cpf }}"}]},"options":{}},"id":"82f97347-5787-4722-b7f8-48b19a3728bf","name":"Criar Cliente1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2976,1456]},{"parameters":{"method":"POST","url":"https://sandbox.asaas.com/api/v3/payments","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"application/json"},{"name":"content-type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"billingType","value":"PIX"},{"name":"customer","value":"={{ $json.id }}"},{"name":"value","value":"={{ $('Buscar Produto').item.json.valor }}"},{"name":"dueDate","value":"={{$now.plus(2, 'days')}}"},{"name":"description","value":"=Link de pagamento para Formação {{ $('Buscar Produto').item.json.nome }} da NoCode StartUp.\n\nSeja bem vindo!"},{"value":"={{ $now.plus(2, 'days') }}"}]},"options":{}},"id":"55b2632d-f8fe-4edb-99d1-56fc6b821372","name":"Criar Link Checkout","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3152,1456]},{"parameters":{"content":"## Gestão de usuários e conversas","height":470.66144701482347,"width":1548.498147684436,"color":4},"id":"e2af37c5-c8e0-4c58-b654-41cdf44e3fc3","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1616,2624]},{"parameters":{"operation":"get","tableId":"usuarios","filters":{"conditions":[{"keyName":"whatsapp","keyValue":"={{ $('Simplificação de Dados').item.json.ClienteTelefone }}"}]}},"id":"dd9fd34e-23ec-4fdc-9d26-b1011335a0b4","name":"Buscar usuário","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2800,896]},{"parameters":{"operation":"get","tableId":"produtos","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $('Argumentos da Tools').item.json.arguments.id_produto }}"}]}},"id":"5930123e-f4e2-418a-bfb2-84aa2920f7f8","name":"Buscar Produto","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2800,1456]},{"parameters":{"tableId":"pedidos","fieldsUi":{"fieldValues":[{"fieldId":"asaas_id","fieldValue":"={{ $('Criar Link Checkout').item.json.id }}"},{"fieldId":"status","fieldValue":"={{ $('Criar Link Checkout').item.json.status }}"},{"fieldId":"usuario_id","fieldValue":"={{ $json.id }}"},{"fieldId":"produto_id","fieldValue":"={{ $('Buscar Produto').item.json.id }}"}]}},"id":"13375420-58bb-4087-bd87-a1c1b1dfea33","name":"Criar Pedido","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3520,1456],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"content":"## Loop Funções","height":384.7161754466947,"width":1278.236022443546,"color":6},"id":"2a35e897-775f-4337-90bb-fadbf0124ed8","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1200,2240]},{"parameters":{"content":"## Função 1: getProdutos","height":633.1431906329082,"width":1194.3096289795617,"color":3},"id":"88083696-2d7a-44b0-b1bd-4e9cefa5cdc8","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2704,1984]},{"parameters":{"content":"## Função 3: getUsers","height":572.1848462438363,"width":1189.3614743141625,"color":3},"id":"bd549217-9a0c-4efc-a227-4d9ffe388d79","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2704,736]},{"parameters":{"content":"## Função 2: postPedidos","height":572.1848462438363,"width":1200.9071685334256,"color":3},"id":"39f2bcbe-296b-49d4-8878-12f97bb8af28","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2704,1360]},{"parameters":{"content":"## Respondendo Função","height":261.7237534100784,"width":589.0475656915123,"color":6},"id":"3a55d6b6-10a7-4217-90d3-5442603a8e05","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1904,1952]},{"parameters":{"content":"## Respondendo Usuário","height":297.2479283127495,"width":478.7211802391986,"color":7},"id":"ef60c3af-79f2-4e25-9bdf-958c524f392c","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[4048,2704]},{"parameters":{"content":"## Agente IA","height":3486.241122797087,"width":3978.3019178628183,"color":5},"id":"a80139ce-4477-4a6b-b7fc-633e04b990d7","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{"content":"## Gatilhos","height":470.66144701482347,"width":401.92272567732755},"id":"ffae2943-01df-47f0-9e6f-c543682b7d18","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2080,2624]},{"parameters":{"content":"## Função 4: updateUser","height":572.1848462438363,"width":1181.114549871832,"color":3},"id":"6b640cb8-eec8-4abb-8925-80542a64dac6","name":"Sticky Note11","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2704,128]},{"parameters":{"operation":"get","tableId":"usuarios","filters":{"conditions":[{"keyName":"whatsapp","keyValue":"={{ $('Simplificação de Dados').item.json.ClienteTelefone }}"}]}},"id":"4028311f-65f2-4b71-b373-71d556f9bd8f","name":"Supabase","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3344,1456]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"d0132960-a69b-46f0-ab2b-7fe3b67c965d","leftValue":"={{ $json.status }}","rightValue":"requires_action","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"requires_action"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"a8e31c39-770b-47f4-9d72-62ba8cd3ed96","leftValue":"={{ $json.status }}","rightValue":"completed","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"completed"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"9c3456a0-d550-4b1e-9eea-8e620c31b2f2","leftValue":"={{ $json.status }}","rightValue":"in_progress","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"in_progress"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"error"}},"id":"7023ca94-fc8e-48bc-a92a-3640e3255929","name":"Qual o status da Run?","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[1056,2800]},{"parameters":{"operation":"getAll","tableId":"produtos","filters":{"conditions":[{"keyName":"categoria","condition":"eq","keyValue":"={{ $json.arguments.categoria }}"}]}},"id":"c49207e3-077c-4ff2-a434-503287fbe214","name":"Buscar protudos pela categoria","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3024,2320]},{"parameters":{"operation":"getAll","tableId":"produtos","filters":{"conditions":[{"keyName":"nome","condition":"ilike","keyValue":"={{ $json.arguments.nome }}*"}]}},"id":"cd85b7c1-7b88-4e8f-8283-a67fc4f33d0e","name":"Buscar Produtos pelo Nome","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3024,2160],"alwaysOutputData":true},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"concatenate","field":"produto"}]},"options":{}},"id":"01264209-445d-4beb-b11b-2142e7a0d96d","name":"Concatenando String","type":"n8n-nodes-base.summarize","typeVersion":1,"position":[3696,2240]},{"parameters":{"assignments":{"assignments":[{"id":"3a3fbf83-7260-4dfa-97f2-4f323816d776","name":"tool_call_id","value":"={{ $('Argumentos da Tools').item.json.id }}","type":"string"},{"id":"3c185636-3fe8-4d4b-8a6b-e3bf5613c503","name":"output","value":"={{ $json.concatenated_produto }}","type":"string"}]},"options":{}},"id":"c55f4581-6a66-4187-9290-1df12a78429c","name":"Resposta da Tool getCursos","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3696,2416]},{"parameters":{"assignments":{"assignments":[{"id":"e812113e-dd46-486a-82fc-e14855c2be8c","name":"produto","value":"=(ID: {{ $json.id }}, nome: {{ $('Merge1').item.json.nome }}, valor: {{ $('Merge1').item.json.valor }}, proxima turma: {{ $('Merge1').item.json.proxima_turma }}, categoria: {{ $('Merge1').item.json.categoria }})","type":"string"}]},"options":{}},"id":"f18a8d70-f228-4b21-bb86-a9f93e71c072","name":"Construindo String","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3488,2240]},{"parameters":{"operation":"update","tableId":"usuario_lacantina","filters":{"conditions":[{"keyName":"whatsapp","condition":"eq","keyValue":"={{ $('Simplificação de Dados').item.json.ClienteTelefone }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"cpf","fieldValue":"={{ $json.arguments.cliente_cpf }}"},{"fieldId":"nome","fieldValue":"={{ $json.arguments.cliente_nome }}"}]}},"id":"9465a211-cf88-40be-8926-929c304b26c1","name":"Atualizar Usuário","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2800,272],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"options":{"reset":"={{ $node['Loop Over Items'].context[\"done\"] }}"}},"id":"3e3b9b77-9743-4e5b-b03a-43db0da4d91c","name":"Loop Over Items","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1904,2368]},{"parameters":{"assignments":{"assignments":[{"id":"b5eaff7e-ca80-444b-93a6-2a9de03ffa22","name":"usuario","value":"=(nome: {{ $json.nome }}, cpf: {{ $json.cpf }})","type":"string"}]},"options":{}},"id":"cb162a19-867b-4426-b72c-5a49bbd46d2d","name":"Construindo String1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2976,896]},{"parameters":{"assignments":{"assignments":[{"id":"6412cebd-4191-453b-97d3-8e302756396c","name":"tool_call_id","value":"={{ $('Argumentos da Tools').item.json.id }}","type":"string"},{"id":"a2e8d52a-04e2-4fbf-876c-cbc3c3348d25","name":"output","value":"={{ $json.usuario }}","type":"string"}]},"options":{}},"id":"7c6c3e6a-fa15-4a26-824a-228735c32139","name":"Resposta da Tool getUsers","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2976,1072]},{"parameters":{"method":"POST","url":"=https://api.openai.com/v1/threads/{{ $('Parâmentros das Tools').item.json.thread_id }}/runs/{{ $('Parâmentros das Tools').item.json.run_id }}/submit_tool_outputs","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"tool_outputs\": {{ $json.tool_outputs }}\n}","options":{}},"id":"8b1f00a7-ef52-4d56-a8b6-99dd245e567e","name":"Responder a Function Calling","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2304,2016]},{"parameters":{"assignments":{"assignments":[{"id":"9151a058-7dd6-4ca2-8e99-354d5f4e22a4","name":"link de pagamento","value":"=(URL: {{ $('Criar Link Checkout').item.json.invoiceUrl }})","type":"string"}]},"options":{}},"id":"2822f957-9312-4efa-8c32-534b9da53640","name":"Construindo String2","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3696,1456]},{"parameters":{"assignments":{"assignments":[{"id":"3a3fbf83-7260-4dfa-97f2-4f323816d776","name":"tool_call_id","value":"={{ $('Argumentos da Tools').item.json.id }}","type":"string"},{"id":"3c185636-3fe8-4d4b-8a6b-e3bf5613c503","name":"output","value":"={{ $json['link de pagamento'] }}","type":"string"}]},"options":{}},"id":"fd927bf6-e50e-482c-ab40-df4bf499c09d","name":"Resposta da Tool postPedidos","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3680,1648]},{"parameters":{"assignments":{"assignments":[{"id":"f45a1483-7a89-4da8-a09a-8b878e83a3aa","name":"usuario","value":"=(nome: {{ $json.nome }}, cpf: {{ $json.cpf }})","type":"string"}]},"options":{}},"id":"d87960bd-0863-42ca-803e-1f1e6ffcc3f8","name":"Construindo String3","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2976,272]},{"parameters":{"url":"=https://api.openai.com/v1/threads/{{ $('[OpenAI] Buscar Status da Run').item.json.thread_id }}/messages","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"OpenAI-Beta","value":"assistants=v2"}]},"options":{}},"id":"522967a7-2edd-4933-8088-b6c268f50a3c","name":"[OpenAI] Listar Mensagens Thread","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1296,2800]},{"parameters":{},"id":"83c1a614-aa22-4134-85d0-dc2e3ff1635e","name":"Merge1","type":"n8n-nodes-base.merge","typeVersion":3,"position":[3200,2240]},{"parameters":{"assignments":{"assignments":[{"id":"37f77e44-5888-4c61-8f15-3ec8bc33be9d","name":"tool_call_id","value":"={{ $('Argumentos da Tools').item.json.id }}","type":"string"},{"id":"3e00f6bb-e04e-491a-938b-b76e9f5a8b87","name":"output","value":"={{ $json.usuario }}","type":"string"}]},"options":{}},"id":"941a80e9-388e-4f06-bef5-af4fb894bc88","name":"Resposta da Tool updateUser","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2976,464]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"4c77a671-79cf-4d96-9683-9597c4c2bb46","leftValue":"={{ $json.name }}","rightValue":"postPedido","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"postPedido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"38e7c7a5-0727-4f80-960c-7f6895b53383","leftValue":"={{ $json.name }}","rightValue":"getUser","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"getUser"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.name }}","rightValue":"getCursos","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"getCursos"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"0f528545-9509-49ba-b660-3ff61c150129","leftValue":"={{ $json.name }}","rightValue":"updateUser","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"updateUser"}]},"options":{}},"id":"12a6b1a3-4ea3-43c4-b129-7551d55acd6c","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[2256,2400]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $('Argumentos da Tools').item.json.arguments.nome }}","rightValue":"=","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"nome existe"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"78f68ee4-ef94-4366-930b-a254fddaa7d6","leftValue":"={{ $('Argumentos da Tools').item.json.arguments.categoria }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"categoria existe"}]},"options":{"allMatchingOutputs":true}},"id":"427f621e-ba5d-4b0b-a7cb-1fe1e2d4f4c6","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[2768,2272]},{"parameters":{"httpMethod":"POST","path":"6798dba6-fdde-4111-afea-5666baf77e8d","options":{}},"id":"773c3efa-0d8f-461c-a99e-09a47f42ffea","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1936,2800],"webhookId":"6798dba6-fdde-4111-afea-5666baf77e8d"},{"parameters":{"content":"## Formatos Base64\nBase64 é uma forma de codificar dados binários como texto. Dependendo do tipo de arquivo, os prefixos variam para indicar o formato do dado. Aqui estão alguns dos formatos mais comuns com os respectivos prefixos base64:\n\n### 1. **Imagem**\n   - **PNG**: `data:image/png;base64,`\n   - **JPEG**: `data:image/jpeg;base64,`\n   - **GIF**: `data:image/gif;base64,`\n   - **SVG**: `data:image/svg+xml;base64,`\n   - **BMP**: `data:image/bmp;base64,`\n   \n### 2. **Áudio**\n   - **MP3**: `data:audio/mp3;base64,`\n   - **WAV**: `data:audio/wav;base64,`\n   - **OGG**: `data:audio/ogg;base64,`\n   - **MPEG**: `data:audio/mpeg;base64,`\n\n### 3. **Vídeo**\n   - **MP4**: `data:video/mp4;base64,`\n   - **OGG**: `data:video/ogg;base64,`\n   - **WebM**: `data:video/webm;base64,`\n\n### 4. **Texto**\n   - **Plain Text**: `data:text/plain;base64,`\n   - **HTML**: `data:text/html;base64,`\n   - **CSS**: `data:text/css;base64,`\n   - **JavaScript**: `data:text/javascript;base64,`\n   - **CSV**: `data:text/csv;base64,`\n\n### 5. **Documentos**\n   - **PDF**: `data:application/pdf;base64,`\n   - **JSON**: `data:application/json;base64,`\n   - **ZIP**: `data:application/zip;base64,`\n   - **XML**: `data:application/xml;base64,`\n\nEsses são exemplos de prefixos que podem ser usados ao incluir dados base64 em documentos ou aplicações.","height":1166,"width":593,"color":7},"id":"13fbc61b-06ef-4990-b698-9152b87286c6","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3008,8128]},{"parameters":{"content":"## MimeTypes\nO Mime type é o mecanismo para especificar o tipo de documento.\nA estrutura de um MIME type é muito simples; Consiste de um tipo e um subtipo, separados por um '/', onde nenhum espaço é permitido. \nO tipo representa a categoria. \nO subtipo é específico para cada tipo.\n\n### 1. **image**\nRepresenta qualquer tipo de imagens\n- image/gif\n- image/png\n- image/jpeg\n- image/bmp\n- image/webp\n   \n\n### 2. **audio**\nRepresenta qualquer tipo de arquivo de audio\n- audio/midi\n- audio/mpeg\n- audio/webm\n- audio/ogg\n- audio/wav\n- audio/mp3\n- audio/mp4\n\n### 3. **video**\nRepresenta qualquer tipo de arquivo de video\n- video/webm\n- video/ogg\n- video/mp4\n\n### 4. **text**\nRepresenta qualquer documento que contenha texto\n- text/plain\n- text/csv\n- text/html\n- text/css\n- text/javascript\n\n### 5. **application**\nRepresenta qualquer tipo de dados binários.\n- application/octet-stream\n- application/pkcs12\n- application/vnd.mspowerpoint\n- application/xhtml+xml\n- application/xml\n- application/pdf3","height":1166,"width":593,"color":7},"id":"f264d1da-ce83-4369-af8e-5005542a3dc7","name":"Sticky Note16","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2112,8432]},{"parameters":{"content":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/?utm_source=template-n8n","height":126,"width":593,"color":7},"id":"f1394fe3-640b-48cd-b16b-6d1059136630","name":"Sticky Note23","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[7104,9248]},{"parameters":{"content":"","height":3740,"width":12636,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-5072,-3184],"id":"e8f157a9-1972-43f0-a7e1-28438e9e2463","name":"Sticky Note14"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[12368,5712],"id":"53f687e1-bc16-4e46-9847-f2d5b63dcdc6","name":"No Operation, do nothing12","disabled":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"messages-api","instanceName":"=delivery","remoteJid":"= {{$('Dados Lead').first().json.IdConversa}}\n","messageText":"= {{ JSON.stringify($('Code3').first().json.mensagem).replace(/\\\\n/g, '\\n')  }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[11872,5712],"id":"2bcd26f3-6023-49a6-b7da-9c4b30bc06aa","name":"MenuCardapio12"},{"parameters":{"resource":"messages-api","instanceName":"=delivery","remoteJid":"= {{$('Dados Lead').first().json.IdConversa}}","messageText":"=*5-* Consulte seu pedido \n*4-* Concluir \n*6-* Cancelar \n*7-* Detalhar Itens.\n*ou menu*.","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[12096,5712],"id":"3ab36206-6973-4f99-b8c7-c633522a3418","name":"MenuCardapio13"},{"parameters":{"content":"## Envio das Respostas ao Usuário\nEnvio das mensagens quebradas para o usuário","height":760,"width":900,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[7440,3648],"id":"f64a7790-8078-4b38-a4c2-34972010d52b","name":"Sticky Note13"},{"parameters":{"content":"## Humanizar Resposta\nQuebra de mensagens em mensagens menores e com contexto.","height":616,"width":580,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[6464,3552],"id":"eea05204-03dc-49c6-9ba1-d9ea45d0167e","name":"Sticky Note12"},{"parameters":{"content":"## Agente de IA\nAgente inteligente com memória e prompt pré formatado","height":720,"width":1380,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[7440,7072],"id":"85c86b07-450a-4ce4-abbb-7812f11c827b","name":"Sticky Note34"}],"connections":{"Simplificação de Dados":{"main":[[{"node":"Buscar Cliente","type":"main","index":0}]]},"Filtro Inicial":{"main":[[{"node":"Simplificação de Dados","type":"main","index":0}]]},"Buscar Cliente":{"main":[[{"node":"Cliente Existe?","type":"main","index":0}]]},"Cliente Existe?":{"main":[[{"node":"Merge","type":"main","index":0}],[{"node":"[OpenAI] Criar Thread","type":"main","index":0}]]},"Criar Cliente":{"main":[[{"node":"Merge","type":"main","index":1}]]},"(Z-API) Enviar Mensagem":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Merge":{"main":[[{"node":"[OpenAI] Adicionar Mensagem na Thread","type":"main","index":0}]]},"[OpenAI] Criar Thread":{"main":[[{"node":"Criar Cliente","type":"main","index":0}]]},"[OpenAI] Criar Run":{"main":[[{"node":"Espera 3 seg","type":"main","index":0}]]},"Espera 3 seg":{"main":[[{"node":"[OpenAI] Buscar Status da Run","type":"main","index":0}]]},"[OpenAI] Listar Runs":{"main":[[{"node":"[OpenAI] Cancelar Run","type":"main","index":0}]]},"[OpenAI] Adicionar Mensagem na Thread":{"main":[[{"node":"[OpenAI] Criar Run","type":"main","index":0}],[{"node":"[OpenAI] Listar Runs","type":"main","index":0}]]},"[OpenAI] Cancelar Run":{"main":[[{"node":"[OpenAI] Adicionar Mensagem na Thread","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Dados individuais das tools","type":"main","index":0}]]},"Dados individuais das tools":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Argumentos da Tools":{"main":[[{"node":"Switch","type":"main","index":0}]]},"[OpenAI] Buscar Status da Run":{"main":[[{"node":"Qual o status da Run?","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Edit Fields5","type":"main","index":0}]]},"Edit Fields5":{"main":[[{"node":"Responder a Function Calling","type":"main","index":0}]]},"Criar Cliente1":{"main":[[{"node":"Criar Link Checkout","type":"main","index":0}]]},"Criar Link Checkout":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Buscar usuário":{"main":[[{"node":"Construindo String1","type":"main","index":0}]]},"Buscar Produto":{"main":[[{"node":"Criar Cliente1","type":"main","index":0}]]},"Criar Pedido":{"main":[[{"node":"Construindo String2","type":"main","index":0}]]},"Parâmentros das Tools":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Supabase":{"main":[[{"node":"Criar Pedido","type":"main","index":0}]]},"Qual o status da Run?":{"main":[[{"node":"Parâmentros das Tools","type":"main","index":0}],[{"node":"[OpenAI] Listar Mensagens Thread","type":"main","index":0}],[{"node":"Espera 3 seg","type":"main","index":0}],[{"node":"Stop and Error","type":"main","index":0}]]},"Buscar protudos pela categoria":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Buscar Produtos pelo Nome":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Concatenando String":{"main":[[{"node":"Resposta da Tool getCursos","type":"main","index":0}]]},"Resposta da Tool getCursos":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Construindo String":{"main":[[{"node":"Concatenando String","type":"main","index":0}]]},"Atualizar Usuário":{"main":[[{"node":"Construindo String3","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Aggregate","type":"main","index":0}],[{"node":"Argumentos da Tools","type":"main","index":0}]]},"Construindo String1":{"main":[[{"node":"Resposta da Tool getUsers","type":"main","index":0}]]},"Resposta da Tool getUsers":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Responder a Function Calling":{"main":[[{"node":"Espera 3 seg","type":"main","index":0}]]},"Construindo String2":{"main":[[{"node":"Resposta da Tool postPedidos","type":"main","index":0}]]},"Resposta da Tool postPedidos":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Construindo String3":{"main":[[{"node":"Resposta da Tool updateUser","type":"main","index":0}]]},"[OpenAI] Listar Mensagens Thread":{"main":[[{"node":"(Z-API) Enviar Mensagem","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Construindo String","type":"main","index":0}]]},"Resposta da Tool updateUser":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Buscar Produto","type":"main","index":0}],[{"node":"Buscar usuário","type":"main","index":0}],[{"node":"Switch1","type":"main","index":0}],[{"node":"Atualizar Usuário","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Buscar Produtos pelo Nome","type":"main","index":0}],[{"node":"Buscar protudos pela categoria","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Filtro Inicial","type":"main","index":0}]]},"MenuCardapio12":{"main":[[{"node":"MenuCardapio13","type":"main","index":0}]]},"MenuCardapio13":{"main":[[{"node":"No Operation, do nothing12","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6947c612-6859-46be-b20a-7450bc1bd790","triggerCount":0,"shared":[{"createdAt":"2025-09-18T19:42:42.998Z","updatedAt":"2025-09-18T19:42:42.998Z","role":"workflow:owner","workflowId":"65eBEYLdAdDMTJ96","projectId":"wFRMrac2003Pl1x6"}],"tags":[{"createdAt":"2025-09-07T00:48:06.709Z","updatedAt":"2025-09-07T00:48:06.709Z","id":"oyXqUAJNw26h8Z5c","name":"github"},{"createdAt":"2025-09-08T21:48:39.874Z","updatedAt":"2025-09-08T21:48:39.874Z","id":"ffKYKgI8Ro1kMAIk","name":"NoCode StartUp"},{"createdAt":"2025-09-17T12:33:06.936Z","updatedAt":"2025-09-17T12:33:06.936Z","id":"JeuuFBr3ONlGRlp1","name":"Formação Assistants"},{"createdAt":"2025-09-17T12:33:06.943Z","updatedAt":"2025-09-17T12:33:06.943Z","id":"oyNaKLDpb8MjOTKe","name":"Modelo"}]}