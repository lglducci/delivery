 CREATE OR REPLACE FUNCTION GravaTamanho(
  p_user_id     integer,
  p_id_empresa  integer,
  p_tamanho     text
)
RETURNS jsonb
LANGUAGE plpgsql
AS $$
BEGIN
  UPDATE turno_opcoes
     SET tamanho = p_tamanho,
         etapa   = 'ready',  -- ðŸ”¹ jÃ¡ sinaliza etapa final
         updated_at = now()
   WHERE user_id    = p_user_id
     AND id_empresa = p_id_empresa
     AND escolhido  = true;

  -- ðŸ”¹ Sensibiliza a IA: devolve aÃ§Ã£o explÃ­cita
  RETURN jsonb_build_object(
    'acao','GravaIntencao',
    'mensagem','Perfeito! Gravando sua escolha...'
  );
END;
$$;