{"createdAt":"2025-10-09T11:07:29.514Z","updatedAt":"2025-10-09T17:46:27.256Z","id":"WjCuSvqqT9kIviia","name":"camada de teste","active":false,"isArchived":false,"nodes":[{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"messages":{"values":[{"content":"= \n {{ $json.texto }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[720,-96],"id":"a1f417b0-5216-4e42-a469-eb65a0239a6a","name":"ChamaConversational1","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"workflowId":{"__rl":true,"value":"gL1FbKkYm9zGfCAA","mode":"list","cachedResultName":"Kernel Pizza"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_id":"= {{ $json.user_id }}","pedido_id":"={{ $json.pedido_id }} ","rotina":1,"telefone":"5516992975836","id_empresa":"={{ $json.id_empresa }}","mensagem":"={{ $json.texto }}"},"matchingColumns":[],"schema":[{"id":"mensagem","displayName":"mensagem","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"pedido_id","displayName":"pedido_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"rotina","displayName":"rotina","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false},{"id":"id_empresa","displayName":"id_empresa","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[784,256],"id":"3e49814f-530b-4fb4-88b8-3cf7ae712bdb","name":"IntencaoCompra"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[192,-272],"id":"dcdb3e4e-186a-444a-8371-26d60d96762c","name":"Split Out"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[240,-80],"id":"7cbf2c9b-5ada-4a1f-8ede-3868cd773fd6","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me","typeVersion":1,"position":[448,-272],"id":"659aa87e-ddb6-40df-b993-f7e0c6d56bff"},{"parameters":{"operation":"executeQuery","query":" -- üçï Bloco: Pizza Fracionada + Borda\nSELECT\n  c1.id_empresa,\n  (\n    '1 pizza 1/2 ' ||\n    c1.numero || ' e 1/2 ' ||\n    c2.numero || ' com borda ' ||\n    b.numero || ' ' ||\n    (ARRAY['grande','media','pequena'])[(1 + floor(random() * 3))::int]\n  ) AS texto,\n  78 AS user_id,\n  {{ $('Edit Fields').item.json.pedido_id }}  AS pedido_id\nFROM cardapio c1\nJOIN cardapio c2\n  ON c2.id_empresa = c1.id_empresa\n AND c2.categoria = c1.categoria\n AND c2.tipo = c1.tipo\n AND c2.numero <> c1.numero\nJOIN cardapio b\n  ON b.id_empresa = c1.id_empresa\n AND b.categoria = 'borda'\nWHERE c1.categoria = 'pizza'\n  AND c1.id_empresa = 2\n  AND lower(c1.tipo) = 'salgado'\nORDER BY random()\nLIMIT 3;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-112,-384],"id":"52ee1963-309b-4075-951b-a59f3eecf428","name":"FracionadaBorda","executeOnce":true,"credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" SELECT\n  id_empresa,\n  (\n    (1 + floor(random() * 3))::int || ' pizza ' ||\n    numero || ' ' ||\n    (ARRAY['grande','media','pequena'])[(1 + floor(random() * 3))::int]\n  ) AS texto,\n  78 AS user_id,\n    {{ $('Edit Fields').item.json.pedido_id }}  AS pedido_id\nFROM cardapio\nWHERE categoria = 'pizza'\n  AND id_empresa = 2\nORDER BY random()\nLIMIT 3 ;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-176,-208],"id":"50ba3ac6-80e0-435d-9488-4e6258a8a1c9","name":"Fracionada","executeOnce":true,"credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" -- üçï Bloco: Pizza Fracionada\nSELECT\n  c1.id_empresa,\n  (\n    '1 pizza 1/2 ' ||\n    c1.numero || ' e 1/2 ' ||\n    c2.numero || ' ' ||\n    (ARRAY['grande','media','pequena'])[(1 + floor(random() * 3))::int]\n  ) AS texto,\n  78 AS user_id,\n     {{ $('Edit Fields').item.json.pedido_id }}  AS pedido_id\nFROM cardapio c1\nJOIN cardapio c2\n  ON c2.id_empresa = c1.id_empresa\n AND c2.categoria = c1.categoria\n AND c2.tipo = c1.tipo\n AND c2.numero <> c1.numero\nWHERE c1.categoria = 'pizza'\n  AND c1.id_empresa = 2\n  AND lower(c1.tipo) = 'salgado'\nORDER BY random()\nLIMIT 2;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-112,304],"id":"544fc2b0-b22d-4fd7-915a-4e654203b89e","name":"Simples","executeOnce":true,"credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"-- üçï Bloco: Pizza Simples + Borda\nSELECT\n  c.id_empresa,\n  (\n    '1 pizza ' ||\n    c.numero || ' com borda ' ||\n    b.numero || ' ' ||\n    (ARRAY['grande','media','pequena'])[(1 + floor(random() * 3))::int]\n  ) AS texto,\n  78 AS user_id,\n   {{ $('Edit Fields').item.json.pedido_id }} AS pedido_id\nFROM cardapio c\nJOIN cardapio b\n  ON b.id_empresa = c.id_empresa\n AND b.categoria = 'borda'\nWHERE c.categoria = 'pizza'\n  AND c.id_empresa = 2\n  AND lower(c.tipo) = 'salgado'\nORDER BY random()\nLIMIT 2;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-112,96],"id":"0492a9e4-7a4a-4e4d-8b37-42183b6b13a9","name":"Simples com borda","executeOnce":true,"credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"  -- üçï Bloco: Pizza Simples + Bebida\nSELECT\n  c.id_empresa,\n  (\n    ((1 + floor(random() * 3))::int) || ' pizza ' ||\n    c.numero || ' com bebida ' ||\n    b.numero || ' ' ||\n    (ARRAY['grande','media','pequena'])[(1 + floor(random() * 3))::int]\n  ) AS texto,\n  78 AS user_id,\n    {{ $('Edit Fields').item.json.pedido_id }}  AS pedido_id\nFROM cardapio c\nJOIN cardapio b\n  ON b.id_empresa = c.id_empresa\n AND b.categoria = 'bebida'\nWHERE c.categoria = 'pizza'\n  AND c.id_empresa = 2\n  AND lower(c.tipo) = 'salgado'\nORDER BY random()\nLIMIT 3;\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-112,-64],"id":"0733ce45-dbc7-4f80-8dda-49e7abe8cf1b","name":"Simples com bebida","executeOnce":true,"credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.chatInput }}","rightValue":"1","operator":{"type":"string","operation":"equals"},"id":"d31ba45c-49c9-4a49-bc39-0f65ab211d36"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"56ae76fa-e893-4e6a-b7bc-737b2eb87409","leftValue":"={{ $json.chatInput }}","rightValue":"2","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"94262ae7-94ab-41bf-a301-31ca9e931897","leftValue":"={{ $json.chatInput }}","rightValue":"3","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f485eb11-7469-48b3-bf9c-3894acc98014","leftValue":"={{ $json.chatInput }}","rightValue":"4","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"37980146-1bd4-46b5-96c5-9d43f63b7821","leftValue":"={{ $json.chatInput }}","rightValue":"5","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-512,-80],"id":"47618219-20ec-46ab-9ed3-6f2770fd94c0","name":"Switch"},{"parameters":{"assignments":{"assignments":[{"id":"4282664b-b3f3-4132-af17-24687714bccc","name":"pedido_id","value":"53","type":"string"},{"id":"170b2f5f-d8e6-4e56-8bf0-7b842708e235","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-752,-48],"id":"c5769857-544a-411f-8028-375aec3ca75e","name":"Edit Fields"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-1072,-80],"id":"b53ab3cb-90c5-462b-b4ca-2ee3233516c4","name":"When chat message received","webhookId":"03ad1470-fe4b-4251-adb1-e06d5bba1343"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[512,-80],"id":"ec315f3b-500e-4ea3-a56e-598a5fe337c6","name":"Wait","webhookId":"a50179c7-93c0-42fb-94ac-a6286bbebac4","executeOnce":true}],"connections":{"IntencaoCompra":{"ai_tool":[[{"node":"ChamaConversational1","type":"ai_tool","index":0}]]},"Split Out":{"main":[[]]},"Loop Over Items":{"main":[[{"node":"Replace Me","type":"main","index":0}],[{"node":"Wait","type":"main","index":0}]]},"Replace Me":{"main":[[]]},"ChamaConversational1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"FracionadaBorda":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Fracionada":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Simples com borda":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Simples com bebida":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Simples":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Switch","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Switch":{"main":[[{"node":"FracionadaBorda","type":"main","index":0}],[{"node":"Fracionada","type":"main","index":0}],[{"node":"Simples com bebida","type":"main","index":0}],[{"node":"Simples com borda","type":"main","index":0}],[{"node":"Simples","type":"main","index":0}]]},"Wait":{"main":[[{"node":"ChamaConversational1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"dbd7168d-6f80-4379-84c1-af1aeb393e58","triggerCount":0,"shared":[{"createdAt":"2025-10-09T11:07:29.514Z","updatedAt":"2025-10-09T11:07:29.514Z","role":"workflow:owner","workflowId":"WjCuSvqqT9kIviia","projectId":"wFRMrac2003Pl1x6"}],"tags":[]}