{"createdAt":"2025-11-14T15:10:20.122Z","updatedAt":"2025-11-15T01:57:48.196Z","id":"vMBkizD5VMy1WoZT","name":"FInanceflow","active":false,"isArchived":false,"nodes":[{"parameters":{"content":"## Formatos Base64\nBase64 √© uma forma de codificar dados bin√°rios como texto. Dependendo do tipo de arquivo, os prefixos variam para indicar o formato do dado. Aqui est√£o alguns dos formatos mais comuns com os respectivos prefixos base64:\n\n### 1. **Imagem**\n   - **PNG**: `data:image/png;base64,`\n   - **JPEG**: `data:image/jpeg;base64,`\n   - **GIF**: `data:image/gif;base64,`\n   - **SVG**: `data:image/svg+xml;base64,`\n   - **BMP**: `data:image/bmp;base64,`\n   \n### 2. **√Åudio**\n   - **MP3**: `data:audio/mp3;base64,`\n   - **WAV**: `data:audio/wav;base64,`\n   - **OGG**: `data:audio/ogg;base64,`\n   - **MPEG**: `data:audio/mpeg;base64,`\n\n### 3. **V√≠deo**\n   - **MP4**: `data:video/mp4;base64,`\n   - **OGG**: `data:video/ogg;base64,`\n   - **WebM**: `data:video/webm;base64,`\n\n### 4. **Texto**\n   - **Plain Text**: `data:text/plain;base64,`\n   - **HTML**: `data:text/html;base64,`\n   - **CSS**: `data:text/css;base64,`\n   - **JavaScript**: `data:text/javascript;base64,`\n   - **CSV**: `data:text/csv;base64,`\n\n### 5. **Documentos**\n   - **PDF**: `data:application/pdf;base64,`\n   - **JSON**: `data:application/json;base64,`\n   - **ZIP**: `data:application/zip;base64,`\n   - **XML**: `data:application/xml;base64,`\n\nEsses s√£o exemplos de prefixos que podem ser usados ao incluir dados base64 em documentos ou aplica√ß√µes.","height":1166,"width":593,"color":7},"id":"5c60c760-7f13-43b7-b6ae-d65602d686b5","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3744,384]},{"parameters":{"content":"## MimeTypes\nO Mime type √© o mecanismo para especificar o tipo de documento.\nA estrutura de um MIME type √© muito simples; Consiste de um tipo e um subtipo, separados por um '/', onde nenhum espa√ßo √© permitido. \nO tipo representa a categoria. \nO subtipo √© espec√≠fico para cada tipo.\n\n### 1. **image**\nRepresenta qualquer tipo de imagens\n- image/gif\n- image/png\n- image/jpeg\n- image/bmp\n- image/webp\n   \n\n### 2. **audio**\nRepresenta qualquer tipo de arquivo de audio\n- audio/midi\n- audio/mpeg\n- audio/webm\n- audio/ogg\n- audio/wav\n- audio/mp3\n- audio/mp4\n\n### 3. **video**\nRepresenta qualquer tipo de arquivo de video\n- video/webm\n- video/ogg\n- video/mp4\n\n### 4. **text**\nRepresenta qualquer documento que contenha texto\n- text/plain\n- text/csv\n- text/html\n- text/css\n- text/javascript\n\n### 5. **application**\nRepresenta qualquer tipo de dados bin√°rios.\n- application/octet-stream\n- application/pkcs12\n- application/vnd.mspowerpoint\n- application/xhtml+xml\n- application/xml\n- application/pdf3","height":1166,"width":593,"color":7},"id":"225a30f2-3569-449a-89fc-d60c38997191","name":"Sticky Note16","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3056,416]},{"parameters":{"operation":"get","tableId":"usuarios","filters":{"conditions":[{"keyName":"telefone","keyValue":"={{ $('Dados Lead').item.json.IdConversa.trim() }}"}]}},"id":"6a42033f-7624-4624-8cb1-7628a0a670b4","name":"Encontrar Cliente1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[7360,-16],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"XG8fSQrjyd9kzaOx","name":"FinanceFlow"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.user_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"9dc3a6eb-0b64-4e02-8965-f0d1b2e11140","name":"Cliente Existe?1","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[7408,-544],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"tableId":"usuario","fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $('Dados Lead').item.json.LeadNome }}"},{"fieldId":"telefone","fieldValue":"={{ $('Dados Lead').item.json.IdConversa.trim() }}"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"5b9d517e-12d5-4fcf-958b-f781fc055529","name":"Criar Cliente1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[7552,-288],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"id":"4ec103ef-42e6-435a-a73c-d6cd7c02ec39","name":"Merge1","type":"n8n-nodes-base.merge","typeVersion":3,"position":[7968,-544],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"## Gatilho\nChat Trigger, WhatsApp, Instagram, Telegram, Messenger, etc..","height":572,"width":340,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[848,2288],"id":"15ec284b-c470-4788-8c67-7360939d4580","name":"Sticky Note2"},{"parameters":{"content":"## Vari√°veis do Fluxo\nCentral de controle do workflow","height":540,"width":326,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1280,2304],"id":"5ae27d06-f8c1-4b2a-a88c-c8388cf52529","name":"Sticky Note3"},{"parameters":{"content":"## Filtros Iniciais\nPara evitar que fluxo seja executado quando n√£o queremos","height":572,"width":340,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1648,2288],"id":"1b09cd15-d7e7-42fb-9abf-78bd43a47aa8","name":"Sticky Note4"},{"parameters":{"content":"## Registro do Lead no banco de dados (Supabase)\nFluxo para adi√ß√£o do lead no banco de dados postgrees supabase.","height":684,"width":2536,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[6048,2304],"id":"7bc30d4e-5642-42c5-a45f-0db771b7ae13","name":"Sticky Note7"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usu√°rio para o agente","height":684,"width":836,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[5152,2304],"id":"f98e0cdd-fa6e-482f-a12d-3d1df77468e6","name":"Sticky Note10"},{"parameters":{"assignments":{"assignments":[{"id":"9f488c5c-0b3b-48e9-87b1-5a22d513d1ec","name":"IdConversa","value":"={{ $('Webhook').item.json.body.data.key.remoteJid.replace(\"@s.whatsapp.net\",\"\") }}","type":"string"},{"id":"69f6217f-9063-423f-abf4-e94f6b70f94e","name":"LeadNome","value":"= {{ $('Webhook').item.json.body.data.pushName }}","type":"string"},{"id":"6ba1d721-f125-47fb-ad7b-194cc478a856","name":"input_usuario","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"ba4188f4-3672-477b-a776-7eadc863140c","name":"mensagem_usuario","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"},{"id":"33d4eb69-2991-4188-8b18-2ac04b7b2f74","name":"telefoneEmpresa","value":"={{ $('Webhook').item.json.body.sender.replace(\"@s.whatsapp.net\",\"\") }}","type":"string"},{"id":"8231bcd2-8b3a-460a-b0ea-2b933a6b9804","name":"instance","value":"={{ $('Webhook').item.json.body.instance }}","type":"string"},{"id":"198cfcfe-5eea-41f8-80a8-09aaeef5e6e5","name":"apikey","value":"={{ $('Webhook').item.json.body.apikey }}","type":"string"}]},"options":{}},"id":"532faa70-6c5a-4394-9ce1-c94e229e00d5","name":"Dados Lead","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2176,2528],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"Ajustes os filtros necess√°rios conforme seu gatilho de entrada","height":280,"width":190,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1712,2448],"id":"06bd14f6-9172-4354-86fc-77273a98da0d","name":"Sticky Note1"},{"parameters":{"content":"Ajuste tempos de buffer e inatividade do agente conforme necessidade.\n","height":280,"width":190,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1360,2432],"id":"21c0033a-2c0c-48bc-858d-9b070ec4fc39","name":"Sticky Note18"},{"parameters":{"assignments":{"assignments":[{"id":"3bdce7b6-d0f1-442c-aafd-8cd123aa21b6","name":"EsperaBuffer","value":1,"type":"number"},{"id":"c38e8985-4494-40a4-878e-f25467849842","name":"TempoInatividadeAgente","value":150,"type":"number"},{"id":"ac619a5e-1438-4e19-aaf5-21dfcbc32312","name":"ModeloTemperatura","value":0.4,"type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1392,2528],"id":"ef16d598-97bd-4714-b1dc-69191a999101","name":"Parametros Fluxo","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/?utm_source=template-n8n","height":126,"width":593,"color":7},"id":"cb7fbb5c-101f-4e11-9bfe-ea12ee5d25c2","name":"Sticky Note23","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3744,1568]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"00d2650d-52f9-4bf5-9b50-ec548c105222","leftValue":"={{ $json.lead_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[7744,-544],"id":"918e1792-1ff9-4e77-981b-5ffc00a71225","name":"Concatena"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"204f54b0-e3ed-4ff4-8302-8c20d3b8aa78","leftValue":"={{ $('Webhook').item.json.body.isGroup }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"c51986d9-f347-4198-89bb-9e4cd0f021c9","leftValue":"={{ $('Webhook').item.json.body.broadcast }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05ee6414-0164-473b-8f82-225cfba55ad2","leftValue":"={{ $('Webhook').item.json.body.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"id":"87968512-ec9b-42b5-b84a-9b3897efed83","name":"Filtro Inicial1","type":"n8n-nodes-base.filter","typeVersion":2.1,"position":[1760,2528],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[8096,2752],"id":"3343ba56-1cb2-4951-8615-463eb09a55ed","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"jsCode":"  return [\n  {\n        acao: $('Code4').first().json.acao// ou o campo correto de sa√≠da\n  }\n];\n\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[9488,1024],"id":"a03d98e0-99fa-4a39-8500-128aafdcd3c2","name":"MsgUsuario"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"03a78ab2-9057-4ff5-baa5-8c37c432a94d","leftValue":"={{$json.acao }}","rightValue":"cancelar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cancelar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e1b9d060-7def-4f5f-b587-657ed9c9ce85","leftValue":"={{ $json.acao }}","rightValue":"finalizar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Finalizar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e3fc41f2-ee99-4de2-8841-2ae1a7da37db","leftValue":"={{$json.acao }}","rightValue":"adicionar_item","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Adicionar Item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"38045ee6-0b44-4b52-a79c-676c7ce5998a","leftValue":"={{ $json.acao }}","rightValue":"carrinho","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"carrinho"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"23e65839-03f6-4879-8998-48ad2909ef94","leftValue":"={{ $json.acao }}","rightValue":"cardapio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Cardapio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"996ac831-1b2b-4f3b-8efa-a53642a5d337","leftValue":"={{ $json.acao }}","rightValue":"desconhecida","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"desconhecido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5ba958dd-b3b7-4cfd-a85c-1d0e58a103e2","leftValue":"={{ $json.acao }}","rightValue":"excluir_item","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"excluir_item"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d6f6b9ca-5c58-498a-9fc9-b4ceefd4d5da","leftValue":"={{ $json.acao }}","rightValue":"adicionar_ingrediente","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"adicionar_ingrediente"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"311affc0-60d1-4aa8-be8e-b90915b480ac","leftValue":"={{ $json.acao }}","rightValue":"additem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"additem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f1ca97e7-a539-4697-8a42-64e55790c8c1","leftValue":"={{ $json.acao }}","rightValue":"escolha","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"escolha"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"29050ab3-3204-4836-b0f5-a670d23ed9e6","leftValue":"consultacategoria","rightValue":"consultacategoria","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[10288,2304],"id":"88935fa9-f7a1-4dd9-9f96-d3132c94508c","name":"Switch"},{"parameters":{"httpMethod":"POST","path":"financeflwo","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[1008,2528],"id":"ae52df8d-7ba3-4f92-bd1a-3a65b9144fa9","name":"Webhook","webhookId":"66949457-5339-4325-b499-9a15d57ff6a1"},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n {{ $json.mensagem }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"= ‚úÖ PROMPT DEFINITIVO ‚Äì INTERPRETADOR FINANCEIRO\n\nVoc√™ √© um interpretador financeiro.\nSua tarefa √© pegar QUALQUER frase do usu√°rio e converter para um JSON exatamente no formato abaixo, SEM alterar os nomes dos campos e SEM adicionar campos.\n\nRetorne somente o JSON puro, sem texto adicional.\nNunca envolva o JSON em listas ou arrays.\n\n\nHOJE={{ $json.HOJE }}\nONTEM={{ $json.ONTEM }}\nAMANHA={{ $json.AMANHA }}\n\n- Sempre substituir \"hoje\", \"ontem\", \"amanh√£\".\n- Nunca usar datas internas do modelo.\n\nSE a frase n√£o tiver data expl√≠cita (hoje, ontem, amanh√£, 12/05, 2025-01-02 etc):\n‚Üí preencha automaticamente \"data\": HOJE.\n\nüìå FORMATO OBRIGAT√ìRIO DO JSON DE SA√çDA\n{\n  \"acao\": null,\n  \"origem_texto\": \"\",\n  \"valor\": null,\n  \"tipo_lancamento\": null,\n  \"categoria\": null,\n  \"conta\": null,\n  \"descricao\": null,\n  \"data\": null,\n  \"periodo\": null,\n  \"vencimento\": null,\n  \"cliente_fornecedor\": null,\n  \"cartao\": null,\n  \"fatura_periodo\": null,\n  \"parcelas\": null,\n  \"valor_parcela\": null,\n  \"parcela_atual\": null,\n  \"filtro_conta\": null,\n  \"filtro_status\": null\n}\n\nüìå REGRAS IMPORTANTES\n1. Campo obrigat√≥rio\n\norigem_texto = frase original SEM ALTERA√á√ÉO.\n\n2. Campo \"acao\" ‚Äî DEVE ser um dos abaixo\n\nregistrar_despesa\n\nregistrar_receita\n\nconsultar_saldo\n\nconsultar_extrato\n\nconsultar_resumo\n\nconsultar_contas_pagar\n\nconsultar_contas_receber\n\nconsultar_fatura_cartao\n\najuda\n\ndesconhecida\n\nSe n√£o entender ‚Üí coloque \"acao\": \"desconhecida\"\n\n3. Como extrair\n\nvalor ‚Üí n√∫mero encontrado\n\ncategoria ‚Üí supermercado, mercado, gasolina, uber, ped√°gio, etc.\n\nconta ‚Üí Nubank, Santander, Ita√∫, Caixa, Carteira\n\ndescricao ‚Üí o restante que explica o motivo (\"compras\", \"almo√ßo\", \"farm√°cia\")\n\ntipo_lancamento:\n\n\"despesa\" para gastos\n\n\"receita\" para entradas\n\ndata:\n\n\"hoje\" ‚Üí YYYY-MM-DD\n\n\"ontem\" ‚Üí YYYY-MM-DD\n\n\"dia 5\", \"05/10\", etc ‚Üí formato YYYY-MM-DD\n\nse n√£o der pra interpretar ‚Üí null\n\nperiodo:\n\nessa_semana, esse_mes, mes_passado, tudo\n\nsen√£o ‚Üí null\n\n4. Regras de comportamento\n\nN√£o invente valores.\n\nN√£o invente datas.\n\nN√£o crie listas.\n\nN√£o retorne explica√ß√µes.\n\nN√£o altere o formato.\n\nSempre retorno um JSON √∫nico, direto.\n\n‚úÖ EXEMPLO REAL COM SUA FRASE\n\nEntrada:\n\ncomprei 460 reais de compras no mercado hoje no nubank\n\nSa√≠da esperada:\n\n{\n  \"acao\": \"registrar_despesa\",\n  \"origem_texto\": \"comprei 460 reais de compras no mercado hoje no nubank\",\n  \"valor\": 460,\n  \"tipo_lancamento\": \"despesa\",\n  \"categoria\": \"mercado\",\n  \"conta\": \"Nubank\",\n  \"descricao\": \"compras\",\n  \"data\": \"2025-11-14\",\n  \"periodo\": null,\n  \"vencimento\": null,\n  \"cliente_fornecedor\": null,\n  \"cartao\": null,\n  \"fatura_periodo\": null,\n  \"parcelas\": null,\n  \"valor_parcela\": null,\n  \"parcela_atual\": null,\n  \"filtro_conta\": null,\n  \"filtro_status\": null\n}"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[8208,2448],"id":"cc8bcea7-b619-4644-a601-e6408db02644","name":"Menu","retryOnFail":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"content":"","height":2460,"width":15852,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-416,1328],"id":"7435da91-7c3f-453b-8ad2-0ae55610068e","name":"Sticky Note14"},{"parameters":{"tableId":"pedido_temp","fieldsUi":{"fieldValues":[{"fieldId":"user_id","fieldValue":"={{ $('Merge1').item.json.user_id }}"},{"fieldId":"status","fieldValue":"enviado"},{"fieldId":"valor","fieldValue":"0"},{"fieldId":"id_empresa","fieldValue":"={{ $('DadosEmpresa').item.json.id_empresa }}"}]}},"id":"c582ebf4-6eba-4067-b80c-258b13a79080","name":"CriaPedido","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[8464,-384],"credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"3419c30f-4400-401b-bf40-db1579507f96","leftValue":"={{ $json.user_id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"c828cbff-f2c5-4f58-bef9-f427b6c55bc1","name":"Cliente Pedido","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[8320,-544],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"id":"6789e903-fc52-4830-bdcd-7b9284d27622","name":"MergePedido","type":"n8n-nodes-base.merge","typeVersion":3,"position":[8608,-544],"alwaysOutputData":false,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"a8106197-1d10-438c-a9e7-07c17a8adfd0","name":"acao","value":"={{$json.acao}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[10032,864],"id":"d5c691f1-f707-446f-844e-a32373a582f0","name":"Acao"},{"parameters":{"content":"Ajuste o Node Set com os campos relevantes fornecidos.\n","height":280,"width":706,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2064,2448],"id":"0efb8d81-21b4-4987-906f-c8dc55f99374","name":"Sticky Note"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"bc64f125-d93c-4d1d-97ae-65c0adb08b79","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"f7053057-3e82-49ad-a2bf-07bafc958f06","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"extendedTextMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"137aec3f-e95e-4d59-b9ba-1140f9fc4fb4","leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Webhook').item.json.body.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals"},"id":"40b284c8-fdf7-49e5-9ac3-8c5051f51521"}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"7babc8fd-200c-4cb8-bc63-f999f57d5217","leftValue":"={{ $('Webhook').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.mimetype }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"PDF"}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":"Outro"}},"id":"d97aae28-5a00-40b3-bb4f-1a9c47bb7458","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[3296,2512],"notesInFlow":true,"notes":"Ajustar condi√ß√µes para cada tipo de mensagem a depender da sua entrada de dados\n\nTEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{"language":"pt"}},"id":"d538a274-c51a-496d-afb0-80c4495f553e","name":"Transcrever √Åudio1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[4000,2496],"credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=#Instru√ß√µes\nO usu√°rio te enviou uma imagem a qual voc√™ deve descrever.\n\nA imagem pode vir acompanhada de uma mensagem de texto (<MensagemUsuario>)\n\nCaso venha, utilize a mensagem anexa como contexto extra, tente capturar o sentimento da mensagem e objetivo pelo qual o usu√°rio esteja enviando esta imagem na conversa.\n\nCrie uma resposta descrevendo as informa√ß√µes enviadas para que estas sejam utilizadas por um agente no futuro.\n\nLembre-se:\nEste agente apenas ter√° as informa√ß√µes que voc√™ fornecer, portanto repasse toda informa√ß√£o que julgar importante.\n\n#Dados\n<MensagemUsuario>\n{{ $json.MensagemImagem }}\n</MensagemUsuario>\n","inputType":"base64","options":{}},"id":"17f3caca-b7c5-4cf6-b171-7eeee4257444","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[4000,2656],"credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"amount":"={{ $('Parametros Fluxo').item.json.EsperaBuffer }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[4800,2560],"id":"6df908b1-4286-43e2-8d1e-d2559953b330","name":"Wait1","webhookId":"169ea291-c3dc-4bca-854f-05520c979d7d","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4592,2576],"id":"851a2d1c-6a9e-42c1-b004-79f004325c08","name":"Buffer ","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"messages","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4960,2560],"id":"7afbd52a-7a2d-493f-96f3-63962a52a90b","name":"Buffer 3","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.Texto }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4304,2176],"id":"c2db4baf-1f9d-4256-aa88-8e8f763810e0","name":"Add Texto Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"delete","key":"={{ $('Dados Lead').item.json.IdConversa }}_buffer"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[5264,2480],"id":"0c98bf6a-2b73-4a42-aa1d-8fd9a4688e34","name":"Apagar Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook').item.json.body.data.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,2176],"id":"2eda0b36-8b77-4af3-9445-7f978dc00813","name":"Mensagem Texto1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Audio","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,2496],"id":"2b74fa3c-5b22-4957-9429-ab325d128654","name":"Mensagem Audio1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Imagem","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"f5c70ab5-7671-4bc8-9d23-65b8954ddb08","name":"MensagemImagem","value":"={{ $('Webhook').item.json.body.data.message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,2656],"id":"8f2965bd-dfe4-40f8-84b5-eab643343149","name":"Mensagem Imagem1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4304,2496],"id":"253157f2-5d35-4e65-8613-f2bca7cb6884","name":"Add Audio Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"={{ $json.Erro }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4304,2992],"id":"0bfdf412-cd10-457d-a189-269b63d276b8","name":"Add Error Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[4000,2816],"id":"01c21617-c52f-4137-aae0-c9ba95a2ec14","name":"Extract from File","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"11dc126a-e72e-431b-8db5-c78168c69439","name":"Erro","value":"<ErroFormatoMensagem>","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,2992],"id":"9618440a-0ea1-4e07-bb1c-486f2d509cff","name":"Mensagem Erro1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"=<ContextoPDF>\n  <TranscricaoPDF>\n{{ $json.text }}\n  </TranscricaoPDF>\nContexto Extra: O usu√°rio encaminhou a mensagem a seguir junto ao PDF.\n  <MensagemUsuario>\n{{ $('Mensagem Documento PDF').item.json.MensagemDocumento }}\n  </MensagemUsuario>\n</ContextoPDF>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4304,2816],"id":"13e46483-355e-423d-a5a0-390642a4716f","name":"Add PDF Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"push","list":"={{ $('Dados Lead').item.json.IdConversa }}_buffer","messageData":"=<ContextoImagem>\n\n  <DetalheImagem>\n{{ $json.content }}\n  </DetalheImagem>\n\nContexto Extra: O usu√°rio encaminhou a mensagem a seguir junto √° imagem.\n  <MensagemUsuario>\n{{ $('Mensagem Imagem1').item.json.MensagemImagem }}\n  </MensagemUsuario>\n\n</ContextoImagem>","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[4304,2656],"id":"68e018b6-7864-4dfe-a035-775e17b19413","name":"Add Imagem Buffer1","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"get","propertyName":"AgenteStatus","key":"={{ $('Parametros Fluxo').item.json.IdAgente }}_status_{{ $('Dados Lead').item.json.IdConversa }}\n\n ","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2800,2528],"id":"37246935-a06c-46ec-a0ce-073d18795b0b","name":"Redis","credentials":{"redis":{"id":"AvuP6JWzf8sxsD3n","name":"Redis account"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[5504,2656],"id":"5d654f40-c402-4393-96a9-80c5324e1a71","name":"No Operation, do nothing6","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"756ab323-31a2-4a59-92e8-c2c695027962","leftValue":"={{ $json.AgenteStatus }}","rightValue":"Desativado","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3008,2528],"id":"255d61bd-c91e-4d6a-93b1-0c082bfd1b43","name":"Bot Desativado?1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[3168,2304],"id":"76a9abb2-1176-4b26-b9d6-b7b28ed8a2d5","name":"No Operation, do nothing"},{"parameters":{"assignments":{"assignments":[{"id":"5efc6961-1ff7-4ef2-a772-7e9761592a3e","name":"Documento","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"},{"id":"003323ec-ffbe-4c91-b8b5-623466b5014d","name":"MensagemDocumento","value":"={{ $('Webhook').item.json.body.data.message.documentWithCaptionMessage.message.documentMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,2816],"id":"b877a073-672a-40b9-9087-003091fc2ff2","name":"Mensagem Documento PDF","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"toBinary","sourceProperty":"Imagem","options":{"mimeType":"image/png"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3776,2656],"id":"0e08a343-8fc3-4237-beae-54ca86db535a","name":"Convert to File"},{"parameters":{"operation":"toBinary","sourceProperty":"Audio","options":{"mimeType":"audio/mp4"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3776,2496],"id":"a681f974-3d7f-49cb-a9be-358b9c71e1fa","name":"Convert to File1"},{"parameters":{"operation":"toBinary","sourceProperty":"Documento","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[3776,2816],"id":"dc3584e6-1908-4a24-bea8-0fa07008961b","name":"Convert to File2"},{"parameters":{"assignments":{"assignments":[{"id":"c1ce011b-bd95-468e-863e-f2076f644cf9","name":"Texto","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3520,2336],"id":"f22d3f79-e301-4518-882a-880fd5b883ab","name":"Mensagem Texto2","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"66a91f66-e755-4120-b22f-44c814f56162","name":"message","value":"={{ $json.messages[0] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[6192,2480],"id":"ff61946d-ce75-4515-ae82-0c3324640636","name":"MensagemTraduzida","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"01c2c18a-5148-4c7d-b5cd-72c66d6595a5","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"montagem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"bbee0d48-e616-41a6-a91c-e9d13fef7158","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"finalizar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"d2181f84-5c44-42e2-8d3f-3384a047160a","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"ingrediente","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"cc84bcf5-f495-4774-a1b4-b8a9a7510bf6","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"additem","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"029438df-3420-4884-a06c-b3904bcad8e5","leftValue":"={{$('MergePedido').item.json.status.trim()}}","rightValue":"sair","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[9232,928],"id":"25dcc002-cb43-46fc-a25b-f3a027ff85fc","name":"If7"},{"parameters":{"jsCode":"   return [\n  {\n    acao: $('MergePedido').first().json.status  // ou o campo correto de sa√≠da\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[9472,848],"id":"73c61bce-2af9-4eaf-ac4f-06dcf5903434","name":"MsgUsuario1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[9712,864],"id":"0f474cb4-7599-41eb-9814-10020e9d7116","name":"Merge2"},{"parameters":{"jsCode":" const input =  $input.first().json.comando_normalizado || $input.first().json.message || \"\";\nlet clean = input.toLowerCase().trim();\nlet tokens = clean.split(/\\s+/);\n\n// Mapa de palavras para n√∫meros (quando a 1¬™ palavra √© quantidade)\nconst mapaQtd = { \"uma\":\"1\", \"um\":\"1\", \"duas\":\"2\", \"dois\":\"2\", \"tr√™s\":\"3\", \"tres\":\"3\", \"quatro\":\"4\", \"cinco\":\"5\" };\nif (mapaQtd[tokens[0]]) {\n  tokens[0] = mapaQtd[tokens[0]];\n  clean = tokens.join(\" \");\n}\n\n// Normaliza plural b√°sico (caso o pr√©-LLM n√£o tenha feito)\nif (tokens[1] === \"pizzas\") {\n  tokens[1] = \"pizza\";\n  clean = tokens.join(\" \");\n}\n\n// Resposta padr√£o (com sugest√£o educada)\nlet resultado = {\n  original: input,\n  comando: clean,\n  valido: false,\n  tipo: null,\n  erro: \"n√£o entendi seu comando\",\n  sugestao: `O seu pedido ou comando n√£o foi identificado. Voc√™ quis dizer: ${clean} ?`\n};\n\n// --- Caso 1: Pizza inteira ---\n// \"1 pizza 14\", \"1 pizza mussarela grande\"\nif (\n  tokens.length >= 3 &&\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"pizza\" &&\n  !tokens.includes(\"1/2\")\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"pizza_inteira\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 2: Pizza fracionada ---\n// \"1 pizza 1/2 14 e 1/2 19\"  (aceita nomes no lugar de n√∫meros)\nelse if (\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"pizza\" &&\n  tokens.filter(t => t === \"1/2\").length === 2\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"pizza_fracionada\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 3: Esfirra ---\n// \"1 esfirra carne\"\nelse if (\n  tokens.length >= 3 &&\n  /^\\d+$/.test(tokens[0]) &&\n  tokens[1] === \"esfirra\"\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"esfirra\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 4: Bebida ---\n// \"1 coca cola 2l\", \"2 guarana 350ml\", \"1 √°gua 500ml\", \"1 heineken long neck\"\nelse if (\n  /^\\d+$/.test(tokens[0]) &&\n  /\\b(coca(?:\\s+cola)?|cola|guaran[√°a]|heineken|bud(?:weiser)?|cerveja|agua|√°gua|fanta|sprite)\\b/.test(clean)\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"bebida\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 5: Adicionar ingrediente ---\n// \"adicionar mussarela item 1\", \"adicionar ingrediente cheddar ao item 3\"\nelse if (\n  tokens[0] === \"adicionar\" &&\n  tokens.includes(\"item\")\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"adicionar_item\",\n    acao: \"adicionar_item\"\n  };\n}\n\n// --- Caso 6: Excluir item ---\n// \"excluir item 1\", \"excluir 2\"\nelse if (\n  tokens[0] === \"excluir\" &&\n  (\n    (tokens[1] === \"item\" && /^\\d+$/.test(tokens[2])) ||\n    (/^\\d+$/.test(tokens[1]))\n  )\n) {\n  resultado = {\n    original: input,\n    comando: clean,\n    valido: true,\n    tipo: \"excluir_item\",\n    acao: \"excluir_item\"\n  };\n}\n\nreturn resultado;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[7376,-48],"id":"6edef020-db06-4fa6-a02d-62b8c7cd0c26","name":"Validador"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usu√°rio para o agente","height":732,"width":1492,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[8704,2240],"id":"8b75bcc6-5874-4857-9ea9-d4a53dd954d6","name":"Sticky Note17"},{"parameters":{"content":"## Mensagem para o Agente\nMensagem final do usu√°rio para o agente","height":1084,"width":1988,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3024,2112],"id":"0f98f289-a937-4b04-8f9b-c72cf407cc96","name":"Sticky Note11"},{"parameters":{"content":"Ajuste tempos de buffer e inatividade do agente conforme necessidade.\n","height":968,"width":1822},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3104,2176],"id":"5c1a3673-3183-4280-8f3b-286727b6a2ab","name":"Sticky Note19"},{"parameters":{"assignments":{"assignments":[{"id":"ae27ddc3-121b-470f-a83c-a7b53f38c0da","name":"id_empresa","value":"={{ $json.id_empresa }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2288,2896],"id":"47fe8c4c-ac8a-4020-88b4-27d1b2e7b802","name":"DadosEmpresa"},{"parameters":{"jsCode":"\n// aceita {acao:\"...\"} ou text:'{\"acao\":\"...\"}'\nlet acao = $json.acao;\n\nif (!acao && typeof $json.text === 'string') {\n  try { acao = JSON.parse($json.text).acao; } catch {}\n}\nacao = String(acao || '').toLowerCase();\n\nconst precisa = new Set(['cardapio_online', 'adicionar_item']); // acrescente aqui se quiser\nreturn [{ json: { resolve: precisa.has(acao), acao } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[8640,928],"id":"4220f122-7e57-447b-920f-cdfa8b7a4c66","name":"Code4"},{"parameters":{"assignments":{"assignments":[{"id":"7413dfd7-1dbd-4551-be34-2e1c6e8181ec","name":"texto","value":"={{ $json.messages[0] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[6800,-288],"id":"5b1174e0-4bd1-4df2-a116-33fa92eeb92f","name":"FielsMsgBuffer"},{"parameters":{"jsCode":" const input =   $input.first().json.texto  || \"\";\n\n// 1) min√∫sculas\nlet clean = input.toLowerCase();\n\n// 2) remove moeda: \"r$\", \"r $\", \"$\"\nclean = clean.replace(/r\\s*\\$/gi, \"\").replace(/\\$/g, \"\");\n\n// 3) remove o \"r\" (ou qualquer letra) deixado ANTES de n√∫mero/1/2: \"r 6\", \"r 1/2\"\nclean = clean.replace(/\\b[a-z√†-√ø]\\s+(?=(\\d|1\\/2)\\b)/gi, \"\");\n\n// 4) mant√©m s√≥ letras/n√∫meros/espa√ßo e \"/\" (tira resto de s√≠mbolos)\nclean = clean.replace(/[^0-9a-z√†-√ø\\s/,.]/g, \" \");\n\n// 5) normaliza plurais comuns\nclean = clean.replace(/\\bpizzas\\b/g, \"pizza\")\n             .replace(/\\besfirras\\b/g, \"esfirra\");\n\n// 6) palavras de quantidade -> n√∫mero (antes de \"pizza\")\nclean = clean.replace(/\\b(uma|um)\\b(?=\\s+pizza\\b)/g, \"1\")\n             .replace(/\\b(duas|dois)\\b(?=\\s+pizza\\b)/g, \"2\")\n             .replace(/\\b(tr√™s|tres)\\b(?=\\s+pizza\\b)/g, \"3\");\n\n// 7) \"meia\" -> \"1/2\"\nclean = clean.replace(/\\bmeia\\b/g, \"1/2\");\n\n// 8) corrige \"6,19\" ou \"6.19\" -> \"1/2 19\"\nclean = clean.replace(/6[,.](\\d{1,2})\\b/g, \"1/2 $1\");\n\n// 9) padr√£o da transcri√ß√£o \"6 14 e 6 19\" -> \"1 pizza 1/2 14 e 1/2 19\"\nclean = clean.replace(/\\b6\\s+(\\d{1,2})(?:\\s*[,;]?\\s*e\\s*)6\\s+(\\d{1,2})\\b/g, \"1 pizza 1/2 $1 e 1/2 $2\");\n\n// 10) remove v√≠rgulas/pontos remanescentes que grudem nos n√∫meros (ex.: \"17,\" -> \"17\")\nclean = clean.replace(/[,.]/g, \" \");\n\n \n\n// 12) compacta espa√ßos\nclean = clean.replace(/\\s+/g, \" \").trim();\n\nreturn { original: input, comando_normalizado: clean };\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[6992,-240],"id":"c39c7783-2819-4414-890d-e220dfd4b693","name":"Normalizador"},{"parameters":{"content":"","height":1884,"width":15068,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[48,1568],"id":"d3f48c10-d6cf-4fe5-95a5-68c7cb206d41","name":"Sticky Note32"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1bd6c365-d077-4284-9dfe-94db1cbe39bd","leftValue":"={{ $('Buffer 3').item.json.messages.last() }}","rightValue":"={{ $('Buffer ').item.json.messages.last() }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[5104,2560],"id":"9dd82eeb-32f2-4d80-9552-a8256e52e7f1","name":"ComparandoMensagens1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"select  id_empresa::int  from empresa  where telefone = '{{ $json.telefoneEmpresa }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[8176,-272],"id":"440b6cee-be03-47d9-9fb7-ebd2e23bff7e","name":"TelefoneEmpresa","credentials":{"postgres":{"id":"zC1myfhKaFbD3WiM","name":"FinanceFlow"}}},{"parameters":{"operation":"get","tableId":"usuario_empresa","filters":{"conditions":[{"keyName":"user_id","keyValue":"={{ $('Merge1').item.json.user_id }}"}]}},"id":"4a5b6772-33a7-4cd7-8874-a3b3764ae7a0","name":"empresa","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[8144,-544],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"XG8fSQrjyd9kzaOx","name":"FinanceFlow"}},"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"\nselect empresa_id, usuario_id  from  \n usuarios as u , usuario_empresa as ue\n where u.id = ue.usuario_id and escolha = true\nand telefone =  '{{ $('Dados Lead').item.json.IdConversa.trim() }}'","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[6400,2480],"id":"a518dad1-49fb-479f-b569-d2eceb31a039","name":"Execute a SQL query","credentials":{"postgres":{"id":"zC1myfhKaFbD3WiM","name":"FinanceFlow"}}},{"parameters":{"assignments":{"assignments":[{"id":"10298ce6-6891-4737-9ec8-4354baea4d4c","name":"user_id","value":"={{ $json.usuario_id }}","type":"number"},{"id":"5bb41264-fee2-43f2-9934-a935f194b6a2","name":"empresa_id","value":"={{ $json.empresa_id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[6624,2480],"id":"9669edd9-72ba-4d47-bb9b-b1960ce8f3ff","name":"dados"},{"parameters":{"jsonSchemaExample":" {\n  \"type\": \"object\",\n  \"properties\": {\n    \"acao\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"registrar_despesa\",\n        \"registrar_receita\",\n        \"consultar_saldo\",\n        \"consultar_extrato\",\n        \"consultar_resumo\",\n        \"consultar_contas_pagar\",\n        \"consultar_contas_receber\",\n        \"consultar_fatura_cartao\",\n        \"ajuda\",\n        \"desconhecida\"\n      ]\n    },\n    \"origem_texto\": { \"type\": \"string\" },\n\n    \"valor\": { \"type\": [\"number\", \"null\"] },\n    \"tipo_lancamento\": {\n      \"type\": [\"string\", \"null\"],\n      \"enum\": [\"despesa\", \"receita\", null]\n    },\n    \"categoria\": { \"type\": [\"string\", \"null\"] },\n    \"conta\": { \"type\": [\"string\", \"null\"] },\n    \"descricao\": { \"type\": [\"string\", \"null\"] },\n\n    \"data\": { \"type\": [\"string\", \"null\"], \"description\": \"Formato YYYY-MM-DD\" },\n    \"periodo\": {\n      \"type\": [\"string\", \"null\"],\n      \"enum\": [\"hoje\", \"ontem\", \"essa_semana\", \"esse_mes\", \"mes_passado\", \"tudo\", null]\n    },\n\n    \"vencimento\": { \"type\": [\"string\", \"null\"], \"description\": \"YYYY-MM-DD\" },\n    \"cliente_fornecedor\": { \"type\": [\"string\", \"null\"] },\n\n    \"cartao\": { \"type\": [\"string\", \"null\"] },\n    \"fatura_periodo\": {\n      \"type\": [\"string\", \"null\"],\n      \"enum\": [\"atual\", \"proxima\", \"anterior\", null]\n    },\n\n    \"parcelas\": { \"type\": [\"number\", \"null\"] },\n    \"parcela_atual\": { \"type\": [\"number\", \"null\"] },\n\n    \"filtro_conta\": { \"type\": [\"string\", \"null\"] },\n    \"filtro_status\": {\n      \"type\": [\"string\", \"null\"],\n      \"enum\": [\"aberto\", \"vencido\", \"pago\", \"recebido\", null]\n    }\n  },\n  \"required\": [\"acao\", \"origem_texto\"]\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[8448,1136],"id":"2e485659-9e45-41f5-b155-dc47751f3e51","name":"Structured Output Parser"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[7792,2448],"id":"a68c6828-9c1e-4097-8659-47acba3a33a2","name":"When chat message received","webhookId":"2190b3ad-fa72-499e-8937-9db6a97da87d"},{"parameters":{"promptType":"define","text":"= {a√ß√£o: {{ $json.acao }}  }","options":{"systemMessage":"= "}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[8736,2448],"id":"0fe8194f-88e7-4a30-8b22-0f591f12ab63","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[8688,2768],"id":"ffabc8e5-7b44-4b3a-ab40-978ce3bf00b6","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"jsCode":" const sa√≠das = $input.first().json.output ;\n\nfor (const item of items) {\n  const txt = item.json.text;\n  const obj = JSON.parse(txt);\n  sa√≠das.push({ json: obj });\n}\n\nreturn sa√≠das;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[8656,1920],"id":"5d982b25-7e5c-4bbb-a3ae-d9d08f4bcfa5","name":"Code"},{"parameters":{"operation":"executeQuery","query":"  select * from ff_registrar_despesa(\n  1,\n  '{{ $json.conta }}',\n   '{{ $json.categoria }}',\n    {{ $json.valor }},\n  '{{ $json.descricao }}'\n  ,'{{ $json.data }}' \n   \n)","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[9056,2736],"id":"fdc83096-a189-4317-89de-1f7e7e58a331","name":"registrar_despesa","credentials":{"postgres":{"id":"zC1myfhKaFbD3WiM","name":"FinanceFlow"}}},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n {{ $json.chatInput }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"= Voc√™ √© um classificador financeiro.\n\nSua tarefa √© pegar QUALQUER frase e gerar SEMPRE o JSON FIXO abaixo,\nsem alterar nomes de campos e sem remover nada:\n\n{\n  \"acao\": \"desconhecida\",\n  \"origem_texto\": \"\",\n  \"valor\": null,\n  \"tipo_lancamento\": null,\n  \"categoria\": null,\n  \"conta\": null,\n  \"descricao\": null,\n  \"data\": null,\n  \"periodo\": null,\n  \"vencimento\": null,\n  \"cliente_fornecedor\": null,\n  \"cartao\": null,\n  \"fatura_periodo\": null,\n  \"parcelas\": null,\n  \"valor_parcela\": null,\n  \"parcela_atual\": null,\n  \"filtro_conta\": null,\n  \"filtro_status\": null\n}\n\nREGRAS:\n- Sempre retorne o JSON COMPLETO.\n- \"origem_texto\" deve conter a frase exata do usu√°rio.\n- S√≥ preencha campos que existirem na frase.\n- Se n√£o tiver certeza, deixe null.\n- A√á√ÉO √© SEMPRE UMA destas:\n\nregistrar_despesa\nregistrar_receita\nconsultar_saldo\nconsultar_extrato\nconsultar_resumo\nconsultar_contas_pagar\nconsultar_contas_receber\nconsultar_fatura_cartao\najuda\ndesconhecida\n\n- Nunca invente valores fora da frase.\n- Nunca retorne texto fora do JSON.\n- Nunca adicione campos extras.\n"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[7280,2752],"id":"99a00b4d-95dd-4d58-b492-1a10a9ee6e64","name":"Menu1","retryOnFail":true,"disabled":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"jsCode":" // Pega o texto do LLM\nlet raw = $json[\"text\"];\n\n// Remove escapes e formata como JSON\nraw = raw.replace(/\\\\n/g, \"\\n\")\n         .replace(/\\\\\"/g, '\"')\n         .replace(/^\"|\"$/g, \"\");\n\n// Converte para objeto\nlet obj = JSON.parse(raw);\n\n// Retorna limpo pro fluxo\nreturn obj;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[8480,2448],"id":"edb72ff2-c0ed-4ff8-aeff-9bb1396a66a9","name":"Code1"},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n {{ $json.chatInput }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"= Voc√™ √© um interpretador financeiro.\n\nPegue QUALQUER frase do usu√°rio e converta para o JSON EXATAMENTE no formato abaixo:\n\n{\n  \"acao\": null,\n  \"origem_texto\": \"\",\n  \"valor\": null,\n  \"tipo_lancamento\": null,\n  \"categoria\": null,\n  \"conta\": null,\n  \"descricao\": null,\n  \"data\": null,\n  \"periodo\": null,\n  \"vencimento\": null,\n  \"cliente_fornecedor\": null,\n  \"cartao\": null,\n  \"fatura_periodo\": null,\n  \"parcelas\": null,\n  \"valor_parcela\": null,\n  \"parcela_atual\": null,\n  \"filtro_conta\": null,\n  \"filtro_status\": null\n}\n\nREGRAS:\n- SEM NADA FORA DISSO.\n- SEM criar campos novos.\n- SEM deixar faltar campo.\n- SEM mudar os nomes.\n- \"acao\" DEVE ser uma dessas:\n  registrar_despesa, registrar_receita,\n  consultar_saldo, consultar_extrato,\n  consultar_resumo, consultar_contas_pagar,\n  consultar_contas_receber, consultar_fatura_cartao,\n  ajuda, desconhecida\n\n- SE N√ÉO ENTENDER ‚Üí coloque \"acao\": \"desconhecida\"\n- Sempre preencha origem_texto com a frase original.\n- Se achar valor ‚Üí extraia.\n- Se achar conta ‚Üí extraia.\n- Se achar data ‚Üí extraia no formato YYYY-MM-DD ou deixe null.\n\nRETORNE APENAS O JSON PURO.\nNUNCA retorne texto fora do JSON.\n"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[7360,2592],"id":"03f38c5e-c8fb-41d8-a0da-a2d5ec9031c0","name":"Menu2","retryOnFail":true,"disabled":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMA√á√ÉO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"jsCode":"const hoje = new Date();\nconst ontem = new Date(Date.now() - 24 * 60 * 60 * 1000);\nconst amanha = new Date(Date.now() + 24 * 60 * 60 * 1000);\n\nfunction format(d) {\n  return d.toISOString().slice(0,10);\n}\n\nreturn [{\n  json: {\n    HOJE: format(hoje),\n    ONTEM: format(ontem),\n    AMANHA: format(amanha),\n    mensagem:$input.first().json.chatInput\n  }\n}];\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[7968,2448],"id":"dca38251-e2b9-4c22-981d-164018959f38","name":"gerar_data"},{"parameters":{"operation":"executeQuery","query":"  select * from ff_registrar_receita(\n  1,\n  '{{ $json.conta }}',\n   '{{ $json.categoria }}',\n    {{ $json.valor }},\n  '{{ $json.descricao }}'\n  ,'{{ $json.data }}' \n   \n)","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[8848,2736],"id":"856815bf-06fe-4055-8277-ed8ddf2de838","name":"registrar_receita","credentials":{"postgres":{"id":"zC1myfhKaFbD3WiM","name":"FinanceFlow"}}}],"connections":{"Encontrar Cliente1":{"main":[[{"node":"Cliente Existe?1","type":"main","index":0}]]},"Cliente Existe?1":{"main":[[{"node":"Concatena","type":"main","index":0}],[{"node":"Criar Cliente1","type":"main","index":0}]]},"Criar Cliente1":{"main":[[{"node":"Concatena","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"empresa","type":"main","index":0}]]},"Dados Lead":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Parametros Fluxo":{"main":[[{"node":"Filtro Inicial1","type":"main","index":0}]]},"Concatena":{"main":[[{"node":"Merge1","type":"main","index":0}],[{"node":"Merge1","type":"main","index":1}]]},"Filtro Inicial1":{"main":[[{"node":"Dados Lead","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Menu","type":"ai_languageModel","index":0}]]},"MsgUsuario":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"Switch":{"main":[[],[],[],[],[],[],[],[],[],[],[]]},"Webhook":{"main":[[{"node":"Parametros Fluxo","type":"main","index":0}]]},"Menu":{"main":[[{"node":"Code1","type":"main","index":0}]]},"CriaPedido":{"main":[[{"node":"MergePedido","type":"main","index":1}]]},"Cliente Pedido":{"main":[[{"node":"MergePedido","type":"main","index":0}],[{"node":"CriaPedido","type":"main","index":0}]]},"MergePedido":{"main":[[]]},"Acao":{"main":[[]]},"Switch1":{"main":[[{"node":"Mensagem Texto1","type":"main","index":0}],[{"node":"Mensagem Texto2","type":"main","index":0}],[{"node":"Mensagem Audio1","type":"main","index":0}],[{"node":"Mensagem Imagem1","type":"main","index":0}],[{"node":"Mensagem Documento PDF","type":"main","index":0}],[{"node":"Mensagem Erro1","type":"main","index":0}]]},"Transcrever √Åudio1":{"main":[[{"node":"Add Audio Buffer1","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"Add Imagem Buffer1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Buffer 3","type":"main","index":0}]]},"Buffer ":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Buffer 3":{"main":[[{"node":"ComparandoMensagens1","type":"main","index":0}]]},"Add Texto Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Apagar Buffer1":{"main":[[{"node":"MensagemTraduzida","type":"main","index":0}]]},"Mensagem Texto1":{"main":[[{"node":"Add Texto Buffer1","type":"main","index":0}]]},"Mensagem Audio1":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Mensagem Imagem1":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Add Audio Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Add Error Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Add PDF Buffer1","type":"main","index":0}]]},"Mensagem Erro1":{"main":[[{"node":"Add Error Buffer1","type":"main","index":0}]]},"Add PDF Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Add Imagem Buffer1":{"main":[[{"node":"Buffer ","type":"main","index":0}]]},"Redis":{"main":[[{"node":"Bot Desativado?1","type":"main","index":0}]]},"Bot Desativado?1":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"Switch1","type":"main","index":0}]]},"Mensagem Documento PDF":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"Transcrever √Åudio1","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Mensagem Texto2":{"main":[[{"node":"Add Texto Buffer1","type":"main","index":0}]]},"MensagemTraduzida":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}]]},"If7":{"main":[[{"node":"MsgUsuario1","type":"main","index":0}],[{"node":"MsgUsuario","type":"main","index":0}]]},"MsgUsuario1":{"main":[[{"node":"Merge2","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Acao","type":"main","index":0}]]},"Validador":{"main":[[]]},"DadosEmpresa":{"main":[[]]},"Code4":{"main":[[{"node":"If7","type":"main","index":0}]]},"FielsMsgBuffer":{"main":[[{"node":"Normalizador","type":"main","index":0}]]},"Normalizador":{"main":[[{"node":"Validador","type":"main","index":0}]]},"ComparandoMensagens1":{"main":[[{"node":"Apagar Buffer1","type":"main","index":0}],[{"node":"No Operation, do nothing6","type":"main","index":0}]]},"TelefoneEmpresa":{"main":[[]]},"empresa":{"main":[[{"node":"Cliente Pedido","type":"main","index":0}]]},"Execute a SQL query":{"main":[[{"node":"dados","type":"main","index":0}]]},"dados":{"main":[[]]},"Structured Output Parser":{"ai_outputParser":[[]]},"When chat message received":{"main":[[{"node":"gerar_data","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"registrar_despesa":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Code1":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"gerar_data":{"main":[[{"node":"Menu","type":"main","index":0}]]},"registrar_receita":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.lglducci.com.br","user-agent":"axios/1.7.7","content-length":"937","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"159.69.117.195","cf-ipcountry":"DE","cf-ray":"98e88c158cd03813-FRA","cf-visitor":"{\"scheme\":\"https\"}","content-type":"application/json","x-forwarded-for":"162.158.95.135","x-forwarded-host":"n8n.lglducci.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"traefik_traefik.1","x-real-ip":"162.158.95.135"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"LaCantina","data":{"key":{"remoteJid":"5516992975836@s.whatsapp.net","fromMe":false,"id":"3EB013725F9A85FA25FB92"},"pushName":"Luis Gustavo Landucci","message":{"conversation":"bordar cheddar","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"2uKRt0FvHGKKWg==","senderTimestamp":"1760382036","senderAccountType":"E2EE","receiverAccountType":"E2EE","recipientKeyHash":"wPv/XIryFk6EMg==","recipientTimestamp":"1760388519"},"deviceListMetadataVersion":2,"messageSecret":"m77M95HmgMNU/TKV3TobaJFbZvk6JFulSWFx1e0iTyc="}},"messageType":"conversation","messageTimestamp":1760460327,"instanceId":"cd2747c1-47c6-49d2-9649-45970ef316b7","source":"web"},"destination":"https://n8n.lglducci.com.br/webhook-test/agente_delivery","date_time":"2025-10-14T13:45:27.222Z","sender":"5516994066336@s.whatsapp.net","server_url":"https://evolution.lglducci.com.br","apikey":"E9C6EA4E47E7-4905-BC38-475CBACA3F1E"},"webhookUrl":"https://webhook.lglducci.com.br/webhook-test/agente_delivery","executionMode":"test"}}]},"versionId":"0bf4463d-269b-490a-bd0e-c7c219fa7fc7","triggerCount":0,"shared":[{"createdAt":"2025-11-14T15:10:20.122Z","updatedAt":"2025-11-14T15:10:20.122Z","role":"workflow:owner","workflowId":"vMBkizD5VMy1WoZT","projectId":"wFRMrac2003Pl1x6"}],"tags":[]}