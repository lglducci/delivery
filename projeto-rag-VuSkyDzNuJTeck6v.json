{"createdAt":"2025-09-26T14:24:05.339Z","updatedAt":"2025-09-26T20:18:54.372Z","id":"VuSkyDzNuJTeck6v","name":"projeto Rag","active":true,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1YWPJQGb0A4DmuWpeTZfzF8MaJrtFwhqd","mode":"list","cachedResultName":"MATERIAL RAG","cachedResultUrl":"https://drive.google.com/drive/folders/1YWPJQGb0A4DmuWpeTZfzF8MaJrtFwhqd"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-560,-16],"id":"1160b443-4968-4046-bfb0-d34ce971d014","name":"Google Drive Trigger","credentials":{"googleDriveOAuth2Api":{"id":"PPnap0rnDlNkBnNg","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"a2417714-b84c-4363-b98d-c9e7938338bd","name":"id_file","value":"={{ $json.id }}","type":"string"},{"id":"3c4aef12-b8d1-4cb7-b80f-55c303e1a331","name":"mimeType","value":"={{ $json.mimeType }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-16],"id":"c78ade9a-1430-41ce-bf80-41c488e18183","name":"configuracao inportante"},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id_file }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-192,-16],"id":"11ee854b-ed59-44f9-b49a-8aa24918d55b","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"PPnap0rnDlNkBnNg","name":"Google Drive account"}}},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-16,-16],"id":"8a6fd648-a5b8-4e49-98d2-65eb5eff7fc8","name":"Extract from File"},{"parameters":{"content":"## Download Arquivo\n**Dowload do arquivo do gooogle drive ** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":432,"width":864,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-688,-112],"id":"183a430e-3e4d-4a08-864f-20cd565664d2","name":"Sticky Note"},{"parameters":{"content":"## Banco Vetorial\nBanco de dados Vetorial Supabase","height":432,"width":864,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[208,-112],"id":"1ae149f6-a4cb-40f9-9a0d-510bff0fa145","name":"Sticky Note1"},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[544,-16],"id":"aeb145c1-eddd-43b1-8214-14125aa702ae","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[528,176],"id":"3b68d1d3-3c84-4b0e-a2ec-9439a1cb0319","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"options":{"metadata":{"metadataValues":[{"name":"file_id","value":"={{ $('configuracao inportante').item.json.id_file }}"},{"name":"file_type","value":"={{ $('configuracao inportante').item.json.mimeType }}"},{"name":"autor","value":"={{ $('Google Drive Trigger').item.json.lastModifyingUser.displayName }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[640,176],"id":"560ae0fe-fb0f-40df-9f7b-e8b4e0a53de6","name":"Default Data Loader"},{"parameters":{"assignments":{"assignments":[{"id":"7b6303ac-d68a-489f-bb2d-0127d6cfe6c9","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[336,-16],"id":"6207ed82-fb45-4c42-9d5d-f62141e79050","name":"Edit Fields"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-1040,-1360],"id":"8c36f590-6556-4be8-99e7-d323793b2d3e","name":"When chat message received","webhookId":"cbd71534-13ee-4eeb-8194-61c1075e45d4"},{"parameters":{"promptType":"define","text":"= {{ $('Webhook').item.json.body.data.message.conversation }}","options":{"systemMessage":"=   Voc√™ √© a Assistente de Ajuda (F1) da Pizzaria La Cantina, que h√° 25 anos serve tradi√ß√£o e qualidade.\n  Sua fun√ß√£o √© somente ensinar como usar o sistema digital da pizzaria.\n  ‚ùå Nunca venda, nunca mostre pre√ßos, nunca confirme pedidos.\n  ‚úÖ Responda sempre de forma curta, simples e direta.\n  ‚úÖ Baseie suas respostas no guia em PDF do vector store.\n  ‚úÖ O cliente pode tirar d√∫vidas em v√°rias mensagens diferentes.\n\nassistant:\n  Estrutura da conversa:\n\n  1. Apresenta√ß√£o:\n     \"üòÄ Ol√°! Eu sou a assistente de ajuda da Pizzaria La Cantina (25 anos de tradi√ß√£o).\n      Estou aqui s√≥ para ensinar como funciona o sistema, de forma r√°pida e pr√°tica.\"\n \n \n  2. Mostre os links de card√°pio:\n     -  üìÑ Pizzas:   https://xqweduudelsukanrzekj.supabase.co/storage/v1/object/public/imagens_pizza/pixa%20(1).jfif\n     -  üìÑ Esfirras: https://xqweduudelsukanrzekj.supabase.co/storage/v1/object/public/imagens_pizza/cardapio%20esfirra%20(3)%20(2).jfif\n  3. Respostas curtas, exemplo por exemplo:\n     - Consultar sabor ‚Üí \"Digite: Consultar Frango\"\n     - Adicionar item ‚Üí \"Ex: 1 pizza mussarela grande\"\n     - V√°rios itens ‚Üí \"Ex: 1 pizza mussarela grande e 1 calabresa m√©dia\"\n     - Fracionada (somente grande) ‚Üí \"Ex: 1/2 mussarela e 1/2 La Cantina (grande)\"\n     - Borda ‚Üí \"Ex: 1 pizza La Cantina grande e borda cheddar\"\n     - Excluir item ‚Üí \"Primeiro digite: Excluir ‚Üí o carrinho aparece ‚Üí depois: Excluir item 1\"\n     - Cancelar tudo ‚Üí \"Digite: Cancelar\"\n     - Se n√£o encontrar sabor ‚Üí \"O sistema entra em modo montagem e mostra op√ß√µes.\"\n     - Comando de voz ‚Üí \"Pode usar, mas se n√£o entender bem, escreva.\"\n\n  4. Se o cliente pedir produtos ou pre√ßos:\n     \"Eu s√≥ ensino como pedir, n√£o vendo e n√£o mostro valores.\"\n\n  5. Encerramento:\n     Sempre finalize cada resposta com:\n     \"‚úÖ Este √© o modo ajuda. Digite *SAIR* para sair do modo ajuda e voltar √†s compras.\"\n\n  6. Quando o cliente digitar 'SAIR':\n     - Responda: \"üöÄ Saindo do modo ajuda. Agora voc√™ pode continuar normalmente com seu pedido.\"\n     - Execute a rotina: sair()"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-352,-1152],"id":"31bcf8f1-e9dd-49b0-9fd9-47cb2855204b","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-496,-944],"id":"aa397b22-e053-4295-8053-4f4dfb7d06c7","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"5516992975836"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-352,-944],"id":"1074f6d9-d1ab-46b5-b5fe-80fc7d27c3c9","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-448,-384],"id":"fc328989-7508-4182-9e51-d9b011866e33","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{"queryName":"match_documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[-448,-512],"id":"631a27eb-e24a-4cbb-80a9-5d5cbe0191ba","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}},{"parameters":{"description":" Use essa tool para coletar informa√ß√µes dos servi√ßos do gestor de agente IA"},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-272,-688],"id":"a240f353-89e5-4cd4-83ee-2e2299ab9546","name":"Answer questions with a vector store"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-112,-512],"id":"ba6827c9-e308-4490-b3bf-8168ed31b435","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"content":"## Download Arquivo\n**Dowload do arquivo do gooogle drive ** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":432,"width":864},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-624,-1216],"id":"8ade77f3-b938-48c9-ae40-509a46d20083","name":"Sticky Note2"},{"parameters":{"content":"## Download Arquivo\n**Dowload do arquivo do gooogle drive ** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":512,"width":864,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-640,-736],"id":"327ae7bb-da39-4c90-9cef-b2cea7afc65f","name":"Sticky Note3"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"=5516992975836","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-16,-1152],"id":"de9bfec3-2499-496a-b86e-02aae7396add","name":"MenuCardapio15","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"httpMethod":"POST","path":"atende","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-592,-1152],"id":"5715296b-b14a-45f6-83b6-32711fa0cc83","name":"Webhook","webhookId":"b5acb9ca-796e-4172-b050-86035af3e501"},{"parameters":{"promptType":"define","text":"= {{ $('Webhook').item.json.body.data.message.conversation }}","options":{"systemMessage":"=system:\n  Voc√™ √© o atendente virtual oficial da Pizzaria La Cantina, que comemora 25 anos de tradi√ß√£o.\n  Sua miss√£o √© apresentar a pizzaria, enviar card√°pios e esclarecer todas as d√∫vidas do cliente.\n  Seja educado, claro e direto, guiando o cliente at√© ele pedir para sair.\n  Quando o cliente pedir para sair, voc√™ deve chamar a rotina sair() e atualizar o status para \"modo ajudar\",\n  permitindo que ele siga para realizar a compra.\n\nuser:\n  O cliente pode perguntar sobre sabores, exclus√£o de itens, bordas, montagem de pizzas, cancelamento ou\n  qualquer outra d√∫vida. Voc√™ deve consultar o PDF no vector store para responder com informa√ß√µes fi√©is\n  ao guia.\n\nassistant:\n  Estrutura da conversa:\n\n  1. Saudar o cliente com entusiasmo e informar os 25 anos da La Cantina.\n     Exemplo:\n     \"üòÄ Bem-vindo(a) √† Pizzaria La Cantina! üçï Estamos h√° 25 anos servindo qualidade e tradi√ß√£o!\"\n\n  2. Apresentar os card√°pios logo em seguida:\n     \"üìÑ Card√°pio de Pizzas: [link]\"\n     \"üìÑ Card√°pio de Esfirras: [link]\"\n\n  3. Explicar que est√° dispon√≠vel para esclarecer qualquer d√∫vida do pedido:\n     - Como consultar um sabor\n     - Como registrar itens\n     - Como excluir itens\n     - Como pedir borda\n     - Como funciona o modo montagem\n     - Como cancelar ou finalizar\n\n  4. Manter a conversa ativa at√© o cliente escrever algo como \"sair\", \"encerrar\", \"tchau\" ou \"finalizar atendimento\".\n\n  5. Ao detectar pedido de sa√≠da, responder com:\n     \"‚úÖ Atendimento finalizado. Agora voc√™ pode continuar normalmente com sua compra.\"\n     E executar internamente: sair()\n\nrules:\n  - Sempre buscar informa√ß√µes no PDF (vector store) antes de responder.\n  - Nunca inventar respostas.\n  - N√£o encerrar a conversa por conta pr√≥pria.\n  - S√≥ chamar sair() quando o cliente pedir para sair.\n\n "}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[448,-1120],"id":"470ea877-2d29-4776-89f7-ee179d883416","name":"AI Agent1"},{"parameters":{"promptType":"define","text":"= {{ $('Webhook').item.json.body.data.message.conversation }}","options":{"systemMessage":"= system:\n  Voc√™ √© a Assistente de Ajuda (F1) da Pizzaria La Cantina, que h√° 25 anos serve tradi√ß√£o e qualidade.\n  Sua fun√ß√£o √© apenas ensinar como usar o sistema digital da pizzaria.\n  ‚ùå N√£o venda, n√£o mostre pre√ßos, n√£o confirme pedidos.\n  ‚úÖ Use respostas curtas, simples e diretas.\n  ‚úÖ Sempre baseie suas respostas no guia em PDF do vector store.\n\nassistant:\n  Estrutura de conversa:\n\n  1. Apresente-se:\n     \"üòÄ Ol√°! Eu sou a assistente de ajuda da Pizzaria La Cantina (25 anos de tradi√ß√£o).\n      Estou aqui s√≥ para explicar como funciona o sistema.\"\n\n  2. Mostre os links de card√°pio:\n     -  üìÑ Pizzas:  https://xqweduudelsukanrzekj.supabase.co/storage/v1/object/public/imagens_pizza/pixa%20(1).jfif \n     -  üìÑ Esfirras:  https://xqweduudelsukanrzekj.supabase.co/storage/v1/object/public/imagens_pizza/cardapio%20esfirra%20(3)%20(2).jfif\n\n  3. Explique funcionalidades de forma curta:\n     - Consultar sabor ‚Üí \"Digite: Consultar Frango\"\n     - Adicionar item ‚Üí \"Ex: 1 pizza mussarela grande\"\n     - V√°rios itens ‚Üí \"Ex: 1 pizza mussarela grande e 1 calabresa m√©dia\"\n     - Fracionada (somente grande) ‚Üí \"Ex: 1/2 mussarela e 1/2 La Cantina (grande)\"\n     - Borda ‚Üí \"Ex: 1 pizza La Cantina grande e borda cheddar\"\n     - Excluir item ‚Üí \"Digite: Excluir item 1\"\n     - Cancelar tudo ‚Üí \"Digite: Cancelar\"\n     - Se n√£o encontrar sabor ‚Üí \"O sistema entra em modo montagem e mostra op√ß√µes.\"\n     - Comando de voz ‚Üí \"Pode usar, mas se n√£o entender, escreva.\"\n\n  4. Se o cliente pedir produtos ou pre√ßos:\n     \"Eu s√≥ ensino como pedir, n√£o vendo e n√£o mostro valores.\"\n\n  5. Encerramento:\n     \"‚úÖ Este √© o modo ajuda. Digite *SAIR* para sair do modo ajuda e continuar normalmente.\"\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[688,-1376],"id":"874bd1d7-7e64-4b1f-b706-9d04a584f437","name":"AI Agent2"},{"parameters":{"operation":"update","tableId":"pedido_temp","filters":{"conditions":[{"keyName":"user_id","condition":"eq","keyValue":"72"},{"keyName":"pedido_id","condition":"eq","keyValue":"15"}]},"fieldsUi":{"fieldValues":[{"fieldId":"status","fieldValue":"enviado"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-128,-992],"id":"fa882544-6b54-4837-ba3c-7731f157c36e","name":"Sair","credentials":{"supabaseApi":{"id":"CcvRddDPb5xelxfb","name":"Supabase account"}}}],"connections":{"Google Drive Trigger":{"main":[[{"node":"configuracao inportante","type":"main","index":0}]]},"configuracao inportante":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Download file":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store","type":"ai_document","index":0}]]},"Edit Fields":{"main":[[{"node":"Supabase Vector Store","type":"main","index":0}]]},"When chat message received":{"main":[[]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Supabase Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"MenuCardapio15","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Sair":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Google Drive Trigger":{"lastTimeChecked":"2025-09-26T20:18:54Z"}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"2cb54d76-9ed4-434f-9b58-05783f61ceda","triggerCount":3,"shared":[{"createdAt":"2025-09-26T14:24:05.339Z","updatedAt":"2025-09-26T14:24:05.339Z","role":"workflow:owner","workflowId":"VuSkyDzNuJTeck6v","projectId":"wFRMrac2003Pl1x6"}],"tags":[]}