{"createdAt":"2025-09-07T01:19:03.220Z","updatedAt":"2025-09-07T01:19:03.220Z","id":"aqJhIHkDOzVeJZCj","name":"My workflow 2","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"admin","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1008,272],"id":"aaf09fef-710c-472d-b513-932bb116e9f7","name":"Webhook","webhookId":"bf0ff01c-6b1c-46b2-aab6-f6141389191d"},{"parameters":{"operation":"executeQuery","query":" SELECT * FROM busca_cardapio(1);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1280,304],"id":"e667b1a9-a940-4f48-b5e1-7173e04bef54","name":"Execute a SQL query"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[288,480],"id":"95f7ee7a-155a-461d-bb08-8bc3625e1529","name":"OpenAI Chat Model"},{"parameters":{"jsCode":" return [\n  {\n    json: JSON.parse( $input.first().json.text) // ou o campo correto de saÃ­da\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[656,288],"id":"be629f7d-0f94-4581-b0e5-d606f4a3d657","name":"MsgUsuario"},{"parameters":{"promptType":"define","text":"=<mensagem_do_usuario>\n {{ $json.mensagem }}\n</mensagem_do_usuario>","hasOutputParser":true,"messages":{"messageValues":[{"message":"= VocÃª Ã© um classificador de intenÃ§Ã£o para um administrador de  pedido de pizzaria.\n\nDada a mensagem do administrador, responda APENAS com uma das seguintes aÃ§Ãµes:\n\n- pedido_aberto â†’ o administrador digitou \"1\" para adicionar gostaria de consultar todos os pedidos em aberto\n- avancar_pedido â†’ admin digitou \"2\" muda o status do pedido\n- cancelar_pedidoâ†’ se ele disser que desistiu, quer cancelar ou digitar \"3\" \n- desconhecida â†’ se nÃ£o entender a mensagem \n- detalhar_pedido â†’ se o admin quer ver os detalhes dos itens do pedido ou digitar \"4\"\n- menu â†’ se ele pedir o menu ou opÃ§Ãµes \"5\"\n- conferir_cardapio â†’  o admin diser \"conferir\", ou digitou \"6\" para conferir item no cardapio \n- bebida â†’  o Admini diser \"bebida\", ou digitou \"7\" para ver o cardapio \n- alterar_preco â†’  o Admini diser \"preco\", ou digitou \"8\" para ver o cardapio\n \n\nRetorne **somente** nesse formato:\n\n{\n  \"acao\": \"pedido_aberto\" | \"avancar_pedido\" | \"cancelar_pedido\" | \"desconhecida\" | \"detalhar_pedido\" | \"menu\" | \"conferir_cardapio\" | \"bebida\" | \"alterar_preco\" \n}"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.6,"position":[288,288],"id":"ad50ddea-63c6-4b0a-8764-68adb890e9ca","name":"Menu","retryOnFail":true,"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÃ‡ÃƒO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"204f54b0-e3ed-4ff4-8302-8c20d3b8aa78","leftValue":"={{ $('Webhook').item.json.body.isGroup }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"c51986d9-f347-4198-89bb-9e4cd0f021c9","leftValue":"={{ $('Webhook').item.json.body.broadcast }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05ee6414-0164-473b-8f82-225cfba55ad2","leftValue":"={{ $('Webhook').item.json.body.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"id":"fcf71c0e-ab6b-4d46-8618-4af1c062f014","name":"Filtro Inicial","type":"n8n-nodes-base.filter","typeVersion":2.1,"position":[-544,272],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÃ‡ÃƒO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"assignments":{"assignments":[{"id":"b40ee603-4967-46a7-a72a-24f6dd3a72ef","name":"mensagem","value":"={{ $json.body.message.conversation }}","type":"string"},{"id":"2d89e2fe-d49d-42c0-b926-321f2524e0c4","name":"telefone_admin","value":"={{ $json.body.key.remoteJid }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-768,272],"id":"72fb7423-9265-4fcb-8f9f-c0bd31f92d42","name":"EditFields"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.acao }}","rightValue":"pedido_aberto","operator":{"type":"string","operation":"equals"},"id":"c957927a-1cf4-44bf-8f38-1496767b6a1b"}],"combinator":"and"},"renameOutput":"=pedido_aberto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"03a78ab2-9057-4ff5-baa5-8c37c432a94d","leftValue":"={{ $json.acao }}","rightValue":"avancar_pedido","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"avancar_pedido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e3fc41f2-ee99-4de2-8841-2ae1a7da37db","leftValue":"={{ $json.acao }}","rightValue":"cancelar_pedido","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"cancelar_pedido"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"38045ee6-0b44-4b52-a79c-676c7ce5998a","leftValue":"={{ $json.acao }}","rightValue":"desconhecida","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"desconhecida"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4bbedcdd-6893-41a2-9e3d-bfc9b97ca10a","leftValue":"={{ $json.acao }}","rightValue":"menu","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"menu"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"42e2c65b-a99d-4991-ac87-a7ff8d84d4a5","leftValue":"={{ $json.acao }}","rightValue":"conferir_cardapio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"conferir_cardapio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"23e65839-03f6-4879-8998-48ad2909ef94","leftValue":"={{ $json.acao }}","rightValue":"bebida","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"bebida"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4f5a8ba2-c888-48cd-bbe2-ba09467e56a0","leftValue":"={{ $json.acao }}","rightValue":"alterar_preco","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"alterar_preco"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[928,176],"id":"4014cc83-1e35-43ec-a21a-158adda0fd40","name":"Switch"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[224,0],"id":"86f58d82-ffd1-4f91-a627-b0f3f166a6e4","name":"No Operation, do nothing1","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÃ‡ÃƒO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"method":"POST","url":"= https://apinocode01.megaapi.com.br/rest/sendMessage/megacode-MyrBo2u0n7N/text","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Client-Token","value":"application/json"},{"name":"Authorization","value":"Bearer MyrBo2u0n7N"}]},"sendBody":true,"specifyBody":"json","jsonBody":"= {\n  \"messageData\": {\n    \"to\": \"{{ $('EditFields').item.json.telefone_admin }}\",\n    \"text\": \"ðŸ§¾ *Escolha uma opÃ§Ã£o abaixo:*\\n\\n*1.* Adicionar itens ao pedido\\n*2.*  Ver instruÃ§Ãµes para pedir corretamente\\n*3.*  Ver cardÃ¡pio completo\\n*4.*  Concluir pedido\\n*5.*  Consultar pedido atual\\n*6.*  Cancelar pedido\\n*7.*  Detalhar itens do pedido\\n\\n*Responda com 1, 2, 3, 4, 5, 6 ou 7 para continuar.*\"\n  }\n}\n","options":{}},"id":"b81d2fd9-1922-41d8-b08a-a197d82edc9f","name":"RequestMenu","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[0,0]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"59aebb69-dff5-45f5-90af-37073a76cfe2","leftValue":"={{ $('EditFields').item.json.mensagem }}","rightValue":"menu","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"c9501565-929c-44be-9ba0-708347a3b42e","leftValue":"={{ $('EditFields').item.json.mensagem }}","rightValue":"5","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-192,272],"id":"52479528-154c-49e3-ae57-b37488b84e29","name":"If"},{"parameters":{"operation":"executeQuery","query":" SELECT * FROM pedidos where status <>'concluido';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1184,80],"id":"1cdbc521-daa3-4dd9-81fe-1511471f64a9","name":"PedidoAberto"}],"connections":{"Webhook":{"main":[[{"node":"EditFields","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Menu","type":"ai_languageModel","index":0}]]},"Menu":{"main":[[{"node":"MsgUsuario","type":"main","index":0}]]},"Filtro Inicial":{"main":[[{"node":"If","type":"main","index":0}]]},"EditFields":{"main":[[{"node":"Filtro Inicial","type":"main","index":0}]]},"MsgUsuario":{"main":[[{"node":"Switch","type":"main","index":0}]]},"RequestMenu":{"main":[[{"node":"No Operation, do nothing1","type":"main","index":0}]]},"If":{"main":[[{"node":"RequestMenu","type":"main","index":0}],[{"node":"Menu","type":"main","index":0}]]},"Switch":{"main":[[{"node":"PedidoAberto","type":"main","index":0}],[],[],[],[],[{"node":"Execute a SQL query","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"c5f25e72-6453-4ee2-a6b0-bc8c880372ee","triggerCount":0,"shared":[{"createdAt":"2025-09-07T01:19:03.220Z","updatedAt":"2025-09-07T01:19:03.220Z","role":"workflow:owner","workflowId":"aqJhIHkDOzVeJZCj","projectId":"wFRMrac2003Pl1x6"}],"tags":[]}