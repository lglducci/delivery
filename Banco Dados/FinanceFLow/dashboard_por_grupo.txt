CREATE OR REPLACE FUNCTION contab.dashboard_por_grupo (
    p_empresa_id BIGINT,
    p_data_ini DATE,
    p_data_fim DATE
)
RETURNS TABLE (
    grupo TEXT,
    valor NUMERIC
)
LANGUAGE sql
AS $$
SELECT
    c.tipo AS grupo,
    SUM(l.credito - l.debito) AS valor
FROM contab.lancamentos l
JOIN contab.contas c ON c.id = l.conta_id
WHERE l.empresa_id = p_empresa_id
  AND l.data_mov BETWEEN p_data_ini AND p_data_fim
GROUP BY c.tipo;
$$;
