CREATE TABLE public.perfis (
    id        BIGSERIAL PRIMARY KEY,
    codigo    VARCHAR(30) NOT NULL UNIQUE,  -- CONTABIL | FINANCEIRO | VENDAS | TOTAL
    nome      VARCHAR(100) NOT NULL,
    criado_em TIMESTAMP DEFAULT now()
);


 


CREATE TABLE public.usuario_empresa_perfil (
    id          BIGSERIAL PRIMARY KEY,
    usuario_id  BIGINT NOT NULL REFERENCES public.usuarios(id),
    empresa_id  BIGINT NOT NULL REFERENCES public.empresas(id),
    perfil_id   BIGINT NOT NULL REFERENCES public.perfis(id),

    UNIQUE (usuario_id, empresa_id)
);


CREATE TABLE public.sidebar_itens (
    id        BIGSERIAL PRIMARY KEY,
    codigo    VARCHAR(50) NOT NULL UNIQUE,
    titulo    VARCHAR(100) NOT NULL,
    rota      VARCHAR(200) NOT NULL,
    modulo    VARCHAR(30) NOT NULL, -- CONTABIL | FINANCEIRO | VENDAS
    ordem     INT NOT NULL DEFAULT 0,
    ativo     BOOLEAN DEFAULT TRUE
);

 

CREATE TABLE public.perfil_sidebar (
    perfil_id       BIGINT REFERENCES public.perfis(id),
    sidebar_item_id BIGINT REFERENCES public.sidebar_itens(id),
    PRIMARY KEY (perfil_id, sidebar_item_id)
);


INSERT INTO public.perfis (codigo, nome) VALUES
('CONTABIL',   'Perfil Contábil'),
('FINANCEIRO', 'Perfil Financeiro'),
('VENDAS',     'Perfil Vendas'),
('TOTAL',      'Perfil Administrador');

INSERT INTO public.sidebar_itens (codigo, titulo, rota, modulo, ordem) VALUES
('DASH_CONTABIL', 'Dashboard Contábil', '/contabil/dashboard', 'CONTABIL', 1),
('DIARIO',        'Diário Contábil',    '/contabil/diario',    'CONTABIL', 2),
('RAZAO',         'Razão',              '/contabil/razao',     'CONTABIL', 3),
('BALANCETE',     'Balancete',          '/contabil/balancete', 'CONTABIL', 4),
('DRE',           'DRE',                '/contabil/dre',       'CONTABIL', 5);

 
INSERT INTO public.perfil_sidebar (perfil_id, sidebar_item_id)
SELECT p.id, s.id
FROM public.perfis p
JOIN public.sidebar_itens s ON s.modulo = 'CONTABIL'
WHERE p.codigo = 'CONTABIL';


