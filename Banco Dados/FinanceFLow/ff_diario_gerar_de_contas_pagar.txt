 

 CREATE OR REPLACE FUNCTION contab.ff_diario_gerar_de_contas_pagar(
    p_empresa_id bigint,
    p_data    date 
)
RETURNS void 
LANGUAGE plpgsql
AS $$
 
BEGIN
    INSERT INTO  contab.diario_staging  (
        empresa_id,
        data_mov,
        modelo_codigo,
        historico,
        doc_ref,
        parceiro_id,
        cnpj, 
        data_vencto,
        valor_total,
        valor_custo,
        valor_imposto,
        desconto,
        status,
        outros  
    )
    SELECT
        c.empresa_id,
        c.criado_em,
        c.evento_codigo   AS modelo_codigo,   -- ← você define o nome da coluna
        c.descricao,
        c.doc_ref,
        c.fornecedor_id,
      (
      SELECT p.cpf_cnpj
      FROM public.pessoa p
      WHERE p.id = c.fornecedor_id
    ) AS cnpj,
        c.vencimento,
        c.valor,
        0,
        0,
        0,
        'rascunho',
         jsonb_build_object(
        'origem', 'CONTAS_PAGAR',
        'evento', 'CRIA_PAGAR' 
    ) 
     
    FROM public.contas_a_pagar c
    WHERE c.empresa_id = p_empresa_id
      AND c.criado_em =  p_data   ;
  
END;
$$;

 