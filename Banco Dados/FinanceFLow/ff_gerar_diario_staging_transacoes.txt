    CREATE OR REPLACE FUNCTION contab.ff_diario_gerar_de_contas_receber(
    p_empresa_id bigint,
    p_data    date    
)
RETURNS void
LANGUAGE plpgsql
AS $$
DECLARE
    

BEGIN

 
    INSERT INTO contab.diario_staging (
        empresa_id, 
        data_mov,
         modelo_codigo,
        historico,
        doc_ref,
        parceiro_id,
        cnpj,
        data_vencto, 
        valor_total,
        valor_custo, valor_imposto, desconto, status,
        outros   
    )
    SELECT
        r.empresa_id,
        r.criado_em,
        r.evento_codigo,
        r.descricao,
        r.doc_ref,
        r.fornecedor_id,
        (
      SELECT p.cpf_cnpj
      FROM   pessoa p
      WHERE p.id = r.fornecedor_id
    ) AS cnpj,
        r.vencimento ,
        r.valor,
        0,0,0,
        'rascunho' ,
         jsonb_build_object(
        'origem', 'CONTAS_RECEBER',
        'evento', 'RECEBER'  )  
    FROM contas_a_receber r
    WHERE r.empresa_id = p_empresa_id
      AND r.vencimento = p_data;
 
 
END;
$$;

