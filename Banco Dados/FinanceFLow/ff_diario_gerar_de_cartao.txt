   CREATE OR REPLACE FUNCTION contab.ff_diario_gerar_de_cartao(
    p_empresa_id bigint,
    p_data date  
)
RETURNS void
LANGUAGE plpgsql
AS $$
DECLARE
 
     v_fornecedor bigint  ;
     
 
BEGIN

v_fornecedor := contab.ff_get_fornecedor_cartao(p_empresa_id ) ;


INSERT INTO contab.diario_staging (
                        empresa_id,  
                        data_mov, 
                        modelo_codigo, 
                        historico,
                        doc_ref, 
                        parceiro_id,
                        cnpj, 
                        data_vencto, 
                        valor_total,
                        valor_custo, 
                        valor_imposto, 
                        desconto, 
                        status ,
                       outros  )
                SELECT
      	       	    f.empresa_id,
       		     f.vencimento,
       		     f.evento_codigo,
     		    f.numero ,
       		    f.numero ,
       		    v_fornecedor,
                                      '00000000000000',
      		   f.vencimento,
      		   f.valor_total,
      		   0,0,0,
     		  'rascunho' , 
       		 jsonb_build_object(
           		 'origem', 'Fatura do Cart√£o', 
          		  'Fatura_id', f.id,
           		 'vencimento',  f.vencimento)  
    	FROM cartoes_faturas  f
    WHERE f.empresa_id = p_empresa_id
      AND f.vencimento  = p_data; 
END;
$$;
