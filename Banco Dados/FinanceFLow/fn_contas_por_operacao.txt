    
 CREATE OR REPLACE FUNCTION contab.fn_contas_por_operacao(
    p_empresa_id bigint,
    p_tipo_operacao text,
    p_lado text,
    p_tipo text,
    p_classificacao text
)
RETURNS SETOF contab.contas
LANGUAGE plpgsql
AS $$
BEGIN 

IF p_tipo_operacao = 'financeiro' THEN

    -- üîπ ENTRADA FINANCEIRA
    IF p_tipo = 'entrada' THEN

        IF p_lado = 'D' THEN
            -- Banco / Caixa
            RETURN QUERY
            SELECT *
            FROM contab.contas c
            WHERE c.empresa_id = p_empresa_id
              AND c.analitica = true
              AND c.codigo LIKE '1.1.%'
            ORDER BY c.codigo;

        ELSIF p_lado = 'C' THEN

            IF p_classificacao = 'receita' THEN
                RETURN QUERY
                SELECT *
                FROM contab.contas c
                WHERE c.empresa_id = p_empresa_id
                  AND c.analitica = true
                  AND c.codigo LIKE '4.%';
            END IF;

            IF p_classificacao = 'passivo' THEN
                RETURN QUERY
                SELECT *
                FROM contab.contas c
                WHERE c.empresa_id = p_empresa_id
                  AND c.analitica = true
                  AND c.codigo LIKE '2.%';
            END IF;

        END IF;

    END IF;

    -- üîπ SA√çDA FINANCEIRA
    IF p_tipo = 'saida' THEN

        IF p_lado = 'C' THEN
            -- Banco
            RETURN QUERY
            SELECT *
            FROM contab.contas c
            WHERE c.empresa_id = p_empresa_id
              AND c.analitica = true
              AND c.codigo LIKE '1.1.%';

        ELSIF p_lado = 'D' THEN

            IF p_classificacao = 'despesa' THEN
                RETURN QUERY
                SELECT *
                FROM contab.contas c
                WHERE c.empresa_id = p_empresa_id
                  AND c.analitica = true
                  AND c.codigo LIKE '6.%';
            END IF;

            IF p_classificacao = 'imobilizado' THEN
                RETURN QUERY
                SELECT *
                FROM contab.contas c
                WHERE c.empresa_id = p_empresa_id
                  AND c.analitica = true
                  AND c.codigo LIKE '1.2.%';
            END IF;

        END IF;

    END IF;

END IF;

END;
$$;

 
 