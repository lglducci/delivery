 CREATE OR REPLACE VIEW vw_saldo_atual AS
SELECT
  empresa_id,
  COALESCE(
    SUM(
      CASE 
        WHEN tipo = 'entrada' THEN valor
        WHEN tipo = 'saida'   THEN -valor
        ELSE 0
      END
    ),
    0::numeric(12,2)
  ) AS saldo_atual
FROM transacoes
WHERE data_movimento <= CURRENT_DATE
GROUP BY empresa_id;
