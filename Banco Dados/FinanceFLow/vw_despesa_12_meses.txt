CREATE OR REPLACE VIEW vw_despesa_12_meses AS
SELECT
  empresa_id,
  to_char(date_trunc('month', data_movimento), 'YYYY-MM') AS ano_mes,
    COALESCE(SUM(valor), 0) AS total_despesa
FROM transacoes
WHERE tipo = 'saida'
  AND data_movimento >= CURRENT_DATE - INTERVAL '12 months'
GROUP BY empresa_id, ano_mes
ORDER BY ano_mes;
