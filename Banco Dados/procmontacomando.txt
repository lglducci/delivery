CREATE OR REPLACE FUNCTION public.monta_comando_turno(p_user_id int, p_id_empresa int )
RETURNS text
LANGUAGE plpgsql
AS $$
DECLARE
  r RECORD;
  saida TEXT;
BEGIN
  SELECT * INTO r
  FROM public.turno_opcoes 
where user_id = p_user_id
  and     id_empresa =  p_id_empresa 

  ORDER BY updated_at DESC
  LIMIT 1;

  CASE lower(r.categoria)
    WHEN 'pizza' THEN
      saida := trim(both ' ' FROM format('%s pizza %s %s',
        r.quantidade, r.numero, coalesce(r.tamanho,'')));

    WHEN 'esfirra' THEN
      saida := format('%s esfirra %s', r.quantidade, r.numero);

    WHEN 'bebida' THEN
      saida := trim(both ' ' FROM format('%s bebida %s %s',
        r.quantidade, r.numero, coalesce(r.volume,'')));

    WHEN 'fracionada' THEN
      saida := trim(both ' ' FROM format('%s pizza 1/2 %s 1/2 %s %s',
        r.quantidade, r.numero, r.numero_fraca, coalesce(r.tamanho,'')));

   -- WHEN 'borda' THEN
      --saida := format('%s borda %s item_id %s',
    --    r.quantidade, r.numero, r.item_id);

   -- WHEN 'item' THEN
    --  saida := format('%s item %s item_id %s',
    --    r.quantidade, r.numero, r.item_id);

WHEN 'borda' THEN
  saida := format('%s borda %s item_id = %s',
    r.quantidade, r.numero, coalesce(r.item_id::text, ''));

WHEN 'item' THEN
  saida := format('%s item %s item_id = %s',
    r.quantidade, r.numero, coalesce(r.item_id::text, ''));


    ELSE
      saida := trim(both ' ' FROM format('%s %s %s %s',
        r.quantidade, r.categoria, r.numero, coalesce(r.tamanho,'')));
  END CASE;

  RETURN saida;
END
$$;
