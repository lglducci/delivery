  DROP TABLE IF EXISTS public."Item_pedido" CASCADE;    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  CREATE TABLE public."Item_pedido" (  item_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  numero bigint,
  user_id bigint,
  quantidade bigint,
  tamanho text,
  fracionada boolean,
  tipo text,
  categoria text,
  numero_fracao bigint,
  nome text,
  CONSTRAINT "Item_pedido_pkey" PRIMARY KEY (item_id));      

                                                                                                                                                                                                                                                                                                                                                         
  DROP TABLE IF EXISTS public.cardapio CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  CREATE TABLE public.cardapio (  numero bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  nome text,
  descricao text,
  tipo text,
  categoria text,
  preco_grande real,
  preco_medio real,
  disponivel boolean,
  palavras_chave text,
  volume text,
  codigo character varying,
  imagem text,
  CONSTRAINT cardapio_pkey PRIMARY KEY (numero));       
                                                                                                                                                                                                                                                                                                                                                                                      
  DROP TABLE IF EXISTS public.comentario_pedido CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  CREATE TABLE public.comentario_pedido (  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  pedido_id bigint,
  comentario text,
  user_id bigint,
  CONSTRAINT comentario_pedido_pkey PRIMARY KEY (id));                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  DROP TABLE IF EXISTS public.comentario_pedido_temp CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  CREATE TABLE public.comentario_pedido_temp (  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  pedido_id bigint,
  comentario text,
  user_id bigint,
  CONSTRAINT comentario_pedido_temp_pkey PRIMARY KEY (id));                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  DROP TABLE IF EXISTS public.empresa CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  CREATE TABLE public.empresa (  empresa_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  nome text,
  cnpj text,
  status text DEFAULT 'desabilidada'::text,
  data_validade date,
  CONSTRAINT empresa_pkey PRIMARY KEY (empresa_id));                                                                                                                                                                                                                                                                                                                                                                                                                                           
  DROP TABLE IF EXISTS public.item_opcoes CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  CREATE TABLE public.item_opcoes (  id integer DEFAULT nextval('item_opcoes_id_seq'::regclass) NOT NULL,
  item_id integer NOT NULL,
  numero integer NOT NULL,
  nome text NOT NULL,
  descricao text,
  fracao text,
  preco numeric(10,2),
  opcao integer,
  habilitada boolean DEFAULT false NOT NULL,
  CONSTRAINT item_opcoes_pkey PRIMARY KEY (id),
  CONSTRAINT uq_item_opcao UNIQUE (item_id, opcao));                                                                                                                                                                                                                                                                                                                                      
  DROP TABLE IF EXISTS public.item_pedido CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  CREATE TABLE public.item_pedido (  item_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  numero bigint,
  user_id bigint,
  quantidade bigint,
  tamanho text DEFAULT 'grande'::text,
  fracionada boolean,
  tipo text,
  categoria text,
  numero_fracao bigint,
  nome text DEFAULT 'nulo'::text,
  volume text,
  status text DEFAULT 'inicio'::text,
  valor real,
  valor_fracao real,
  pedido_id bigint,
  valor_unitario real,
  ordem_item integer,
  CONSTRAINT item_pedido_pkey PRIMARY KEY (item_id));                                                                                                                                                              
  DROP TABLE IF EXISTS public.item_pedido_temp CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  CREATE TABLE public.item_pedido_temp (  item_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  numero bigint,
  user_id bigint,
  quantidade bigint,
  tamanho text DEFAULT 'grande'::text,
  fracionada boolean,
  tipo text,
  categoria text,
  numero_fracao bigint,
  nome text DEFAULT 'nulo'::text,
  volume text DEFAULT 'desconhecido'::text,
  status text DEFAULT 'inicio'::text,
  valor real,
  valor_fracao real,
  pedido_id bigint,
  valor_unitario real,
  pizza_referencia text,
  nome_fracao text,
  ordem_item integer,
  id_pizza_pai bigint,
  status_fracao text,
  comando_original text,
  CONSTRAINT "Item_pedido_temp_pkey" PRIMARY KEY (item_id));  
  DROP TABLE IF EXISTS public.n8n_chat_histories CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  CREATE TABLE public.n8n_chat_histories (  id integer DEFAULT nextval('n8n_chat_histories_id_seq'::regclass) NOT NULL,
  session_id character varying(255) NOT NULL,
  message jsonb NOT NULL,
  CONSTRAINT n8n_chat_histories_pkey PRIMARY KEY (id));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  DROP TABLE IF EXISTS public.pedido_temp CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  CREATE TABLE public.pedido_temp (  pedido_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  user_id bigint NOT NULL,
  status text DEFAULT 'aberto'::text,
  valor real,
  tipo_cobranca text,
  resumo text,
  CONSTRAINT pedido_temp_pkey PRIMARY KEY (pedido_id),
  CONSTRAINT pedido_temp_user_id_key UNIQUE (user_id));                                                                                                                                                                                                                                                                                                                                                      
  DROP TABLE IF EXISTS public.pedidos CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  CREATE TABLE public.pedidos (  pedido_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  user_id bigint,
  resumo text,
  valor numeric,
  status text DEFAULT 'aberto'::text,
  tipo_cobranca text,
  create_at timestamp with time zone DEFAULT now(),
  CONSTRAINT "PEDIDO_COMPRA_pkey" PRIMARY KEY (pedido_id));                                                                                                                                                                                                                                                                                                                                                                                                                             
  DROP TABLE IF EXISTS public.usuario_lacantina CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  CREATE TABLE public.usuario_lacantina (  user_id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone DEFAULT now() NOT NULL,
  nome text,
  email text,
  telefone text,
  senha text,
  status text,
  "endereço" text,
  bairro text,
  residencial character varying,
  ultima_forma_pagto text,
  tipo_admim text,
  thread_id text,
  CONSTRAINT usuario_lacantina_pkey PRIMARY KEY (user_id));                                                                                                                                                                                                                                                                                                             
  DROP TABLE IF EXISTS public.v_numeros CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  CREATE TABLE public.v_numeros (  string_agg text);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  DROP INDEX IF EXISTS public.idx_cardapio_nome_trgm;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  CREATE INDEX idx_cardapio_nome_trgm ON public.cardapio USING gin (lower(nome) gin_trgm_ops);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  DROP INDEX IF EXISTS public.idx_cardapio_palavras_trgm;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  CREATE INDEX idx_cardapio_palavras_trgm ON public.cardapio USING gin (lower(palavras_chave) gin_trgm_ops);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  DROP INDEX IF EXISTS public.idx_pedido_temp_user_pedido;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  CREATE INDEX idx_pedido_temp_user_pedido ON public.pedido_temp USING btree (user_id, pedido_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  DROP INDEX IF EXISTS public.idx_item_pedido_temp_opcoes;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  CREATE INDEX idx_item_pedido_temp_opcoes ON public.item_pedido_temp USING btree (user_id, pedido_id) WHERE (status = 'opcoes'::text);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ALTER TABLE item_pedido_temp ADD CONSTRAINT fk_item_pizza_pai FOREIGN KEY (id_pizza_pai) REFERENCES item_pedido_temp(item_id) ON DELETE CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  ALTER TABLE item_pedido ADD CONSTRAINT item_pedido_user_id_fkey FOREIGN KEY (user_id) REFERENCES usuario_lacantina(user_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  ALTER TABLE item_pedido_temp ADD CONSTRAINT item_pedido_temp_user_id_fkey FOREIGN KEY (user_id) REFERENCES usuario_lacantina(user_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  ALTER TABLE item_pedido_temp ADD CONSTRAINT item_pedido_temp_pedido_id_fkey FOREIGN KEY (pedido_id) REFERENCES pedido_temp(pedido_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  ALTER TABLE pedidos ADD CONSTRAINT pedidos_user_id_fkey FOREIGN KEY (user_id) REFERENCES usuario_lacantina(user_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  ALTER TABLE item_opcoes ADD CONSTRAINT item_opcoes_item_id_fkey FOREIGN KEY (item_id) REFERENCES item_pedido_temp(item_id) ON DELETE CASCADE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        