{"createdAt":"2025-08-18T01:56:16.259Z","updatedAt":"2025-08-20T00:12:54.795Z","id":"nFnokjPTuTYr7VZH","name":"AdministradorDelivery","active":true,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[368,-352],"id":"7aad0ea0-4873-4cfd-b160-41467a60623b","name":"When chat message received","webhookId":"c4567342-fb0e-4d55-8bbc-7ef93a8bcdee","disabled":true},{"parameters":{"url":"=https://singlecolorimage.com/get/ffffff/450x300.png","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1120,-192],"id":"ce1c12ee-669e-4aaa-afab-0ea66fb04cc8","name":"HTTP Request"},{"parameters":{"operation":"multiStep","operations":{"operations":[{"operation":"text","text":"= {{ $('Resumo').item.json.resumo.replace(/[\\p{Extended_Pictographic}\\p{Emoji_Presentation}]/gu, '-') }}\\n{{ $('enderecopagto').item.json.mensagem.replace(/[\\p{Extended_Pictographic}\\p{Emoji_Presentation}]/gu, '-') }}","fontSize":12,"positionX":20,"positionY":60,"lineLength":200,"font":"/usr/share/fonts/truetype/msttcorefonts/Arial_Bold.ttf"}]},"options":{}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[1344,-192],"id":"247cfddc-2c59-4f6b-bccc-fe31da6c645a","name":"Edit Image"},{"parameters":{"method":"POST","url":"= https://apinocode01.megaapi.com.br/rest/sendMessage/megacode-Mp5VTYM2qds/mediaBase64","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Client-Token","value":"application/json"},{"name":"Authorization","value":"Bearer Mp5VTYM2qds"}]},"sendBody":true,"specifyBody":"json","jsonBody":"= {\n\t\"messageData\": {\n\t\t\"to\": \"{{ $('Filtro Inicial1').item.json.telefonesend }}\",\n\t\t\"base64\": \"data:image/jpeg;base64,{{ $json.base64 }}\",\n\t\t\"fileName\": \"{{ $json.fileName }}\",\n\t\t\"type\": \"document\",\n\t\t\"caption\": \"Segue  {{ $('Resumo').item.json.resumo .split(/\\r?\\n/)[0].replace(/^[^\\wÀ-ÿ]+/, '').trim() }}  \",\n\t\t\"mimeType\": \"image/jpeg\"\n\t}\n}","options":{}},"id":"091e8fe7-bf6a-42e7-a4a2-2f89d0a2f155","name":"MegaApi14","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2000,-192]},{"parameters":{"pdfName":"={{ $('Resumo').item.json.resumo .split(/\\r?\\n/)[0].replace(/^[^\\wÀ-ÿ]+/, '').trim() }}"},"type":"n8n-nodes-pdfkit.pdfKit","typeVersion":1,"position":[1568,-192],"id":"fc1d4c3d-c084-489d-866f-2f9fabbae14a","name":"gerapdf"},{"parameters":{"jsCode":"// Pega o primeiro item do fluxo\nconst it = items[0];\n\n// Garante que veio binário\nif (!it.binary || Object.keys(it.binary).length === 0) {\n  throw new Error('Sem binary no item. Conecte este Function logo após o nó que gera o PDF.');\n}\n\n// Descobre o nome da propriedade binária (pode ser \"data\", \"pdf\", etc.)\nconst binKey = Object.keys(it.binary)[0];\nconst bin = it.binary[binKey];\n\n// O n8n já guarda em base64 em bin.data. Limpamos quebras de linha/espaços só por garantia.\nconst base64 = (bin.data || '').replace(/\\s+/g, '');\n\n// Retorna em JSON para o próximo nó\nreturn [{\n  json: {\n    base64,\n    fileName: bin.fileName || 'tesxte.pdf',\n    mimeType: bin.mimeType || 'application/pdf',\n    binKeyUsado: binKey\n  }\n}];\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1776,-192],"id":"837e1ee5-5571-4600-90e2-4e226ba89cfb","name":"Code1"},{"parameters":{"operation":"executeQuery","query":"update  \n  pedidos\n  set status ='producao'\nWHERE status = 'recebido'\nand pedido_id = {{ $('Resumo').item.json.pedido_id }}  and user_id = {{ $('Resumo').item.json.user_id }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2192,-192],"id":"4503cb42-6c22-4041-95f6-253535688955","name":"Execute a SQL query1","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2384,-192],"id":"403a57e3-c299-4e95-b4f1-f67da9329553","name":"No Operation, do nothing16","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":" SELECT pedido_id, user_id, resumo\nFROM pedidos\nWHERE status = 'recebido'\nORDER BY pedido_id ASC, pedido_id ASC\nLIMIT 1;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[656,-192],"id":"da173dcc-44b3-4a40-889c-0928eac074db","name":"Resumo","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT\n  '- Endereço:  ' || COALESCE(u.\"endereço\", '—')\n  || E'\\n - Bairro:  ' || COALESCE(u.bairro, '—')\n  || E'\\n - Pagamento:  ' || COALESCE(pt.tipo_cobranca, '—')\n  AS mensagem\nFROM pedidos pt\nJOIN usuario_lacantina u\n  ON u.user_id = pt.user_id\nLEFT JOIN comentario_pedido  ct\n  ON ct.user_id = pt.user_id\n AND ct.pedido_id = pt.pedido_id\nWHERE\n  pt.user_id   = {{ $json.user_id }}\n  AND pt.pedido_id =  {{ $json.pedido_id }} \nLIMIT 1;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[896,-192],"id":"3c0827e5-bd06-45a8-9de5-46b7bf7c0195","name":"enderecopagto","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{"httpMethod":"POST","path":"admin","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-688,16],"id":"0f91a70c-2d6a-444c-9b1a-69654f4134c5","name":"Webhook","webhookId":"e1bcd88a-5d5d-4f23-8e0c-e6b1655f6eab"},{"parameters":{"assignments":{"assignments":[{"id":"d40cfc22-d0e3-4b41-81d5-b9eec06f2dab","name":"mensagem","value":"= {{ $json.saida.trim() }}","type":"string"},{"id":"b81fa178-1d74-47ba-bc36-b7a29e1c64bc","name":"telefonereciver","value":"= {{ $('Webhook').item.json.body.jid }}","type":"string"},{"id":"3a70c352-4788-4c66-bea9-6a6b4b47cd2e","name":"telefonesend","value":"= {{ $('Webhook').item.json.body.key.remoteJid }}","type":"string"},{"id":"5efc25c7-e60a-415d-a313-ae92c1f454c8","name":"pedido","value":"= {{ $json.pedido }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-192,0],"id":"680462f9-9a0d-40af-9a2a-bb84d05bfe01","name":"Parametros Fluxo","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"204f54b0-e3ed-4ff4-8302-8c20d3b8aa78","leftValue":"={{ $('Webhook').item.json.body.isGroup }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"c51986d9-f347-4198-89bb-9e4cd0f021c9","leftValue":"={{ $('Webhook').item.json.body.broadcast }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05ee6414-0164-473b-8f82-225cfba55ad2","leftValue":"={{ $('Webhook').item.json.body.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"id":"813dfa38-bb30-4938-b145-9299220671da","name":"Filtro Inicial1","type":"n8n-nodes-base.filter","typeVersion":2.1,"position":[96,-16],"notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Parametros Fluxo').item.json.mensagem.trim() }}","rightValue":"first","operator":{"type":"string","operation":"equals"},"id":"ebf4aaf4-df56-403a-a60c-42012aa83604"}],"combinator":"and"},"renameOutput":true,"outputKey":"first"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c5accebb-12b5-4552-a7ac-2b6bf21d9282","leftValue":"= {{ $('Parametros Fluxo').item.json.mensagem.trim() }}","rightValue":"aberto","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"aberto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"bffbce01-80c1-4652-8bff-32602950b4fa","leftValue":"= {{ String($input.first().json?.body?.message?.conversation ?? '')\n     .replace(/\\u00A0/g,' ')   // troca NBSP por espaço normal\n     .trim()                   // remove espaços no início/fim\n     .toLowerCase()\n     .normalize('NFD').replace(/[\\u0300-\\u036f]/g,'') }}","rightValue":" consultar","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"consultar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5115db10-3466-4647-8c94-4d157c8ab436","leftValue":"= {{ $('Parametros Fluxo').item.json.mensagem.trim() }}","rightValue":"avancar","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"avancar"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[352,-64],"id":"6f7c46e1-178d-4d5b-87f3-c8d323f97da4","name":"Switch"},{"parameters":{"url":"=https://singlecolorimage.com/get/ffffff/350x900.png","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[896,16],"id":"720ca3dd-3397-4b98-be0d-d747e53ec108","name":"HTTP Request1"},{"parameters":{"operation":"multiStep","operations":{"operations":[{"operation":"text","text":"= {{ $json.pedidos_lista }}\n\n ","fontSize":12,"positionX":20,"positionY":60,"lineLength":200,"font":"/usr/share/fonts/truetype/msttcorefonts/Arial_Bold.ttf"}]},"options":{}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[1120,16],"id":"52a182dc-ff40-42e0-beeb-d5f3d60e072b","name":"Edit Image1"},{"parameters":{"method":"POST","url":"=https://apinocode01.megaapi.com.br/rest/sendMessage/megacode-Mp5VTYM2qds/mediaBase64","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Client-Token","value":"application/json"},{"name":"Authorization","value":"Bearer Mp5VTYM2qds"}]},"sendBody":true,"specifyBody":"json","jsonBody":"= {\n\t\"messageData\": {\n\t\t\"to\": \" {{ $('Filtro Inicial1').item.json.telefonesend }}\",\n\t\t\"base64\": \"data:image/jpeg;base64,{{ $json.base64 }}\",\n\t\t\"fileName\": \"{{ $json.fileName }}\",\n\t\t\"type\": \"document\",\n\t\t\"caption\": \"Segue  Lista de pedidos em aberto\",\n\t\t\"mimeType\": \"image/jpeg\"\n\t}\n}\n ","options":{}},"id":"69f0011f-5c61-41d5-a328-f7003013e5d2","name":"MegaApi","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1792,16]},{"parameters":{"pdfName":"= Pedidos em Aberto"},"type":"n8n-nodes-pdfkit.pdfKit","typeVersion":1,"position":[1360,16],"id":"e8a9f1d3-3792-46ab-bb39-d4341675d225","name":"gerapdf1"},{"parameters":{"jsCode":"// Pega o primeiro item do fluxo\nconst it = items[0];\n\n// Garante que veio binário\nif (!it.binary || Object.keys(it.binary).length === 0) {\n  throw new Error('Sem binary no item. Conecte este Function logo após o nó que gera o PDF.');\n}\n\n// Descobre o nome da propriedade binária (pode ser \"data\", \"pdf\", etc.)\nconst binKey = Object.keys(it.binary)[0];\nconst bin = it.binary[binKey];\n\n// O n8n já guarda em base64 em bin.data. Limpamos quebras de linha/espaços só por garantia.\nconst base64 = (bin.data || '').replace(/\\s+/g, '');\n\n// Retorna em JSON para o próximo nó\nreturn [{\n  json: {\n    base64,\n    fileName: bin.fileName || 'tesxte.pdf',\n    mimeType: bin.mimeType || 'application/pdf',\n    binKeyUsado: binKey\n  }\n}];\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1568,16],"id":"011b05ce-5ed0-479d-96be-bea66e0eb9c0","name":"Code"},{"parameters":{"operation":"executeQuery","query":"update  \n  pedidos\n  set status ='producao'\nWHERE status = 'recebido'\nand pedido_id = {{ $('Resumo').item.json.pedido_id }}  and user_id = {{ $('Resumo').item.json.user_id }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2000,-448],"id":"ba1d39b6-facb-4d79-94ab-9d9081cef2d7","name":"Execute a SQL query2","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2000,16],"id":"6cf16111-3935-47a4-a4e8-19927924a579","name":"No Operation, do nothing","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":" SELECT\n  COALESCE(\n    STRING_AGG(\n      'Pedido nº ' || pedido_id::text || ' - ' || TO_CHAR(create_at, 'DD/MM/YYYY HH24:MI'),\n      E'\\n' ORDER BY create_at ASC, pedido_id ASC\n    ),\n    ''\n  ) || E'\\n' AS pedidos_lista\nFROM pedidos\nWHERE status = 'recebido';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[656,16],"id":"91e208d9-48fb-466a-a060-94d4f7af9f5a","name":"PedidosAberto","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":" SELECT pedido_id, user_id, resumo, status\nFROM pedidos\nWHERE  pedido_id = {{ $json.pedido }}  \nLIMIT 1;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[704,240],"id":"512cbe73-219d-4a44-a584-bf7a6b856c94","name":"Resumo1","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{"url":"=https://singlecolorimage.com/get/ffffff/450x300.png","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1104,240],"id":"6a088c9c-b8de-4840-bf6d-6e28fb1881b4","name":"HTTP Request2"},{"parameters":{"operation":"multiStep","operations":{"operations":[{"operation":"text","text":"= {{ $('Resumo1').item.json.resumo.replace(/[\\p{Extended_Pictographic}\\p{Emoji_Presentation}]/gu, '-') }}\\n- {{ String($('Resumo1').item.json.status ?? '').trimStart().replace(/^./, c => c.toUpperCase()) }}\\n - Endereço e forma de pagamento:\\n{{ $('enderecopagto1').item.json.mensagem.replace(/[\\p{Extended_Pictographic}\\p{Emoji_Presentation}]/gu, '-') }}","fontSize":12,"positionX":20,"positionY":60,"lineLength":200,"font":"/usr/share/fonts/truetype/msttcorefonts/Arial_Bold.ttf"}]},"options":{}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[1328,240],"id":"2382e324-959c-47e2-8c68-c6304aac27f0","name":"Edit Image2"},{"parameters":{"method":"POST","url":"= https://apinocode01.megaapi.com.br/rest/sendMessage/megacode-Mp5VTYM2qds/mediaBase64","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Client-Token","value":"application/json"},{"name":"Authorization","value":"Bearer Mp5VTYM2qds"}]},"sendBody":true,"specifyBody":"json","jsonBody":"= {\n\t\"messageData\": {\n\t\t\"to\": \"{{ $('Filtro Inicial1').item.json.telefonesend }}\",\n\t\t\"base64\": \"data:image/jpeg;base64,{{ $json.base64 }}\",\n\t\t\"fileName\": \"{{ $json.fileName }}\",\n\t\t\"type\": \"document\",\n\t\t\"caption\": \"Segue  {{ $('Resumo1').item.json.resumo .split(/\\r?\\n/)[0].replace(/^[^\\wÀ-ÿ]+/, '').trim() }}  \",\n\t\t\"mimeType\": \"image/jpeg\"\n\t}\n}","options":{}},"id":"dd000542-3157-4ca0-99b4-67fb560445aa","name":"MegaApi15","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1984,240]},{"parameters":{"pdfName":"={{ $('Resumo1').item.json.resumo .split(/\\r?\\n/)[0].replace(/^[^\\wÀ-ÿ]+/, '').trim() }}"},"type":"n8n-nodes-pdfkit.pdfKit","typeVersion":1,"position":[1552,240],"id":"5130bcb3-04bd-4d4a-b338-08fa657e09d1","name":"gerapdf2"},{"parameters":{"jsCode":"// Pega o primeiro item do fluxo\nconst it = items[0];\n\n// Garante que veio binário\nif (!it.binary || Object.keys(it.binary).length === 0) {\n  throw new Error('Sem binary no item. Conecte este Function logo após o nó que gera o PDF.');\n}\n\n// Descobre o nome da propriedade binária (pode ser \"data\", \"pdf\", etc.)\nconst binKey = Object.keys(it.binary)[0];\nconst bin = it.binary[binKey];\n\n// O n8n já guarda em base64 em bin.data. Limpamos quebras de linha/espaços só por garantia.\nconst base64 = (bin.data || '').replace(/\\s+/g, '');\n\n// Retorna em JSON para o próximo nó\nreturn [{\n  json: {\n    base64,\n    fileName: bin.fileName || 'tesxte.pdf',\n    mimeType: bin.mimeType || 'application/pdf',\n    binKeyUsado: binKey\n  }\n}];\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1760,240],"id":"b33471cf-aca1-4b28-ab48-d73015fa5f00","name":"Code2"},{"parameters":{"operation":"executeQuery","query":"update  \n  pedidos\n  set status ='producao'\nWHERE status = 'recebido'\nand pedido_id = {{ $('Resumo').item.json.pedido_id }}  and user_id = {{ $('Resumo').item.json.user_id }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2192,48],"id":"d08e47e8-ecfe-4e9c-85c8-b54d5a91a78d","name":"Execute a SQL query","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2224,240],"id":"bc14523d-eb38-4a61-9b54-3be19651d82b","name":"No Operation, do nothing17","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":"SELECT\n  '- Endereço:  ' || COALESCE(u.\"endereço\", '—')\n  || E'\\n - Bairro:  ' || COALESCE(u.bairro, '—')\n  || E'\\n - Pagamento:  ' || COALESCE(pt.tipo_cobranca, '—')\n  AS mensagem\nFROM pedidos pt\nJOIN usuario_lacantina u\n  ON u.user_id = pt.user_id\nLEFT JOIN comentario_pedido  ct\n  ON ct.user_id = pt.user_id\n AND ct.pedido_id = pt.pedido_id\nWHERE\n  pt.user_id   = {{ $json.user_id }}\n  AND pt.pedido_id =  {{ $json.pedido_id }} \nLIMIT 1;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[896,240],"id":"648c1572-0e81-40de-b34d-732517ba9cb5","name":"enderecopagto1","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{"jsCode":" // Lê só a mensagem do 1º item\nconst raw = String($input.first().json?.body?.message?.conversation ?? '');\n\n// Normaliza: NBSP/zero-width → espaço, colapsa espaços, trim\nconst msg = raw\n  .normalize('NFKC')\n  .replace(/[\\u00A0\\u2007\\u202F]/g, ' ')   // NBSPs comuns (WhatsApp)\n  .replace(/\\uFEFF/g, '')                  // BOM\n  .replace(/[\\u200B-\\u200D\\u2060]/g, '')   // zero-widths\n  .replace(/\\s+/g, ' ')\n  .trim();\n\n// Base sem acento e minúscula para as regras\nconst base = msg\n  .toLowerCase()\n  .normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''); // remove acentos\n\nconst regras = [\n  ['consultar', /\\bconsultar\\b/],\n  ['avancar',   /\\b(avancar|continuar|proximo)\\b/],\n  ['voltar',    /\\bvoltar\\b/],\n  ['cancelar',  /\\bcancelar\\b/],\n];\n\nconst achou = regras.find(([, re]) => re.test(base));\nconst saida = achou ? achou[0] : msg; // msg já sem espaço inicial/final\n\nconst pedido = (achou && achou[0] === 'consultar')\n  ? (base.match(/\\bconsultar\\b\\D*(\\d+)/)?.[1] ?? null)\n  : null;\n\nreturn [{ json: { saida, pedido } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-480,16],"id":"add9f29b-bcb0-41fc-9495-f43504055717","name":"Code3"}],"connections":{"When chat message received":{"main":[[]]},"HTTP Request":{"main":[[{"node":"Edit Image","type":"main","index":0}]]},"Edit Image":{"main":[[{"node":"gerapdf","type":"main","index":0}]]},"gerapdf":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"MegaApi14","type":"main","index":0}]]},"MegaApi14":{"main":[[{"node":"Execute a SQL query1","type":"main","index":0}]]},"Execute a SQL query1":{"main":[[{"node":"No Operation, do nothing16","type":"main","index":0}]]},"Resumo":{"main":[[{"node":"enderecopagto","type":"main","index":0}]]},"enderecopagto":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Code3","type":"main","index":0}]]},"Parametros Fluxo":{"main":[[{"node":"Filtro Inicial1","type":"main","index":0}]]},"Filtro Inicial1":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Resumo","type":"main","index":0}],[{"node":"PedidosAberto","type":"main","index":0}],[{"node":"Resumo1","type":"main","index":0}],[]]},"HTTP Request1":{"main":[[{"node":"Edit Image1","type":"main","index":0}]]},"Edit Image1":{"main":[[{"node":"gerapdf1","type":"main","index":0}]]},"MegaApi":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}]]},"gerapdf1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"MegaApi","type":"main","index":0}]]},"Execute a SQL query2":{"main":[[]]},"PedidosAberto":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]},"HTTP Request2":{"main":[[{"node":"Edit Image2","type":"main","index":0}]]},"Edit Image2":{"main":[[{"node":"gerapdf2","type":"main","index":0}]]},"MegaApi15":{"main":[[{"node":"No Operation, do nothing17","type":"main","index":0}]]},"gerapdf2":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"MegaApi15","type":"main","index":0}]]},"Execute a SQL query":{"main":[[]]},"enderecopagto1":{"main":[[{"node":"HTTP Request2","type":"main","index":0}]]},"Resumo1":{"main":[[{"node":"enderecopagto1","type":"main","index":0}]]},"Code3":{"main":[[{"node":"Parametros Fluxo","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"primary-production-d79b.up.railway.app","user-agent":"axios/1.7.7","content-length":"682","accept":"application/json, text/plain, */*","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"5.78.66.98","x-forwarded-host":"primary-production-d79b.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-west2","x-railway-request-id":"8ii6F05FTG6TpcN2xtoGcA","x-real-ip":"5.78.66.98","x-request-start":"1755639652403"},"params":{},"query":{},"body":{"instance_key":"megacode-Mp5VTYM2qds","jid":"5516994066336@s.whatsapp.net","messageType":"conversation","isBusiness":true,"key":{"remoteJid":"5516992975836@s.whatsapp.net","fromMe":false,"id":"88602EB77C99D093469E01B08A5C5132"},"messageTimestamp":1755639652,"pushName":"Luis Gustavo Landucci","broadcast":false,"message":{"conversation":"consultar 177","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"WPqpxngRfZMFYQ==","senderTimestamp":"1755521044","recipientKeyHash":"wwSTK66+c2cfFg==","recipientTimestamp":"1755639457"},"deviceListMetadataVersion":2,"messageSecret":"xffpfoZ2VmAZbe86eB+yZ/b2l/H18zOunKqY4ZBLDZI="}},"verifiedBizName":"Luis Gustavo Landucci","isGroup":false},"webhookUrl":"https://primary-production-d79b.up.railway.app/webhook-test/admin","executionMode":"test"}}]},"versionId":"4709b1ae-8958-4088-859b-eee993833826","triggerCount":1,"tags":[]}