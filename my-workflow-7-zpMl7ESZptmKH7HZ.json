{"createdAt":"2025-09-30T12:58:54.260Z","updatedAt":"2025-10-01T02:01:29.722Z","id":"zpMl7ESZptmKH7HZ","name":"My workflow 7","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"robo","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1088,-256],"id":"a94c0ff6-eacc-4f18-95f8-fd72bbf55a3e","name":"Webhook","webhookId":"19421e7e-00fd-415c-b827-6353648d8e0b"},{"parameters":{"promptType":"define","text":"={{ $json.resposta }}","options":{"systemMessage":"=#Regra\nUnica regra... leia a mensagem , interprete e responda.. nunca diga saudações tem tente comunicar...  seja 1000% pragimatico com o obetivo \nde comprar itens. \n\nVocê é um agente que é responsavel por comprar pizzas , esfirra , bebidas e bordas recheadas..   A loja a qual vc vai comprar possui um sistema whatsapp e vc é responsavel por entender as respostas responder...Pode inventar endereço e baixo e forma de pagamento somente pix, cartão e dinheiro.   Se tiver alguma duvida envie a mensagem ajuda e siga as instruções.\n\nExemplos de compra:\n\nConsulta envie  mussarela, presunto, carne bolonhesa coca cola , calabresa, frango , baiana, \n\nPizzas  envie    1 pizza frango grande, 1 pizza bolonhesa grande, 1 pizza marguerita grande , 1 pizza 1/2 21 e 1/2 11 \n\nInvente pizzas de 1 a 43   no seguinte sentido   1 pizza 10 grande...\n\n1 esfirra de carne. \n\nRegra 2 \nInterprete a resposta e envie os exemplos ..."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-448,-720],"id":"26cb078a-18ba-4579-ac3b-b070b7a3e775","name":"AI Agent"},{"parameters":{"assignments":{"assignments":[{"id":"d9fdbadb-a2cc-4bb5-bd98-edd6bbf885de","name":"nome","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"bbdb0540-c3be-4ba5-bafb-858efca68ca9","name":"telefone","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"753249b6-a194-4dff-84ba-248dbe569b14","name":"resposta","value":"={{ $json.body.data.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-688,-720],"id":"122da506-6f23-47db-b44c-acae7766799e","name":"Edit Fields"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-512,-496],"id":"5cef012a-6ffe-40aa-938d-790727e170b6","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"YvUoOPijIpNeTjed","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"qwewqe"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-400,-464],"id":"517004d0-74de-4cc2-b5a6-76af0ef5d502","name":"Simple Memory"},{"parameters":{"resource":"messages-api","instanceName":"delivery","remoteJid":"=5516991216319","messageText":"={{ $json.resultado }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[-448,-256],"id":"604796e2-0bc2-48a4-a096-48451eec6894","name":"MenuCardapio","credentials":{"evolutionApi":{"id":"ApqS5DPziUrzonYT","name":"Evolution account"}}},{"parameters":{"operation":"executeQuery","query":" SELECT string_agg(\n           '1 ' || categoria || ' ' || nome || ' grande',\n           E'\\n'\n           ORDER BY numero\n       ) AS resultado\nFROM cardapio where numero  = {{ $json.body.data.message.conversation }}  ;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-784,-256],"id":"6fa80ba0-403c-4ba4-b995-b03b885b8b1c","name":"Execute a SQL query","credentials":{"postgres":{"id":"3NLaVyXonSrCcLE3","name":"Postgres account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-32,-480],"id":"fef2d1d5-0320-4a96-8479-fc4145555622","name":"When chat message received","webhookId":"85b0e43f-0705-4eaa-aaf4-99b43e8f67d4"}],"connections":{"Webhook":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[]]},"Execute a SQL query":{"main":[[]]},"When chat message received":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.lglducci.com.br","user-agent":"axios/1.7.7","content-length":"849","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"159.69.117.195","cf-ipcountry":"DE","cf-ray":"9873eb7fb8de141d-FRA","cf-visitor":"{\"scheme\":\"https\"}","content-type":"application/json","x-forwarded-for":"104.23.239.121","x-forwarded-host":"n8n.lglducci.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"traefik_traefik.1","x-real-ip":"104.23.239.121"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"Conversational","data":{"key":{"remoteJid":"5516994066336@s.whatsapp.net","fromMe":false,"id":"AC79DF4542C5A6D71D50CCA4E6C85B9F"},"pushName":"Luis Gustavo Landucci","message":{"conversation":"1 pizza calabresa grande","messageContextInfo":{"deviceListMetadata":{"senderTimestamp":"1758678432","recipientKeyHash":"tdfI7SMB/oQQZw==","recipientTimestamp":"1758670683"},"deviceListMetadataVersion":2,"messageSecret":"6IEs2t1v4zUpEf4yfuiPcpkQ3S72t5ScRByPHJTKSJU="}},"messageType":"conversation","messageTimestamp":1759237401,"instanceId":"d3fb966a-a4fc-435c-94de-116c8544dcab","source":"android"},"destination":"https://n8n.lglducci.com.br/webhook-test/robo","date_time":"2025-09-30T10:03:21.495Z","sender":"5516992975836@s.whatsapp.net","server_url":"https://evolution.lglducci.com.br","apikey":"C39C0907A83E-4F12-A51C-3187706A324F"},"webhookUrl":"https://webhook.lglducci.com.br/webhook-test/robo","executionMode":"test"}}]},"versionId":"96291430-d880-4f97-8cab-d63036e3d8ed","triggerCount":2,"shared":[{"createdAt":"2025-09-30T12:58:54.260Z","updatedAt":"2025-09-30T12:58:54.260Z","role":"workflow:owner","workflowId":"zpMl7ESZptmKH7HZ","projectId":"wFRMrac2003Pl1x6"}],"tags":[]}