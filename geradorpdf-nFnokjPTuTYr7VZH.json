{"createdAt":"2025-08-18T01:56:16.259Z","updatedAt":"2025-08-18T23:58:05.498Z","id":"nFnokjPTuTYr7VZH","name":"geradorpdf","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[0,0],"id":"7aad0ea0-4873-4cfd-b160-41467a60623b","name":"When chat message received","webhookId":"c4567342-fb0e-4d55-8bbc-7ef93a8bcdee"},{"parameters":{"jsCode":"return { \"nome\":\"Luis Gustavo Landucci\", \"curso\":\"Ciencias da Computacao\", \"carga horaria\":\"64 horas\"}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[160,-288],"id":"7542039c-83a9-4ca8-b42d-165500fb9b17","name":"Code"},{"parameters":{"url":"=https://singlecolorimage.com/get/ffffff/450x300.png","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[752,0],"id":"ce1c12ee-669e-4aaa-afab-0ea66fb04cc8","name":"HTTP Request"},{"parameters":{"operation":"multiStep","operations":{"operations":[{"operation":"text","text":"= {{ $('Resumo').item.json.resumo.replace(/[\\p{Extended_Pictographic}\\p{Emoji_Presentation}]/gu, '-') }}\\n{{ $('enderecopagto').item.json.mensagem.replace(/[\\p{Extended_Pictographic}\\p{Emoji_Presentation}]/gu, '-') }}","fontSize":12,"positionX":20,"positionY":60,"lineLength":200,"font":"/usr/share/fonts/truetype/msttcorefonts/Arial_Bold.ttf"}]},"options":{}},"type":"n8n-nodes-base.editImage","typeVersion":1,"position":[992,0],"id":"247cfddc-2c59-4f6b-bccc-fe31da6c645a","name":"Edit Image"},{"parameters":{"method":"POST","url":"https://host/rest/sendMessage/instance_key/mediaBase64","sendHeaders":true,"headerParameters":{"parameters":[{"name":"authorization","value":"Bearer token"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"messageData\": {\n    \"to\": \"551199999999@s.whatsapp.net\",\n    \"base64\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAMAAAC8...\",\n    \"fileName\": \"pdfExemplo.pdf\",\n    \"type\": \"document\",\n    \"caption\": \"string\",\n    \"mimeType\": \"application/pdf\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1328,-656],"id":"0c135692-fb32-40ab-846f-c0ad9b86f0d8","name":"HTTP Request1"},{"parameters":{"method":"POST","url":"= https://apinocode01.megaapi.com.br/rest/sendMessage/megacode-MyrBo2u0n7N/mediaBase64","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Client-Token","value":"application/json"},{"name":"Authorization","value":"Bearer MyrBo2u0n7N"}]},"sendBody":true,"specifyBody":"json","jsonBody":"= {\n\t\"messageData\": {\n\t\t\"to\": \"5516992975836\",\n\t\t\"base64\": \"data:image/jpeg;base64,{{ $json.base64 }}\",\n\t\t\"fileName\": \"{{ $json.fileName }}\",\n\t\t\"type\": \"document\",\n\t\t\"caption\": \"Segue  {{ $('Resumo').item.json.resumo .split(/\\r?\\n/)[0].replace(/^[^\\wÀ-ÿ]+/, '').trim() }}  \",\n\t\t\"mimeType\": \"image/jpeg\"\n\t}\n}","options":{}},"id":"091e8fe7-bf6a-42e7-a4a2-2f89d0a2f155","name":"MegaApi14","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1632,0]},{"parameters":{"pdfName":"={{ $('Resumo').item.json.resumo .split(/\\r?\\n/)[0].replace(/^[^\\wÀ-ÿ]+/, '').trim() }}"},"type":"n8n-nodes-pdfkit.pdfKit","typeVersion":1,"position":[1200,0],"id":"fc1d4c3d-c084-489d-866f-2f9fabbae14a","name":"gerapdf"},{"parameters":{"jsCode":"// Pega o primeiro item do fluxo\nconst it = items[0];\n\n// Garante que veio binário\nif (!it.binary || Object.keys(it.binary).length === 0) {\n  throw new Error('Sem binary no item. Conecte este Function logo após o nó que gera o PDF.');\n}\n\n// Descobre o nome da propriedade binária (pode ser \"data\", \"pdf\", etc.)\nconst binKey = Object.keys(it.binary)[0];\nconst bin = it.binary[binKey];\n\n// O n8n já guarda em base64 em bin.data. Limpamos quebras de linha/espaços só por garantia.\nconst base64 = (bin.data || '').replace(/\\s+/g, '');\n\n// Retorna em JSON para o próximo nó\nreturn [{\n  json: {\n    base64,\n    fileName: bin.fileName || 'tesxte.pdf',\n    mimeType: bin.mimeType || 'application/pdf',\n    binKeyUsado: binKey\n  }\n}];\n "},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1408,0],"id":"837e1ee5-5571-4600-90e2-4e226ba89cfb","name":"Code1"},{"parameters":{"operation":"executeQuery","query":"update  \n  pedidos\n  set status ='execucao'\nWHERE status = 'recebido'\nand pedido_id = {{ $('Resumo').item.json.pedido_id }}  and user_id = {{ $('Resumo').item.json.user_id }};","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1824,0],"id":"4503cb42-6c22-4041-95f6-253535688955","name":"Execute a SQL query1","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2016,0],"id":"403a57e3-c299-4e95-b4f1-f67da9329553","name":"No Operation, do nothing16","notes":"TEMPLATE DESENVOLVIDO POR NOCODE STARTUP\nhttps://nocodestartup.io/\n\nFORMAÇÃO GESTOR DE AGENTES DE IA:\nhttps://nocodestartup.io/formacao-gestor-agentes-ia/"},{"parameters":{"operation":"executeQuery","query":" SELECT pedido_id, user_id, resumo\nFROM pedidos\nWHERE status = 'recebido'\nORDER BY pedido_id ASC, pedido_id ASC\nLIMIT 1;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[224,0],"id":"da173dcc-44b3-4a40-889c-0928eac074db","name":"Resumo","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT\n  '- Endereço:  ' || COALESCE(u.\"endereço\", '—')\n  || E'\\n - Bairro:  ' || COALESCE(u.bairro, '—')\n  || E'\\n - Pagamento:  ' || COALESCE(pt.tipo_cobranca, '—')\n  AS mensagem\nFROM pedidos pt\nJOIN usuario_lacantina u\n  ON u.user_id = pt.user_id\nLEFT JOIN comentario_pedido  ct\n  ON ct.user_id = pt.user_id\n AND ct.pedido_id = pt.pedido_id\nWHERE\n  pt.user_id   = {{ $json.user_id }}\n  AND pt.pedido_id =  {{ $json.pedido_id }} \nLIMIT 1;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[448,0],"id":"3c0827e5-bd06-45a8-9de5-46b7bf7c0195","name":"enderecopagto","credentials":{"postgres":{"id":"UaH67kvWXxdMMhJt","name":"Postgres account"}}}],"connections":{"When chat message received":{"main":[[{"node":"Resumo","type":"main","index":0}]]},"Code":{"main":[[]]},"HTTP Request":{"main":[[{"node":"Edit Image","type":"main","index":0}]]},"Edit Image":{"main":[[{"node":"gerapdf","type":"main","index":0}]]},"gerapdf":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"MegaApi14","type":"main","index":0}]]},"MegaApi14":{"main":[[{"node":"Execute a SQL query1","type":"main","index":0}]]},"Execute a SQL query1":{"main":[[{"node":"No Operation, do nothing16","type":"main","index":0}]]},"Resumo":{"main":[[{"node":"enderecopagto","type":"main","index":0}]]},"enderecopagto":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7a0dc5c2-f5b5-4848-82c5-b0837dc5afe2","triggerCount":0,"tags":[]}