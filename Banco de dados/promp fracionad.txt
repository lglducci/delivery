⚙️ Fluxo Lógico Definitivo — Pizzas Fracionadas com Bordas
🧩 1️⃣ Identificar categoria e contexto

Quando a IA detectar que o cliente pediu “1 pizza 1/2 <sabor1> e 1/2 <sabor2> ...”
→ entra no modo fracionado.

Ações:

modo = 'fracionada'
parte = 1

🍕 2️⃣ Resolver sabor 1

Se sabor1 não tiver número, a IA deve:

ConsultaOnlineVendas("pizza <sabor1>")


Quando receber o retorno → extrai o número (ex.: 58)
e monta:

GravarFracionado(parte=1, numero=58, tamanho='<tamanho>')


⚠️ só pergunta o tamanho na primeira metade.

🍕 3️⃣ Resolver sabor 2

Agora a IA:

ConsultaOnlineVendas("pizza <sabor2>")


Quando retornar o número (ex.: 16):

GravarFracionado(parte=2, numero=16)


Pronto: metade1 e metade2 registradas no banco, com tamanho herdado da 1ª parte.

🍕 4️⃣ Detectar e vincular borda (se houver)

Se o cliente disser algo como “com borda cheddar”,
a IA deve:

ConsultaOnlineVendas("borda cheddar")


Quando encontrar o número (ex.: 302):

IntencaoCompra("1 borda 302 para pizza_fracionada")


A borda é associada à última pizza fracionada (usando o último item_id retornado por GetCarrinho()).

🧠 5️⃣ Montagem final — Intent unificada

Depois das duas metades e da borda resolvidas:

GetFracionado()  → retorna estrutura { metade1:58, metade2:16, tamanho:'grande' }


Se tiver borda:

IntencaoCompra("1 pizza 1/2 58 e 1/2 16 grande com borda 302")


Se não tiver:

IntencaoCompra("1 pizza 1/2 58 e 1/2 16 grande")

🧱 Estrutura Modular
Etapa	Tool / Função	Entrada	Saída
1	ConsultaOnlineVendas("pizza <sabor>")	texto	nº item
2	GravarFracionado(1, <numero>, <tamanho>)	nº + tamanho	grava parte 1
3	GravarFracionado(2, <numero>)	nº	grava parte 2
4	ConsultaOnlineVendas("borda <sabor>")	texto	nº borda
5	IntencaoCompra("1 pizza 1/2 <n1> e 1/2 <n2> <tamanho> [com borda <nborda>]")	tudo resolvido	grava intenção final
🧩 Segurança e Validação

✅ Nunca chamar IntencaoCompra antes das duas metades estarem resolvidas.

✅ Nunca perguntar tamanho na segunda metade.

✅ Se o cliente disser “sem borda”, pula a etapa de borda.

✅ Se repetir o mesmo sabor (ex.: “1/2 mussarela e 1/2 mussarela”) → trata como pizza inteira (IntencaoCompra("1 pizza 24 grande")).

✅ Só uma intenção final por fracionada — nunca 2 linhas.