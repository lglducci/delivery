âš™ï¸ Fluxo LÃ³gico Definitivo â€” Pizzas Fracionadas com Bordas
ğŸ§© 1ï¸âƒ£ Identificar categoria e contexto

Quando a IA detectar que o cliente pediu â€œ1 pizza 1/2 <sabor1> e 1/2 <sabor2> ...â€
â†’ entra no modo fracionado.

AÃ§Ãµes:

modo = 'fracionada'
parte = 1

ğŸ• 2ï¸âƒ£ Resolver sabor 1

Se sabor1 nÃ£o tiver nÃºmero, a IA deve:

ConsultaOnlineVendas("pizza <sabor1>")


Quando receber o retorno â†’ extrai o nÃºmero (ex.: 58)
e monta:

GravarFracionado(parte=1, numero=58, tamanho='<tamanho>')


âš ï¸ sÃ³ pergunta o tamanho na primeira metade.

ğŸ• 3ï¸âƒ£ Resolver sabor 2

Agora a IA:

ConsultaOnlineVendas("pizza <sabor2>")


Quando retornar o nÃºmero (ex.: 16):

GravarFracionado(parte=2, numero=16)


Pronto: metade1 e metade2 registradas no banco, com tamanho herdado da 1Âª parte.

ğŸ• 4ï¸âƒ£ Detectar e vincular borda (se houver)

Se o cliente disser algo como â€œcom borda cheddarâ€,
a IA deve:

ConsultaOnlineVendas("borda cheddar")


Quando encontrar o nÃºmero (ex.: 302):

IntencaoCompra("1 borda 302 para pizza_fracionada")


A borda Ã© associada Ã  Ãºltima pizza fracionada (usando o Ãºltimo item_id retornado por GetCarrinho()).

ğŸ§  5ï¸âƒ£ Montagem final â€” Intent unificada

Depois das duas metades e da borda resolvidas:

GetFracionado()  â†’ retorna estrutura { metade1:58, metade2:16, tamanho:'grande' }


Se tiver borda:

IntencaoCompra("1 pizza 1/2 58 e 1/2 16 grande com borda 302")


Se nÃ£o tiver:

IntencaoCompra("1 pizza 1/2 58 e 1/2 16 grande")

ğŸ§± Estrutura Modular
Etapa	Tool / FunÃ§Ã£o	Entrada	SaÃ­da
1	ConsultaOnlineVendas("pizza <sabor>")	texto	nÂº item
2	GravarFracionado(1, <numero>, <tamanho>)	nÂº + tamanho	grava parte 1
3	GravarFracionado(2, <numero>)	nÂº	grava parte 2
4	ConsultaOnlineVendas("borda <sabor>")	texto	nÂº borda
5	IntencaoCompra("1 pizza 1/2 <n1> e 1/2 <n2> <tamanho> [com borda <nborda>]")	tudo resolvido	grava intenÃ§Ã£o final
ğŸ§© SeguranÃ§a e ValidaÃ§Ã£o

âœ… Nunca chamar IntencaoCompra antes das duas metades estarem resolvidas.

âœ… Nunca perguntar tamanho na segunda metade.

âœ… Se o cliente disser â€œsem bordaâ€, pula a etapa de borda.

âœ… Se repetir o mesmo sabor (ex.: â€œ1/2 mussarela e 1/2 mussarelaâ€) â†’ trata como pizza inteira (IntencaoCompra("1 pizza 24 grande")).

âœ… SÃ³ uma intenÃ§Ã£o final por fracionada â€” nunca 2 linhas.