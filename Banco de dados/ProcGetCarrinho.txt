 CREATE OR REPLACE FUNCTION get_carrinho_pizza(
    p_user_id INTEGER,
    p_pedido_id INTEGER,
    p_id_empresa INTEGER
)
RETURNS TABLE (
    item_id BIGINT,
    numero BIGINT,
    nome TEXT,
    tamanho TEXT,
    quantidade BIGINT
)
LANGUAGE plpgsql
AS $$
BEGIN
    -- Registrar log da chamada
    INSERT INTO log_debug (etapa, comando, retorno, user_id, pedido_id, id_empresa)
    VALUES (
        'GetCarrinho',
        'Adicionar borda ou item',
        'Executado com sucesso',
        p_user_id,
        p_pedido_id,
        p_id_empresa
    );

    -- Retornar os itens de pizza no carrinho
    RETURN QUERY
    SELECT 
        i.item_id,
        i.numero,
        i.nome,
        i.tamanho,
        i.quantidade
    FROM item_pedido_temp i
    WHERE i.user_id = p_user_id
      AND i.pedido_id = p_pedido_id
      AND i.id_empresa = p_id_empresa
      AND i.categoria = 'pizza'
    ORDER BY i.item_id;

END;
$$;
