-- üîÅ Remove a fun√ß√£o antiga se existir
DROP FUNCTION IF EXISTS public.cancela_pre_pedido(INTEGER, INTEGER, INTEGER);

-- ‚úÖ Cria√ß√£o da fun√ß√£o
CREATE OR REPLACE FUNCTION public.cancela_pre_pedido(p_user_id INTEGER, p_pedido_id INTEGER, p_id_empresa INTEGER)
RETURNS VOID AS $$ 
BEGIN
  -- Exclui itens do pr√©-pedido
  DELETE FROM item_pedido_temp
  WHERE user_id = p_user_id
    AND pedido_id = p_pedido_id
    and id_empresa = p_id_empresa ;

  -- Exclui o pedido tempor√°rio
  --DELETE FROM 
  update  pedido_temp set status = 'enviado'
  WHERE user_id = p_user_id
    AND pedido_id = p_pedido_id
    and id_empresa = p_id_empresa;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

GRANT EXECUTE ON FUNCTION public.cancela_pre_pedido(INTEGER, INTEGER,INTEGER) TO anon;
GRANT EXECUTE ON FUNCTION public.cancela_pre_pedido(INTEGER, INTEGER,INTEGER) TO authenticated;